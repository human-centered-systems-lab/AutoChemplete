!function(e,t,i,n){"use strict";function s(e,t,i){return setTimeout(u(e,i),t)}function a(e,t,i){return!!Array.isArray(e)&&(r(e,i[t],i),!0)}function r(e,t,i){var s;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==n)for(s=0;s<e.length;)t.call(i,e[s],s,e),s++;else for(s in e)e.hasOwnProperty(s)&&t.call(i,e[s],s,e)}function o(t,i,n){var s="DEPRECATED METHOD: "+i+"\n"+n+" AT \n";return function(){var i=new Error("get-stack-trace"),n=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=e.console&&(e.console.warn||e.console.log);return a&&a.call(e.console,s,n),t.apply(this,arguments)}}function l(e,t,i){var n,s=t.prototype;(n=e.prototype=Object.create(s)).constructor=e,n._super=s,i&&Q(n,i)}function u(e,t){return function(){return e.apply(t,arguments)}}function d(e,t){return typeof e==ie?e.apply(t&&t[0]||n,t):e}function h(e,t){return e===n?t:e}function g(e,t,i){r(f(t),function(t){e.addEventListener(t,i,!1)})}function c(e,t,i){r(f(t),function(t){e.removeEventListener(t,i,!1)})}function p(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function E(e,t){return e.indexOf(t)>-1}function f(e){return e.trim().split(/\s+/g)}function T(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var n=0;n<e.length;){if(i&&e[n][i]==t||!i&&e[n]===t)return n;n++}return-1}function C(e){return Array.prototype.slice.call(e,0)}function m(e,t,i){for(var n=[],s=[],a=0;a<e.length;){var r=t?e[a][t]:e[a];T(s,r)<0&&n.push(e[a]),s[a]=r,a++}return i&&(n=t?n.sort(function(e,i){return e[t]>i[t]}):n.sort()),n}function v(e,t){for(var i,s,a=t[0].toUpperCase()+t.slice(1),r=0;r<ee.length;){if((s=(i=ee[r])?i+a:t)in e)return s;r++}return n}function P(t){var i=t.ownerDocument||t;return i.defaultView||i.parentWindow||e}function _(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){d(e.options.enable,[e])&&i.handler(t)},this.init()}function y(e,t,i){var n=i.pointers.length,s=i.changedPointers.length,a=t&Ee&&n-s==0,r=t&(Te|Ce)&&n-s==0;i.isFirst=!!a,i.isFinal=!!r,a&&(e.session={}),i.eventType=t,function(e,t){var i=e.session,n=t.pointers,s=n.length;i.firstInput||(i.firstInput=O(t)),s>1&&!i.firstMultiple?i.firstMultiple=O(t):1===s&&(i.firstMultiple=!1);var a=i.firstInput,r=i.firstMultiple,o=r?r.center:a.center,l=t.center=D(n);t.timeStamp=ae(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=k(o,l),t.distance=R(o,l),function(e,t){var i=t.center,n=e.offsetDelta||{},s=e.prevDelta||{},a=e.prevInput||{};t.eventType!==Ee&&a.eventType!==Te||(s=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},n=e.offsetDelta={x:i.x,y:i.y}),t.deltaX=s.x+(i.x-n.x),t.deltaY=s.y+(i.y-n.y)}(i,t),t.offsetDirection=I(t.deltaX,t.deltaY);var u=A(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=u.x,t.overallVelocityY=u.y,t.overallVelocity=se(u.x)>se(u.y)?u.x:u.y,t.scale=r?function(e,t){return R(t[0],t[1],Ie)/R(e[0],e[1],Ie)}(r.pointers,n):1,t.rotation=r?function(e,t){return k(t[1],t[0],Ie)+k(e[1],e[0],Ie)}(r.pointers,n):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length,S(i,t);var d=e.element;p(t.srcEvent.target,d)&&(d=t.srcEvent.target),t.target=d}(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function S(e,t){var i,s,a,r,o=e.lastInterval||t,l=t.timeStamp-o.timeStamp;if(t.eventType!=Ce&&(l>pe||o.velocity===n)){var u=t.deltaX-o.deltaX,d=t.deltaY-o.deltaY,h=A(l,u,d);s=h.x,a=h.y,i=se(h.x)>se(h.y)?h.x:h.y,r=I(u,d),e.lastInterval=t}else i=o.velocity,s=o.velocityX,a=o.velocityY,r=o.direction;t.velocity=i,t.velocityX=s,t.velocityY=a,t.direction=r}function O(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:ne(e.pointers[i].clientX),clientY:ne(e.pointers[i].clientY)},i++;return{timeStamp:ae(),pointers:t,center:D(t),deltaX:e.deltaX,deltaY:e.deltaY}}function D(e){var t=e.length;if(1===t)return{x:ne(e[0].clientX),y:ne(e[0].clientY)};for(var i=0,n=0,s=0;t>s;)i+=e[s].clientX,n+=e[s].clientY,s++;return{x:ne(i/t),y:ne(n/t)}}function A(e,t,i){return{x:t/e||0,y:i/e||0}}function I(e,t){return e===t?me:se(e)>=se(t)?0>e?ve:Pe:0>t?_e:ye}function R(e,t,i){i||(i=Ae);var n=t[i[0]]-e[i[0]],s=t[i[1]]-e[i[1]];return Math.sqrt(n*n+s*s)}function k(e,t,i){i||(i=Ae);var n=t[i[0]]-e[i[0]],s=t[i[1]]-e[i[1]];return 180*Math.atan2(s,n)/Math.PI}function W(){this.evEl=ke,this.evWin=We,this.pressed=!1,_.apply(this,arguments)}function K(){this.evEl=Le,this.evWin=be,_.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=xe,this.evWin=Me,this.started=!1,_.apply(this,arguments)}function L(){this.evTarget=Ve,this.targetIds={},_.apply(this,arguments)}function b(){_.apply(this,arguments);var e=u(this.handler,this);this.touch=new L(this.manager,e),this.mouse=new W(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function B(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var i={x:t.clientX,y:t.clientY};this.lastTouches.push(i);var n=this.lastTouches;setTimeout(function(){var e=n.indexOf(i);e>-1&&n.splice(e,1)},Fe)}}function x(e,t){this.manager=e,this.set(t)}function M(e){this.options=Q({},this.defaults,e||{}),this.id=le++,this.manager=null,this.options.enable=h(this.options.enable,!0),this.state=Ze,this.simultaneous={},this.requireFail=[]}function w(e){return e&nt?"cancel":e&tt?"end":e&et?"move":e&Qe?"start":""}function V(e){return e==ye?"down":e==_e?"up":e==ve?"left":e==Pe?"right":""}function F(e,t){var i=t.manager;return i?i.get(e):e}function H(){M.apply(this,arguments)}function U(){H.apply(this,arguments),this.pX=null,this.pY=null}function G(){H.apply(this,arguments)}function z(){M.apply(this,arguments),this._timer=null,this._input=null}function j(){H.apply(this,arguments)}function X(){H.apply(this,arguments)}function Y(){M.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function $(e,t){return(t=t||{}).recognizers=h(t.recognizers,$.defaults.preset),new J(e,t)}function J(e,t){this.options=Q({},$.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){var t=e.options.inputClass;return new(t||(de?K:he?L:ue?b:W))(e,y)}(this),this.touchAction=new x(this,this.options.touchAction),q(this,!0),r(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function q(e,t){var i,n=e.element;n.style&&(r(e.options.cssProps,function(s,a){i=v(n.style,a),t?(e.oldCssProps[i]=n.style[i],n.style[i]=s):n.style[i]=e.oldCssProps[i]||""}),t||(e.oldCssProps={}))}function Z(e,i){var n=t.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=i,i.target.dispatchEvent(n)}var Q,ee=["","webkit","Moz","MS","ms","o"],te=t.createElement("div"),ie="function",ne=Math.round,se=Math.abs,ae=Date.now;Q="function"!=typeof Object.assign?function(e){if(e===n||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var s=arguments[i];if(s!==n&&null!==s)for(var a in s)s.hasOwnProperty(a)&&(t[a]=s[a])}return t}:Object.assign;var re=o(function(e,t,i){for(var s=Object.keys(t),a=0;a<s.length;)(!i||i&&e[s[a]]===n)&&(e[s[a]]=t[s[a]]),a++;return e},"extend","Use `assign`."),oe=o(function(e,t){return re(e,t,!0)},"merge","Use `assign`."),le=1,ue="ontouchstart"in e,de=v(e,"PointerEvent")!==n,he=ue&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),ge="touch",ce="mouse",pe=25,Ee=1,fe=2,Te=4,Ce=8,me=1,ve=2,Pe=4,_e=8,ye=16,Se=ve|Pe,Oe=_e|ye,De=Se|Oe,Ae=["x","y"],Ie=["clientX","clientY"];_.prototype={handler:function(){},init:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(P(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&c(this.element,this.evEl,this.domHandler),this.evTarget&&c(this.target,this.evTarget,this.domHandler),this.evWin&&c(P(this.element),this.evWin,this.domHandler)}};var Re={mousedown:Ee,mousemove:fe,mouseup:Te},ke="mousedown",We="mousemove mouseup";l(W,_,{handler:function(e){var t=Re[e.type];t&Ee&&0===e.button&&(this.pressed=!0),t&fe&&1!==e.which&&(t=Te),this.pressed&&(t&Te&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:ce,srcEvent:e}))}});var Ke={pointerdown:Ee,pointermove:fe,pointerup:Te,pointercancel:Ce,pointerout:Ce},Ne={2:ge,3:"pen",4:ce,5:"kinect"},Le="pointerdown",be="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Le="MSPointerDown",be="MSPointerMove MSPointerUp MSPointerCancel"),l(K,_,{handler:function(e){var t=this.store,i=!1,n=e.type.toLowerCase().replace("ms",""),s=Ke[n],a=Ne[e.pointerType]||e.pointerType,r=a==ge,o=T(t,e.pointerId,"pointerId");s&Ee&&(0===e.button||r)?0>o&&(t.push(e),o=t.length-1):s&(Te|Ce)&&(i=!0),0>o||(t[o]=e,this.callback(this.manager,s,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),i&&t.splice(o,1))}});var Be={touchstart:Ee,touchmove:fe,touchend:Te,touchcancel:Ce},xe="touchstart",Me="touchstart touchmove touchend touchcancel";l(N,_,{handler:function(e){var t=Be[e.type];if(t===Ee&&(this.started=!0),this.started){var i=function(e,t){var i=C(e.touches),n=C(e.changedTouches);return t&(Te|Ce)&&(i=m(i.concat(n),"identifier",!0)),[i,n]}.call(this,e,t);t&(Te|Ce)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:ge,srcEvent:e})}}});var we={touchstart:Ee,touchmove:fe,touchend:Te,touchcancel:Ce},Ve="touchstart touchmove touchend touchcancel";l(L,_,{handler:function(e){var t=we[e.type],i=function(e,t){var i=C(e.touches),n=this.targetIds;if(t&(Ee|fe)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var s,a,r=C(e.changedTouches),o=[],l=this.target;if(a=i.filter(function(e){return p(e.target,l)}),t===Ee)for(s=0;s<a.length;)n[a[s].identifier]=!0,s++;for(s=0;s<r.length;)n[r[s].identifier]&&o.push(r[s]),t&(Te|Ce)&&delete n[r[s].identifier],s++;return o.length?[m(a.concat(o),"identifier",!0),o]:void 0}.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:ge,srcEvent:e})}});var Fe=2500,He=25;l(b,_,{handler:function(e,t,i){var n=i.pointerType==ge,s=i.pointerType==ce;if(!(s&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)(function(e,t){e&Ee?(this.primaryTouch=t.changedPointers[0].identifier,B.call(this,t)):e&(Te|Ce)&&B.call(this,t)}).call(this,t,i);else if(s&&function(e){for(var t=e.srcEvent.clientX,i=e.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var s=this.lastTouches[n],a=Math.abs(t-s.x),r=Math.abs(i-s.y);if(He>=a&&He>=r)return!0}return!1}.call(this,i))return;this.callback(e,t,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ue=v(te.style,"touchAction"),Ge=Ue!==n,ze="compute",je="auto",Xe="manipulation",Ye="none",$e="pan-x",Je="pan-y",qe=function(){if(!Ge)return!1;var t={},i=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=!i||e.CSS.supports("touch-action",n)}),t}();x.prototype={set:function(e){e==ze&&(e=this.compute()),Ge&&this.manager.element.style&&qe[e]&&(this.manager.element.style[Ue]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return r(this.manager.recognizers,function(t){d(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(E(e,Ye))return Ye;var t=E(e,$e),i=E(e,Je);return t&&i?Ye:t||i?t?$e:Je:E(e,Xe)?Xe:je}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,i=e.offsetDirection;if(!this.manager.session.prevented){var n=this.actions,s=E(n,Ye)&&!qe[Ye],a=E(n,Je)&&!qe[Je],r=E(n,$e)&&!qe[$e];if(s){var o=1===e.pointers.length,l=e.distance<2,u=e.deltaTime<250;if(o&&l&&u)return}return r&&a?void 0:s||a&&i&Se||r&&i&Oe?this.preventSrc(t):void 0}t.preventDefault()},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ze=1,Qe=2,et=4,tt=8,it=tt,nt=16;M.prototype={defaults:{},set:function(e){return Q(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(a(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=F(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return a(e,"dropRecognizeWith",this)?this:(e=F(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(a(e,"requireFailure",this))return this;var t=this.requireFail;return-1===T(t,e=F(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(a(e,"dropRequireFailure",this))return this;e=F(e,this);var t=T(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){i.manager.emit(t,e)}var i=this,n=this.state;tt>n&&t(i.options.event+w(n)),t(i.options.event),e.additionalEvent&&t(e.additionalEvent),n>=tt&&t(i.options.event+w(n))},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=32)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|Ze)))return!1;e++}return!0},recognize:function(e){var t=Q({},e);return d(this.options.enable,[this,t])?(this.state&(it|nt|32)&&(this.state=Ze),this.state=this.process(t),void(this.state&(Qe|et|tt|nt)&&this.tryEmit(t))):(this.reset(),void(this.state=32))},process:function(e){},getTouchAction:function(){},reset:function(){}},l(H,M,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,n=t&(Qe|et),s=this.attrTest(e);return n&&(i&Ce||!s)?t|nt:n||s?i&Te?t|tt:t&Qe?t|et:Qe:32}}),l(U,H,{defaults:{event:"pan",threshold:10,pointers:1,direction:De},getTouchAction:function(){var e=this.options.direction,t=[];return e&Se&&t.push(Je),e&Oe&&t.push($e),t},directionTest:function(e){var t=this.options,i=!0,n=e.distance,s=e.direction,a=e.deltaX,r=e.deltaY;return s&t.direction||(t.direction&Se?(s=0===a?me:0>a?ve:Pe,i=a!=this.pX,n=Math.abs(e.deltaX)):(s=0===r?me:0>r?_e:ye,i=r!=this.pY,n=Math.abs(e.deltaY))),e.direction=s,i&&n>t.threshold&&s&t.direction},attrTest:function(e){return H.prototype.attrTest.call(this,e)&&(this.state&Qe||!(this.state&Qe)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=V(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),l(G,H,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ye]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&Qe)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),l(z,M,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[je]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,a=e.deltaTime>t.time;if(this._input=e,!n||!i||e.eventType&(Te|Ce)&&!a)this.reset();else if(e.eventType&Ee)this.reset(),this._timer=s(function(){this.state=it,this.tryEmit()},t.time,this);else if(e.eventType&Te)return it;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===it&&(e&&e.eventType&Te?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=ae(),this.manager.emit(this.options.event,this._input)))}}),l(j,H,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ye]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&Qe)}}),l(X,H,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Se|Oe,pointers:1},getTouchAction:function(){return U.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return i&(Se|Oe)?t=e.overallVelocity:i&Se?t=e.overallVelocityX:i&Oe&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&i&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&se(t)>this.options.velocity&&e.eventType&Te},emit:function(e){var t=V(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),l(Y,M,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Xe]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,a=e.deltaTime<t.time;if(this.reset(),e.eventType&Ee&&0===this.count)return this.failTimeout();if(n&&a&&i){if(e.eventType!=Te)return this.failTimeout();var r=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||R(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,o&&r?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=s(function(){this.state=it,this.tryEmit()},t.interval,this),Qe):it}return 32},failTimeout:function(){return this._timer=s(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==it&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),$.VERSION="2.0.8",$.defaults={domEvents:!1,touchAction:ze,enable:!0,inputTarget:null,inputClass:null,preset:[[j,{enable:!1}],[G,{enable:!1},["rotate"]],[X,{direction:Se}],[U,{direction:Se},["swipe"]],[Y],[Y,{event:"doubletap",taps:2},["tap"]],[z]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};J.prototype={set:function(e){return Q(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var i,n=this.recognizers,s=t.curRecognizer;(!s||s&&s.state&it)&&(s=t.curRecognizer=null);for(var a=0;a<n.length;)i=n[a],2===t.stopped||s&&i!=s&&!i.canRecognizeWith(s)?i.reset():i.recognize(e),!s&&i.state&(Qe|et|tt)&&(s=t.curRecognizer=i),a++}},get:function(e){if(e instanceof M)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(a(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(a(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,i=T(t,e);-1!==i&&(t.splice(i,1),this.touchAction.update())}return this},on:function(e,t){if(e!==n&&t!==n){var i=this.handlers;return r(f(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this}},off:function(e,t){if(e!==n){var i=this.handlers;return r(f(e),function(e){t?i[e]&&i[e].splice(T(i[e],t),1):delete i[e]}),this}},emit:function(e,t){this.options.domEvents&&Z(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](t),n++}},destroy:function(){this.element&&q(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},Q($,{INPUT_START:Ee,INPUT_MOVE:fe,INPUT_END:Te,INPUT_CANCEL:Ce,STATE_POSSIBLE:Ze,STATE_BEGAN:Qe,STATE_CHANGED:et,STATE_ENDED:tt,STATE_RECOGNIZED:it,STATE_CANCELLED:nt,STATE_FAILED:32,DIRECTION_NONE:me,DIRECTION_LEFT:ve,DIRECTION_RIGHT:Pe,DIRECTION_UP:_e,DIRECTION_DOWN:ye,DIRECTION_HORIZONTAL:Se,DIRECTION_VERTICAL:Oe,DIRECTION_ALL:De,Manager:J,Input:_,TouchAction:x,TouchInput:L,MouseInput:W,PointerEventInput:K,TouchMouseInput:b,SingleTouchInput:N,Recognizer:M,AttrRecognizer:H,Tap:Y,Pan:U,Swipe:X,Pinch:G,Rotate:j,Press:z,on:g,off:c,each:r,merge:oe,extend:re,assign:Q,inherit:l,bindFn:u,prefixed:v}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=$,"function"==typeof define&&define.amd?define(function(){return $}):"undefined"!=typeof module&&module.exports?module.exports=$:e.Hammer=$}(window,document),Kekule.Operation=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Operation",initialize:function($super){$super()},initProperties:function(){},isReversible:function(){return!0},execute:function(){return this.doExecute()},doExecute:function(){},reverse:function(){return this.isReversible()||Kekule.raise(Kekule.$L("ErrorMsg.COMMAND_NOT_REVERSIBLE")),this.doReverse()},doReverse:function(){}}),Kekule.Operation.State={UNEXECUTED:0,EXECUTED:1},Kekule.MacroOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.MacroOperation",initialize:function($super,e){$super(),this.setChildren(e||[])},initProperties:function(){this.defineProp("children",{dataType:DataType.ARRAY})},isReversible:function(){for(var e=this.getChildren(),t=0,i=e.length;t<i;++t)if(!e[t].isReversible())return!1;return!0},doExecute:function(){for(var e=this.getChildren(),t=0,i=e.length;t<i;++t)e[t].execute()},doReverse:function(){for(var e=this.getChildren(),t=e.length-1;t>=0;--t)e[t].reverse()},add:function(e){return this.getChildren().push(e)},remove:function(e){var t=this.getChildren(),i=t.indexOf(e);return i>=0?t.splice(i,1):null},getChildAt:function(e){return this.getChildren()[e]},getChildCount:function(){return this.getChildren().length}}),Kekule.OperationHistory=Class.create(ObjectEx,{CLASS_NAME:"Kekule.OperationHistory",initialize:function($super,e){$super(),this.setCapacity(e||null)},initProperties:function(){this.defineProp("capacity",{dataType:DataType.INT}),this.defineProp("operations",{dataType:DataType.ARRAY,getter:function(){var e=this.getPropStoreFieldValue("operations");return e||(e=[],this.setPropStoreFieldValue("operations",e)),e}}),this.defineProp("currIndex",{dataType:DataType.INT,serializable:!1}),this.defineEvent("push"),this.defineEvent("pop"),this.defineEvent("undo"),this.defineEvent("redo")},checkCapacity:function(){var e=this.getCapacity();if(e&&!(e<=0))for(var t=this.getPropStoreFieldValue("operations");t&&t.length>e;)t.shift(),this.getCurrIndex()>0&&this.setCurrIndex(this.getCurrIndex()-1)},getOperationCount:function(){return this.getOperations().length},getOperationAt:function(e){return this.getOperations()[e]},getCurrOperation:function(){var e=this.getCurrIndex();return e>=0?this.getOperations()[e]:null},clear:function(){this.setOperations([]),this.setCurrIndex(-1),this.invokeEvent("clear",{currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")},push:function(e){var t=this.getOperations(),i=this.getCurrIndex();i<t.length&&t.splice(i+1,t.length-i-1),t.push(e),this.setCurrIndex(t.length-1),this.checkCapacity(),this.invokeEvent("push",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")},pop:function(){var e,t=this.getCurrIndex();return this.canPop()?(e=this.getOperations()[t],this.setCurrIndex(--t),this.invokeEvent("pop",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")):e=null,e},canPop:function(){return this.getCurrIndex()>=0&&!!this.getOperations().length},unpop:function(){var e,t=this.getCurrIndex();this.getOperations();return this.canUnpop()?(this.setCurrIndex(++t),e=this.getOperations()[t]):e=null,e},canUnpop:function(){return this.getCurrIndex()<this.getOperations().length-1},undo:function(){var e=this.pop();return e&&e.isReversible()&&e.reverse(),this.invokeEvent("undo",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange"),e},undoAll:function(){for(;this.canUndo;)this.undo()},canUndo:function(){return this.canPop()},redo:function(){var e=this.unpop();return e&&e.execute(),this.invokeEvent("redo",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange"),e},canRedo:function(){return this.canUnpop()}}),function(){Kekule.Action=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Action",HTML_CLASSNAME:null,initialize:function($super){$super(),this.setPropStoreFieldValue("linkedWidgets",[]),this.setPropStoreFieldValue("enabled",!0),this.setPropStoreFieldValue("visible",!0),this.setPropStoreFieldValue("displayed",!0),this.setPropStoreFieldValue("htmlClassName",this.getInitialHtmlClassName()),this.setBubbleEvent(!0),this.reactWidgetExecuteBind=this.reactWidgetExecute.bind(this)},finalize:function($super){var e=this.getOwner();e&&e.actionRemoved&&e.actionRemoved(this),this.unlinkAllWidgets(),this.setPropStoreFieldValue("linkedWidgets",[]),$super()},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnabled()&&(this.setPropStoreFieldValue("enabled",e),this.updateAllWidgetsProp("enabled",e))}}),this.defineProp("visible",{dataType:DataType.BOOL,setter:function(e){e!==this.getVisible()&&(this.setPropStoreFieldValue("visible",e),this.updateAllWidgetsProp("visible",e))}}),this.defineProp("displayed",{dataType:DataType.BOOL,setter:function(e){e!==this.getDisplayed()&&(this.setPropStoreFieldValue("displayed",e),this.updateAllWidgetsProp("displayed",e))}}),this.defineProp("checked",{dataType:DataType.BOOL,setter:function(e){e!==this.getChecked()&&(this.setPropStoreFieldValue("checked",e),this.updateAllWidgetsProp("checked",e),this.checkedChanged())}}),this.defineProp("checkGroup",{dataType:DataType.STRING}),this.defineProp("hint",{dataType:DataType.STRING,setter:function(e){e&&e!==this.getHint()&&(this.setPropStoreFieldValue("hint",e),this.updateAllWidgetsProp("hint",e))}}),this.defineProp("text",{dataType:DataType.STRING,setter:function(e){e&&e!==this.getText()&&(this.setPropStoreFieldValue("text",e),this.updateAllWidgetsProp("text",e))}}),this.defineProp("htmlClassName",{dataType:DataType.STRING,setter:function(e){var t=this.getHtmlClassName();this.setPropStoreFieldValue("htmlClassName",e),this.updateAllWidgetClassName(e,t)}}),this.defineProp("owner",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("linkedWidgets",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("invoker",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},getHigherLevelObj:function(){return this.getOwner()},invokeEvent:function($super,e,t){t||(t={}),t.invoker||(t.invoker=this.getInvoker()),$super(e,t)},getInitialHtmlClassName:function(){return this.HTML_CLASSNAME||null},getActionList:function(){var e=this.getOwner();return e instanceof Kekule.ActionList?e:null},checkedChanged:function(){var e=this.getActionList();e&&e.actionCheckedChanged(this)},linkWidget:function(e){var t=this.getLinkedWidgets();if(t.indexOf(e)<0){var i=this.getText();i&&this.updateWidgetProp(e,"text",i);var n=this.getHint();return n&&this.updateWidgetProp(e,"hint",n),this.updateWidgetProp(e,"enabled",this.getEnabled()),this.updateWidgetProp(e,"displayed",this.getDisplayed()),this.updateWidgetProp(e,"visible",this.getVisible()),this.updateWidgetProp(e,"checked",this.getChecked()),this.updateWidgetClassName(e,this.getHtmlClassName(),null),e.addEventListener("execute",this.reactWidgetExecuteBind),t.push(e),this}},unlinkWidget:function(e){var t=this.getLinkedWidgets(),i=t.indexOf(e);i>=0&&(this.updateWidgetClassName(e,null,this.getHtmlClassName()),e.removeEventListener("execute",this.reactWidgetExecuteBind),t.splice(i,1))},unlinkAllWidgets:function(){for(var e=this.getLinkedWidgets(),t=e.length-1;t>=0;--t)this.unlinkWidget(e[t])},reactWidgetExecute:function(e){return this.execute(e.target,e.htmlEvent)},execute:function(e,t){var i=this.getChecked();return this.getCheckGroup()&&i||(this.doExecute(e,t),this.getCheckGroup()&&this.setChecked(!0)),this.setPropStoreFieldValue("invoker",e),this.invokeEvent("execute",{htmlEvent:t}),this},doExecute:function(e,t){},update:function(){return this.doUpdate(),this},doUpdate:function(){},updateAllWidgetsProp:function(e,t){for(var i=this.getLinkedWidgets(),n=0,s=i.length;n<s;++n){var a=i[n];this.updateWidgetProp(a,e,t)}},updateWidgetProp:function(e,t,i){e.hasProperty(t)&&e.setPropValue(t,i)},updateWidgetClassName:function(e,t,i){i&&e.removeClassName(i,!0),t&&e.addClassName(t,!0)},updateAllWidgetClassName:function(e,t){for(var i=this.getLinkedWidgets(),n=0,s=i.length;n<s;++n){var a=i[n];this.updateWidgetClassName(a,e,t)}}}),Kekule.ActionList=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ActionList",initialize:function($super){$super(),this.setPropStoreFieldValue("actions",[]),this.setPropStoreFieldValue("ownActions",!0),this.setPropStoreFieldValue("autoUpdate",!0),this.reactActionExecutedBind=this.reactActionExecuted.bind(this),this.addEventListener("execute",this.reactActionExecutedBind)},finalize:function($super){this.removeEventListener("execute",this.reactActionExecutedBind),this.clear(),this.setPropStoreFieldValue("actions",null),$super()},initProperties:function(){this.defineProp("actions",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("ownActions",{dataType:DataType.BOOL}),this.defineProp("autoUpdate",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoUpdate",e),e&&this.updateAll()}})},hasActionChecked:function(e){return!!this.getCheckedAction(e)},getCheckedAction:function(e){for(var t=this.getActions(),i=0,n=t.length;i<n;++i){var s=t[i];if(s.getCheckGroup()===e&&s.getChecked())return s}return null},actionAdded:function(e){if(this.getOwnActions()){var t=e.getOwner();t&&t.actionRemoved&&t.actionRemoved(e),e.setPropStoreFieldValue("owner",this)}Kekule.ArrayUtils.pushUnique(this.getActions(),e),e.update()},actionRemoved:function(e){Kekule.ArrayUtils.remove(this.getActions(),e),e.setPropStoreFieldValue("owner",null)},actionCheckedChanged:function(e){if(e&&e.getChecked()){var t=e.getCheckGroup();if(t)for(var i=this.getActions(),n=0,s=i.length;n<s;++n){var a=i[n];a!==e&&a.getCheckGroup()===t&&a.getChecked()&&a.setChecked(!1)}}},reactActionExecuted:function(e){e.target instanceof Kekule.Action&&(this.invokeEvent("execute",{action:e.target}),this.getAutoUpdate()&&this.updateAll())},getActionCount:function(){return this.getActions().length},getActionLength:function(){return this.getActions().length},getActionAt:function(e){return this.getActions()[e]},indexOfAction:function(e){return this.getActions().indexOf(e)},setActionIndex:function(e,t){var i=this.getActions();if(i){var n=i.indexOf(e);n>=0&&n!==t&&(i.splice(n,1),i.splice(t,0,e))}return this},hasAction:function(e){return this.indexOfAction(e)>=0},add:function(e){return this.actionAdded(e),this},remove:function(e){return this.actionRemoved(e),this.getOwnActions()&&e.finalize(),this},removeAt:function(e){var t=this.getActions(),i=t[e];return i&&(Kekule.ArrayUtils.removeAt(t,e),this.actionRemoved(i)),this},clear:function(){for(var e=this.getActions(),t=e.length-1;t>=0;--t)this.actionRemoved(e[t]);return this.setPropStoreFieldValue("actions",[]),this},updateAll:function(){for(var e=this.getActions(),t=0,i=e.length;t<i;++t)e[t].update();return this}}),Kekule.ActionFileOpen=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileOpen",initialize:function($super){$super()},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function($super){$super(),this.setEnabled(this.getEnabled()&&Kekule.NativeServices.showFilePickerDialog)},doExecute:function(e){var t=e.getElement().ownerDocument,i=this,n=this.getInvoker();this.openFilePicker(t,function(e,t,s){e&&i.fileOpened(s,n)})},openFilePicker:function(e,t){return Kekule.NativeServices.showFilePickerDialog(e,t,{mode:"open",filters:this.getFilters()})},fileOpened:function(e,t){this.doFileOpened(e,t),this.invokeEvent("open",{files:e,file:e[0]})},doFileOpened:function(e,t){}}),Kekule.ActionLoadFileData=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionLoadFileData",initialize:function($super){$super()},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY}),this.defineProp("binaryDetector",{dataType:DataType.FUNCTION,serializable:!1})},doUpdate:function($super){$super(),this.setEnabled(this.getEnabled()&&Kekule.NativeServices.canLoadFileData())},doExecute:function(e){var t=e.getElement().ownerDocument,i=this,n=this.getInvoker();this.loadFileData(t,function(e,t,s){i.dataLoaded(t,s,!!e,n)})},loadFileData:function(e,t){return Kekule.NativeServices.loadFileData(e,t,{filters:this.getFilters(),binaryDetector:this.getBinaryDetector()})},reactFileLoad:function(e,t,i){this.dataLoaded(t,i,!!e)},dataLoaded:function(e,t,i,n){this.doDataLoaded(e,t,i,n),this.invokeEvent("load",{fileName:t,data:e,success:i})},doDataLoaded:function(e,t,i,n){}}),Kekule.ActionFileSave=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileSave",initialize:function($super,e,t){$super(),e&&this.setData(e),t&&this.setFileName(t)},initProperties:function(){this.defineProp("data",{dataType:DataType.STRING,serializable:!1}),this.defineProp("fileName",{dataType:DataType.STRING,serializable:!1}),this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function($super){$super(),this.setEnabled(this.getEnabled()&&Kekule.NativeServices.canSaveFileData())},doExecute:function(e){var t;e?t=e.getElement().ownerDocument:t=document;Kekule.NativeServices.saveFileData(t,this.getData(),null,{initialFileName:this.getFileName(),filters:this.getFilters()})}}),Kekule.ActionManager={_namedActionMap:null,_getNamedActionMap:function(t){var i=e._namedActionMap;return!i&&t&&(i=new Kekule.MapEx,e._namedActionMap=i),i},getRegisteredActionsOfClass:function(t,i){var n=e._getNamedActionMap(i);if(n){var s=n.get(t);return!s&&i&&(s={},n.set(t,s)),s}return null},registerNamedActionClass:function(t,i,n){e.getRegisteredActionsOfClass(n,!0)[t]=i},unregisterNamedActionClass:function(t,i){var n=e.getRegisteredActionsOfClass(i,!1);n&&n[t]&&delete n[t]},getActionClassOfName:function(t,i,n){var s=ClassEx.isClass(i)?i:i.getClass&&i.getClass();if(!s)return null;var a=e.getRegisteredActionsOfClass(s,!1),r=a&&a[t];if(!r&&n){var o=ClassEx.getSuperClass(s);r=o?e.getActionClassOfName(t,o,n):null}return r}};var e=Kekule.ActionManager}(),function(){"use strict";Kekule.DataBingItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DataBingItem",initialize:function($super,e,t,i,n){$super(),this.setSource(e),this.setSourceName(t),this.setTarget(i),this.setTargetName(n)},initProperties:function(){this.defineProp("source",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("sourceName",{dataType:DataType.STRING,serializable:!1}),this.defineProp("target",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("targetName",{dataType:DataType.STRING,serializable:!1})},updateData:function(e){var t=this.getSource(),i=this.getTarget(),n=this.getSourceName(),s=this.getTargetName();if(t&&i&&n&&s)if(e){var a=i.getDataByBindingName(s);t.setDataByBindingName(n,a)}else{a=t.getDataByBindingName(n);i.setDataByBindingName(s,a)}}}),ClassEx.extend(ObjectEx,{getDataByBindingName:function(e){return this.hasProperty(e)?this.getPropValue(e):DataType.isFunctionValue(this[e])?this[e]():void 0},setDataByBindingName:function(e,t){var i=t,n=this.getPropInfo(e);if(n){var s=n.dataType,a=DataType.getType(t);s!==a&&a===DataType.STRING&&(i=DataType.StringUtils.deserializeValue(t))}return this.setPropValue(e,i),this},createDataBinding:function(e,t,i){var n=new Kekule.DataBingItem(e,t,this,i);return this.getDataBindings(!0).push(n),n},removeDataBinding:function(e){Kekule.ArrayUtils.remove(this.getDataBindings(),e)},updateBindingData:function(e){var t=this.getDataBindings();if(t&&t.length)for(var i=0,n=t.length;i<n;++i)t[i].updateData(e)}}),ClassEx.defineProp(ObjectEx,"dataBindings",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,getter:function(e){var t=this.getPropStoreFieldValue("dataBindings");return!t&&e&&(t=[],this.setPropStoreFieldValue("dataBindings",t)),t}})}(),function(){var e=Kekule.ArrayUtils,t=Kekule.HtmlElementUtils;Kekule.Widget={DEF_EVENT_HANDLER_PREFIX:"react_",getEventHandleFuncName:function(e){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+e},getTouchGestureHandleFuncName:function(e){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+e}},Kekule.Widget.HtmlClassNames={BASE:"K-Widget",DYN_CREATED:"K-Dynamic-Created",ISOLATED_LAYER:"K-Isolated-Layer",NORMAL_BACKGROUND:"K-Normal-Background",NONSELECTABLE:"K-NonSelectable",SELECTABLE:"K-Selectable",STATE_NORMAL:"K-State-Normal",STATE_DISABLED:"K-State-Disabled",STATE_HOVER:"K-State-Hover",STATE_ACTIVE:"K-State-Active",STATE_FOCUSED:"K-State-Focused",STATE_SELECTED:"K-State-Selected",STATE_CHECKED:"K-State-Checked",SHOW_POPUP:"K-Show-Popup",SHOW_DIALOG:"K-Show-Dialog",SHOW_ACTIVE_MODAL:"K-Show-ActiveModal",SECTION:"K-Section",PART_CONTENT:"K-Content",PART_TEXT_CONTENT:"K-Text-Content",PART_ASSOC_TEXT_CONTENT:"K-Assoc-Text-Content",PART_IMG_CONTENT:"K-Img-Content",PART_GLYPH_CONTENT:"K-Glyph-Content",PART_PRI_GLYPH_CONTENT:"K-Pri-Glyph-Content",PART_ASSOC_GLYPH_CONTENT:"K-Assoc-Glyph-Content",PART_DECORATION_CONTENT:"K-Decoration-Content",PART_ERROR_REPORT:"K-Error-Report",FIRST_CHILD:"K-First-Child",LAST_CHILD:"K-Last-Child",TEXT_NO_WRAP:"K-No-Wrap",LAYOUT_H:"K-Layout-H",LAYOUT_V:"K-Layout-V",CORNER_ALL:"K-Corner-All",CORNER_LEFT:"K-Corner-Left",CORNER_RIGHT:"K-Corner-Right",CORNER_TOP:"K-Corner-Top",CORNER_BOTTOM:"K-Corner-Bottom",CORNER_TL:"K-Corner-TL",CORNER_TR:"K-Corner-TR",CORNER_BL:"K-Corner-BL",CORNER_BR:"K-Corner-BR",CORNER_LEADING:"K-Corner-Leading",CORNER_TAILING:"K-Corner-Tailing",FULLFILL:"K-Fulfill",NOWRAP:"K-No-Wrap",HIDE_TEXT:"K-Text-Hide",HIDE_GLYPH:"K-Glyph-Hide",SHOW_TEXT:"K-Text-Show",SHOW_GLYPH:"K-Glyph-Show",MODAL_BACKGROUND:"K-Modal-Background",DUMB_WIDGET:"K-Dumb-Widget",PLACEHOLDER:"K-PlaceHolder"};var i=Kekule.Widget.HtmlClassNames;Kekule.Widget.Layout={HORIZONTAL:1,VERTICAL:2},Kekule.Widget.Position={AUTO:0,TOP:1,LEFT:2,BOTTOM:4,RIGHT:8,TOP_LEFT:3,TOP_RIGHT:9,BOTTOM_LEFT:6,BOTTOM_RIGHT:12},Kekule.Widget.Direction={AUTO:0,LTR:1,TTB:2,RTL:4,BTT:8,isInHorizontal:function(e){var t=Kekule.Widget.Direction;return!!(e&t.LTR||e&t.RTL)},isInVertical:function(e){var t=Kekule.Widget.Direction;return!!(e&t.TTB||e&t.BTT)}},Kekule.Widget.State={NORMAL:0,FOCUSED:1,HOVER:2,ACTIVE:3,DISABLED:-1};var n=Kekule.Widget.State;Kekule.Widget.ShowHideType={DROPDOWN:1,POPUP:2,DIALOG:3,DEFAULT:0},Kekule.Widget.DragDrop={ELEM_INDEX_DATA_TYPE:"application/x-kekule-dragdrop-elem-index"},Kekule.Widget.UiEvents=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","keydown","keyup","keypress","touchstart","touchend","touchcancel","touchmove","pointerdown","pointermove","pointerout","pointerover","pointerup","drag","dragend","dragenter","dragexit","dragleave","dragover","dragstart","drop"],Kekule.Widget.UiLocalEvents=["blur","focus","mouseenter","mouseleave","mousewheel","pointerenter","pointerleave"],Kekule.Widget.TouchGestures=["hold","tap","doubletap","swipe","swipeup","swipedown","swipeleft","swiperight","transform","transformstart","transformend","rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout","pan","panstart","panmove","panend","pancancel","panleft","panright","panup","pandown"],Kekule.Widget._PointerHoldParams={DURATION_THRESHOLD:1e3,MOVEMENT_THRESHOLD:10};Kekule.Widget.BaseWidget=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget",BINDABLE_TAG_NAMES:null,DEF_PERIODICAL_EXEC_DELAY:500,DEF_PERIODICAL_EXEC_INTERVAL:100,STYLE_RES_FIELD:"__$style_resources__",initialize:function($super,e,t){this._stateClassName=null,this._isDismissed=!1,this._pendingHtmlClassNames="",this._enableShowHideEvents=!0,this._reactElemAttribMutationBind=this._reactElemAttribMutation.bind(this),this.reactTouchGestureBind=this.reactTouchGesture.bind(this),this.setPropStoreFieldValue("inheritEnabled",!0),this.setPropStoreFieldValue("inheritStatic",!0),this.setPropStoreFieldValue("selfEnabled",!0),this.setPropStoreFieldValue("selfStatic",!1),this.setPropStoreFieldValue("periodicalExecDelay",this.DEF_PERIODICAL_EXEC_DELAY),this.setPropStoreFieldValue("periodicalExecInterval",this.DEF_PERIODICAL_EXEC_INTERVAL),this.setPropStoreFieldValue("useNormalBackground",!0),this.setPropStoreFieldValue("droppableDataKinds",["string"]),this._touchActionNoneTouchStartHandlerBind=this._touchActionNoneTouchStartHandler.bind(this),$super(),this.setPropStoreFieldValue("isDumb",!!t),t||(this.reactUiEventBind=this.reactUiEvent.bind(this)),e&&(e instanceof Kekule.Widget.BaseWidget?(this.setDocument(e.getDocument()),this.createElement(),this.setParent(e)):e.documentElement?(this.setDocument(e),this.createElement()):(this.setDocument(e.ownerDocument),this.setElement(e))),this._stateClassName=null,this._layoutClassName=null,this.getLayout()||this.setLayout(Kekule.Widget.Layout.HORIZONTAL),this._periodicalExecBind=this._periodicalExec.bind(this),this.setBubbleEvent(!0),this.setInheritBubbleUiEvents(!0),this.stateChanged();var i=this.getGlobalManager();i&&i.notifyWidgetCreated(this)},initProperties:function(){this.defineProp("isDumb",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){if(this.getIsDumb()!=e){this.setPropStoreFieldValue("isDumb",e);var t=this.getElement();t&&(e?this.uninstallUiEventHandlers(t):this.installUiEventHandlers(t))}}}),this.defineProp("bubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("inheritBubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("touchAction",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getCoreElement();t&&(t.style.touchAction=e,"none"===e?Kekule.X.Event.addListener(t,"touchstart",this._touchActionNoneTouchStartHandlerBind,{passive:!1}):Kekule.X.Event.removeListener(t,"touchstart",this._touchActionNoneTouchStartHandlerBind,{passive:!1}))}}),this.defineProp("parent",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=this.getParent();t&&t._removeChild(this),e&&e._addChild(this),this.setPropStoreFieldValue("parent",e)}}),this.defineProp("childWidgets",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("childWidgets");return e||(e=[],this.setPropStoreFieldValue("childWidgets",e)),e}}),this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("element",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getElement();e!==t&&(this.setPropStoreFieldValue("element",e),this.elementChanged(e,t))}}),this.defineProp("observeElementAttribChanges",{dataType:DataType.BOOL,setter:function(e){!!e!=!!this.getObserveElementAttribChanges()&&(this.setPropStoreFieldValue("observeElementAttribChanges",e),this.observeElementAttribChangesChanged(!!e))}}),this.defineElemAttribMappingProp("id","id"),this.defineProp("draggable",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return Kekule.StrUtils.strToBool(this.getElement().getAttribute("draggable")||"")},setter:function(e){this.getElement().setAttribute("draggable",e?"true":"false")}}),this.defineProp("droppable",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("droppableDataKinds",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("fileDroppable",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){if(!this.getDroppable())return!1;var e=this.getDroppableDataKinds();return!e||e&&e.indexOf&&e.indexOf("file")>=0},setter:function(e){e&&!this.getDroppable()&&this.setDroppable(!0);var t=this.getPropStoreFieldValue("droppableDataKinds");if(t){var i=t.indexOf("file");!e&&i>=0?t.splice(i,1):e&&i<0&&t.push("file")}else e||this.setDroppableDataKinds(["string"])}}),this.defineElemStyleMappingProp("width","width"),this.defineElemStyleMappingProp("height","height"),this.defineProp("offsetParent",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().offsetParent},setter:null}),this.defineProp("offsetLeft",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetLeft},setter:null}),this.defineProp("offsetTop",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetTop},setter:null}),this.defineProp("offsetWidth",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetWidth},setter:null}),this.defineProp("offsetHeight",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetHeight},setter:null}),this.defineProp("innerHTML",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().innerHTML},setter:function(e){this.getElement().innerHTML=e}}),this.defineProp("style",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style},setter:null}),this.defineProp("cssText",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style.cssText},setter:function(e){this.getElement().style.cssText=e}}),this.defineProp("htmlClassName",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().className},setter:function(e){this.getElement().className=e}}),this.defineProp("customHtmlClassName",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(e){var i=this.getElement(),n=this.getCustomHtmlClassName();i&&n!==e&&(n&&t.removeClass(i,n),e&&t.addClass(i,e),this.setPropStoreFieldValue("customHtmlClassName",e))}}),this.defineProp("visible",{dataType:DataType.BOOL,serializable:!1,getter:function(){return Kekule.StyleUtils.isVisible(this.getElement())},setter:function(e,t){Kekule.StyleUtils.setVisibility(this.getElement(),e),t||this.widgetShowStateChanged(this.isShown())}}),this.defineProp("displayed",{dataType:DataType.BOOL,serializable:!1,getter:function(){return Kekule.StyleUtils.isDisplayed(this.getElement())},setter:function(e,t){Kekule.StyleUtils.setDisplay(this.getElement(),e),t||this.widgetShowStateChanged(this.isShown())}}),this.defineProp("showHideType",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showHideCaller",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showHideCallerPageRect",{dataType:DataType.HASH,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("finalizeAfterHiding",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("layout",{dataType:DataType.INT,setter:function(e){this.getPropStoreFieldValue("layout")!==e&&(this.setPropStoreFieldValue("layout",e),this.layoutChanged())}}),this.defineProp("useCornerDecoration",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useCornerDecoration",e),e?this.addClassName(i.CORNER_ALL):this.removeClassName(i.CORNER_ALL)}}),this.defineProp("useNormalBackground",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useNormalBackground",e),e?this.addClassName(i.NORMAL_BACKGROUND):this.removeClassName(i.NORMAL_BACKGROUND)}}),this.defineProp("showText",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showText",e),e?(this.removeClassName(i.HIDE_TEXT),this.addClassName(i.SHOW_TEXT)):(this.addClassName(i.HIDE_TEXT),this.removeClassName(i.SHOW_TEXT))}}),this.defineProp("showGlyph",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showGlyph",e),e?(this.removeClassName(i.HIDE_GLYPH),this.addClassName(i.SHOW_GLYPH)):(this.addClassName(i.HIDE_GLYPH),this.removeClassName(i.SHOW_GLYPH))}}),this.defineProp("allowTextWrap",{dataType:DataType.BOOL,serialzable:!1,setter:function(e){e?this.removeClassName(i.TEXT_NO_WRAP):this.addClassName(i.TEXT_NO_WRAP)}}),this.defineProp("selfEnabled",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("inheritEnabled",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("inheritEnabled",e),this.stateChanged()}}),this.defineProp("enabled",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("selfEnabled");if(this.getInheritEnabled()){var t=this.getParent();t&&(e=e&&t.getEnabled())}return e},setter:function(e){var t=this.getElement();e?t.removeAttribute("disabled"):t.setAttribute("disabled","true"),(t=this.getCoreElement())!=this.getElement()&&(e?t.removeAttribute("disabled"):t.setAttribute("disabled","true")),this.setPropStoreFieldValue("selfEnabled",e),this.stateChanged()}}),this.defineProp("selfStatic",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("inheritStatic",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("inheritStatic",e),this.stateChanged()}}),this.defineProp("static",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("selfStatic");if(this.getInheritStatic()){var t=this.getParent();t&&(e=e||t.getStatic())}return e},setter:function(e){this.setPropStoreFieldValue("selfStatic",e),this.stateChanged()}}),this.defineProp("inheritState",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("inheritState",e),this.stateChanged()}}),this.defineProp("state",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var e;if(this.getInheritState()){var t=this.getParent();t&&(e=t.getState())}else e=this.getEnabled()?this.getIsActive()?n.ACTIVE:this.getIsHover()?n.HOVER:this.getIsFocused()?n.FOCUSED:n.NORMAL:n.DISABLED;return e}}),this.defineProp("cursor",{dataType:DataType.VARIANT,serializable:!1,getter:function(){return this.getStyleProperty("cursor")},setter:function(e){DataType.isArrayValue(e)?Kekule.StyleUtils.setCursor(this.getElement(),e):this.setStyleProperty("cursor",e)}}),this.defineProp("isHover",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("isHover",e),e||this.isCaptureMouse()||this.setPropStoreFieldValue("isActive",!1);var t=this.getGlobalManager();t&&t.notifyWidgetHoverChanged(this,e),this.stateChanged()}}),this.defineProp("isActive",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("isActive",e),e&&this.focus();var t=this.getGlobalManager();t&&t.notifyWidgetActiveChanged(this,e),this.stateChanged()}}),this.defineProp("isFocused",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getDocument(),t=this.getCoreElement();if(e&&t&&e.activeElement)return e.activeElement===t},setter:function(e){this.setPropStoreFieldValue("isFocused",e);var t=this.getGlobalManager();t&&t.notifyWidgetFocusChanged(this,e);var i=this.getCoreElement();i&&(i.focus&&e&&Kekule.HtmlElementUtils.isFormCtrlElement(i)&&i.focus(),i.blur&&!e&&i.blur()),this.stateChanged()}}),this.defineProp("minDimension",{dataType:DataType.HASH}),this.defineProp("enableDimensionTransform",{dataType:DataType.BOOL}),this.defineProp("autoResizeConstraints",{dataType:DataType.HASH,setter:function(e){this.setPropStoreFieldValue("autoResizeConstraints",e);var t=this.getGlobalManager()||Kekule.Widget.globalManager;e?(this.autoResizeToClient(),t.registerAutoResizeWidget(this)):t.unregisterAutoResizeWidget(this)}}),this.defineProp("autoAdjustSizeOnPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("isDialog",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("isPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("popupCaller",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("modalInfo",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC}),this.defineProp("enablePeriodicalExec",{dataType:DataType.BOOL}),this.defineProp("periodicalExecDelay",{dataType:DataType.INT}),this.defineProp("periodicalExecInterval",{dataType:DataType.INT}),this.defineElemAttribMappingProp("hint","title"),this.defineProp("action",{dataType:"Kekule.Action",serializable:!1,setter:function(e){var t=this.getAction();t!==e&&(t&&t.unlinkWidget&&(t.unlinkWidget(this),this.unlinkAction(t)),this.setPropStoreFieldValue("action",e),e&&e.linkWidget&&(e.linkWidget(this),this.linkAction(e)))}}),this.defineProp("iaControllerMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("iaControllerMap");return e||(e=new Kekule.HashEx,this.setPropStoreFieldValue("iaControllerMap",e)),e}}),this.defineProp("defIaControllerId",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("defIaController",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getDefIaControllerId())}}),this.defineProp("activeIaControllerId",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){if(e!==this.getActiveIaControllerId()){this.setPropStoreFieldValue("activeIaControllerId",e);var t=this.getActiveIaController();t&&t.activated&&t.activated(this)}}}),this.defineProp("activeIaController",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getActiveIaControllerId())}}),this.defineProp("observingGestureEvents",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null})},doFinalize:function($super){this.setAction(null),this.setParent(null),this.releaseChildWidgets();var e=this.getElement();this.setElement(null),this.destroyElement(e),this.getGlobalManager()&&this.getGlobalManager().notifyWidgetFinalized(this),$super()},initPropValues:function($super){$super(),this.setEnableObjectChangeEvent(!0)},invokeEvent:function($super,e,t){t||(t={}),t.widget||(t.widget=this),$super(e,t);var i=this.getGlobalManager();i&&i.notifyWidgetEventFired(this,e,t)},getGlobalManager:function(){var e=this.getDocument(),t=e&&Kekule.DocumentUtils.getDefaultView(e),i=t&&t.Kekule;return i||(i=Kekule),i.Widget.globalManager},getCoreElement:function(){return this.getElement()},getChildrenHolderElement:function(){return this.getCoreElement()},getTextSelectable:function(){return!1},canUsePlaceHolderOnElem:function(e){return!1},doPropChanged:function(e,t){"width"!==e&&"height"!==e||this.resized()},getActualBubbleUiEvents:function(){var e=this.getParent();return!!this.getBubbleUiEvents()||(this.getInheritBubbleUiEvents()&&e&&e.getActualBubbleUiEvents?e.getActualBubbleUiEvents():void 0)},releaseChildWidgets:function(){for(var e=this.getChildWidgets(),t=e.length-1;t>=0;--t)e[t].finalize()},defineElemAttribMappingProp:function(e,t,i){var n=Object.extend({dataType:DataType.STRING,serializable:!1,getter:function(){return this.getElement()&&this.getElement().getAttribute(t)},setter:function(e){this.getElement()&&this.getElement().setAttribute(t,e)}},i||{});return this.defineProp(e,n)},defineElemStyleMappingProp:function(e,t,i){var n=Object.extend({dataType:DataType.STRING,serializable:!1,getter:function(){return this.getStyleProperty(t)},setter:function(e){this.setStyleProperty(t,e)}},i||{});return this.defineProp(e,n)},getHigherLevelObj:function(){return this.getParent()},linkAction:function(e){},unlinkAction:function(e){},getChildActionClass:function(e,t){return Kekule.ActionManager.getActionClassOfName(e,this,t)},linkStyleResource:function(e,t){var i=e instanceof Kekule.Widget.StyleResource?e:Kekule.Widget.StyleResourceManager.getResource(e);return i&&i.linkTo(t||this),this},unlinkStyleResource:function(e,t){var i=e instanceof Kekule.Widget.StyleResource?e:Kekule.Widget.StyleResourceManager.getResource(e);return i&&i.unlinkFrom(t||this),this},getStyleProperty:function(e,t){var i=t||this.getElement(),n=i[this.STYLE_RES_FIELD];return n&&n[e]?n[e]:i.style[e]},setStyleProperty:function(e,t,i){var n,s=i||this.getElement();if(s)if(t instanceof Kekule.Widget.StyleResource?n=t:DataType.getType(t)===DataType.STRING&&t.startsWith(Kekule.Widget.StyleResourceNames.PREFIX)&&(n=Kekule.Widget.StyleResourceManager.getResource(t)),n){(r=s[this.STYLE_RES_FIELD])||(r={},s[this.STYLE_RES_FIELD]=r);var a=r[e];a&&this.unlinkStyleResource(a,s),n&&this.linkStyleResource(n,s),r[e]=n}else{var r;s.style[e]=t,(r=s[this.STYLE_RES_FIELD])&&r[e]&&this.unlinkStyleResource(r[e],s)}},removeStyleProperty:function(e,t,i){var n=i||this.getElement();Kekule.StyleUtils.removeStyleProperty(n.style,e)},_addChild:function(e){if(e){var t=this.getChildWidgets();t.indexOf(e)<0&&(t.push(e),this.childWidgetAdded(e),this.childrenModified())}},_insertChild:function(e,t){if(e){var i=this.getChildWidgets(),n=t?i.indexOf(t):i.length;i.indexOf(e)>=0?n>=0&&this._moveChild(e,n):(n<0&&(n=i.length),i.splice(n,0,e),this.childWidgetAdded(e),this.childrenModified())}},_removeChild:function(e){if(e){var t=this.getChildWidgets(),i=t.indexOf(e);if(i>=0){t.splice(i,1);var n=this.getChildrenHolderElement(),s=e.getElement();s&&Kekule.DomUtils.isDescendantOf(s,n)&&s.parentNode.removeChild(s),this.childWidgetRemoved(e),this.childrenModified()}}},_moveChild:function(e,t){e&&Kekule.ArrayUtils.changeItemIndex(this.getChildWidgets(),e,t)&&(this.childWidgetMoved(e,t),this.childrenModified())},childrenModified:function(){},childWidgetAdded:function(e){},childWidgetRemoved:function(e){},childWidgetMoved:function(e,t){},indexOfChild:function(e){return this.getChildWidgets().indexOf(e)},hasChild:function(e){return this.indexOfChild(e)>=0},getChildAtIndex:function(e){return this.getChildWidgets()[e]},getPrevSibling:function(){var e=this.getParent();if(e){var t=e.indexOfChild(this);return this.getChildAtIndex(--t)}return null},getNextSibling:function(){var e=this.getParent();if(e){var t=e.indexOfChild(this);return this.getChildAtIndex(++t)}return null},_haltPrevShowHideProcess:function(){Kekule.Widget.showHideManager&&this.__$showHideTransInfo&&this.__$showHideTransInfo.halt()},_setEnableShowHideEvents:function(e){this._enableShowHideEvents=e},show:function(e,t,i,n){if(this.getElement()&&!this.__$isShowing)return this._haltPrevShowHideProcess(),this.doShow(e,t,i,n),this},doShow:function(e,i,n,s){this.__$isShowing=!0;var a=this,r=function(){a.__$showHideTransInfo=null,a.widgetShowStateDone(!0),a.__$isShowing=!1,i&&i()};this.setShowHideType(n),Kekule.ObjUtils.notUnset(n)&&(this.setIsPopup(n===Kekule.Widget.ShowHideType.DROPDOWN||n===Kekule.Widget.ShowHideType.POPUP),n===Kekule.Widget.ShowHideType.DIALOG?(this.setIsDialog(!0),n=Kekule.Widget.ShowHideType.POPUP):this.setIsDialog(!1)),this.widgetShowStateBeforeChanging(!0);var o=this.getGlobalManager();n!==Kekule.Widget.ShowHideType.DROPDOWN&&n!==Kekule.Widget.ShowHideType.POPUP||o.preparePopupWidget(this,e,n),!Kekule.Widget.showHideManager||s&&s.instantly?(this.setDisplayed(!0,!0),this.setVisible(!0,!0),r()):this.__$showHideTransInfo||(this.__$showHideTransInfo=Kekule.Widget.showHideManager.show(this,e,r,n,s)),this.setShowHideCaller(e),e&&this.setShowHideCallerPageRect(t.getElemBoundingClientRect(e.getElement&&e.getElement()||e)),this.widgetShowStateChanged(!0)},flash:function(e,t,i,n){var s=this;return this.show(t,function(){i&&i(),setTimeout(s.hide.bind(s),e)},n),this},hide:function(e,t,i,n){if(this.getElement()&&!this.__$isHiding)return this.__$isHiding=!0,e||(e=this.getShowHideCaller()),i||(i=this.getShowHideType()),this._haltPrevShowHideProcess(),this.doHide(e,t,i,n),this},doHide:function(e,t,i,n){var s=Object.extend({callerPageRect:this.getShowHideCallerPageRect()},n),a=s.useVisible,r=this,o=this.getFinalizeAfterHiding(),l=function(){r.__$showHideTransInfo=null,r.widgetShowStateDone(!1);var e=r.getGlobalManager();i!==Kekule.Widget.ShowHideType.DROPDOWN&&i!==Kekule.Widget.ShowHideType.POPUP||e.unpreparePopupWidget(r),r.__$isHiding=!1,t&&t(),o&&r.finalize()};this.widgetShowStateBeforeChanging(!1),Kekule.Widget.showHideManager&&!s.instantly?(this.__$showHideTransInfo&&this.__$showHideTransInfo.halt(),this.__$showHideTransInfo||(this.__$showHideTransInfo=Kekule.Widget.showHideManager.hide(this,e,l,i,!1,s))):(a?this.setVisible(!1,!0):this.setDisplayed(!1,!0),l()),this.widgetShowStateChanged(!1)},dismiss:function(e,t,i,n){return this._isDismissed=!0,this.hide(e,t,i,n)},isShown:function(e){return(this.isInDomTree()||e)&&this.getElement()&&this.getVisible()&&this.getDisplayed()},widgetShowStateBeforeChanging:function(e){e&&this.autoResizeToClient()},widgetShowStateChanged:function(e,t){if(Kekule.ObjUtils.isUnset(e)&&(e=this.isShown()),!Kekule.ObjUtils.notUnset(this._lastShown)||this._lastShown!==e){this._lastShown=e,e&&(this._isDismissed=!1);var i=this.getGlobalManager();this.getIsPopup()&&(e?i.registerPopupWidget(this):i.unregisterPopupWidget(this)),this.getIsDialog()&&(e?i.registerDialogWidget(this):i.unregisterDialogWidget(this)),this.doWidgetShowStateChanged(e),this._enableShowHideEvents&&this.invokeEvent("showStateChange",{widget:this,isShown:e,isDismissed:this._isDismissed,byDomChange:t})}},doWidgetShowStateChanged:function(e){},widgetShowStateDone:function(e){},isInDomTree:function(){var e=this.getElement();return Kekule.DomUtils.isInDomTree(e)},focus:function(){return this.setIsFocused(!0),this},blur:function(){return this.setIsFocused(!1),this},getBoundingClientRect:function(e){if(this.getDisplayed())return Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),e);var t=Kekule.StyleUtils.getDisplayed(this.getElement()),i=Kekule.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden"),this.setDisplayed("");var n=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),e)}finally{this.setDisplayed(t),this.setVisible(i)}return n},getPageRect:function(e){if(this.getDisplayed())return Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),e);var t=Kekule.StyleUtils.getDisplayed(this.getElement()),i=Kekule.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden"),this.setDisplayed("");var n=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),e)}finally{this.setDisplayed(t),this.setVisible(i)}return n},getDimension:function(){return this.getPageRect()},setDimension:function(e,t,i){var n=Kekule.ObjUtils.notUnset,s=this.getMinDimension(),a=s&&s.width,r=s&&s.height,o=!1;if(this.getEnableDimensionTransform()){var l,u=n(e)&&a?e/a:null,d=n(t)&&r?t/r:null;if(l=u&&d?Math.min(u,d):u||d)return l>=1?(this._setTransformScale(1),o=!0,this.doSetDimension(e,t,i)):(!d||u<=d?(h=a,g=t&&t/l):(g=r,h=e&&e/l),this._setTransformScale(l),o=!0,this.doSetDimension(h,g,i));o=!1}if(!o){var h=n(e)?a?Math.max(e,a):e:null,g=n(t)?r?Math.max(t,r):t:null;return this._setTransformScale(1),this.doSetDimension(h,g,i)}},doSetDimension:function(e,t,i){var n=!1,s=Kekule.ObjUtils.notUnset;return s(e)&&(this.getStyle().width="number"==typeof e?e+"px":e,n=!0),s(t)&&(this.getStyle().height="number"==typeof t?t+"px":t,n=!0),n&&!i&&this.resized(),this.objectChange(["width","height"]),this},_setTransformScale:function(e){var t=this.getElement();1!==e?(t.style.transformOrigin="0 0",t.style.transform="scale("+e+")"):Kekule.StyleUtils.removeStyleProperty(t.style,"transform")},updateDimensionTransform:function(){var e=this.getDimension();this.setDimension(e.width,e.height,!0)},autoResizeToClient:function(){var e=this.getAutoResizeConstraints();if(e){var t=Kekule.DocumentUtils.getClientDimension(this.getDocument()),i=e.width?t.width*e.width:null,n=e.height?t.height*e.height:null;this.setDimension(i,n)}},resized:function(){this.doResize(),this.invokeEvent("resize",{widget:this})},doResize:function(){},layoutChanged:function(){var e=this.getLayout();this._layoutClassName&&this.removeClassName(this._layoutClassName),this._layoutClassName=this.getLayoutClassName(e),this._layoutClassName&&this.addClassName(this._layoutClassName)},getLayoutClassName:function(e){var t=Kekule.Widget.Layout;return e===t.VERTICAL?i.LAYOUT_V:e===t.HORIZONTAL?i.LAYOUT_H:null},stateChanged:function(){this._stateClassName&&this.removeClassName(this._stateClassName),this._stateClassName=this.getStateClassName(this.getState()),this._stateClassName&&this.addClassName(this._stateClassName);for(var e=this.getChildWidgets(),t=0,i=e.length;t<i;++t)e[t].stateChanged()},getStateClassName:function(e){var t=Kekule.Widget.State;return e===t.ACTIVE?i.STATE_ACTIVE:e===t.HOVER?i.STATE_HOVER:e===t.FOCUSED?i.STATE_FOCUSED:e===t.DISABLED?i.STATE_DISABLED:i.STATE_NORMAL},createElement:function(){var e=this.getDocument(),t=this.doCreateRootElement(e);return this.setElement(t),t},doCreateRootElement:function(e){},doCreateSubElements:function(e,t){return[]},destroyElement:function(e){(e=e||this.getElement())&&e.parentNode&&e.parentNode.removeChild(e)},appendToElem:function(e){return e&&e.appendChild(this.getElement()),this},insertToElem:function(e,t){return e.insertBefore(this.getElement(),t),this},removeFromDom:function(){var e=this.getElement(),t=e.parentNode;t&&t.removeChild(e)},appendToWidget:function(e){return this.setParent(e),this.appendToElem(e.getChildrenHolderElement()),this},insertToWidget:function(e,t){return this.setParent(e),t?this.insertToElem(e.getChildrenHolderElement(),t.getElement()):this.appendToElem(e.getChildrenHolderElement()),this},insertedToDom:function(){return this.widgetDomStateChanged(!0),this.widgetShowStateChanged(this.isShown(),!0),this.doInsertedToDom()},doInsertedToDom:function(){},removedFromDom:function(){return this.widgetDomStateChanged(!1),this.widgetShowStateChanged(!1,!0),this.doRemovedFromDom()},doRemovedFromDom:function(){},widgetDomStateChanged:function(e){this.doWidgetDomStateChanged(e),this.invokeEvent("domStateChange",{widget:this,isInDom:e})},doWidgetDomStateChanged:function(e){},domElemAdded:function(e){return this.doDomElemAdded(e)},doDomElemAdded:function(e){},domElemRemoved:function(e){return this.doDomElemRemoved(e)},doDomElemRemoved:function(e){},getWidgetClassName:function(){var e=Kekule.Widget.HtmlClassNames.BASE;return this.getElement()&&!Kekule.HtmlElementUtils.isFormCtrlElement(this.getCoreElement())&&this.getUseNormalBackground()&&(e+=" "+Kekule.Widget.HtmlClassNames.NORMAL_BACKGROUND),e+=" "+this.doGetWidgetClassName()},doGetWidgetClassName:function(){return""},hasClassName:function(e){return t.hasClass(this.getElement(),e)},addClassName:function(e,i){if(this.getElement())if(i){var n=this.getCustomHtmlClassName();n=Kekule.StrUtils.addTokens(n,e),this.setCustomHtmlClassName(n)}else t.addClass(this.getElement(),e);else this._pendingHtmlClassNames=Kekule.StrUtils.addTokens(this._pendingHtmlClassNames,e);return this},removeClassName:function(e,i){if(this.getElement())if(i){var n=this.getCustomHtmlClassName();n=Kekule.StrUtils.removeTokens(n,e),this.setCustomHtmlClassName(n)}else t.removeClass(this.getElement(),e);else this._pendingHtmlClassNames=Kekule.StrUtils.removeTokens(this._pendingHtmlClassNames,e);return this},toggleClassName:function(e,i){if(this.getElement())if(i){var n=this.getCustomHtmlClassName();n=Kekule.StrUtils.toggleTokens(n,e),this.setCustomHtmlClassName(n)}else t.toggleClass(this.getElement(),e);return this},isElementBindable:function(e){var t=this.getBindableElemTagNames();if(t){var i=e.tagName;return t.indexOf(i.toLowerCase())>=0}return!0},getBindableElemTagNames:function(){return this.getPrototype().hasOwnProperty("BINDABLE_TAG_NAMES")?this.BINDABLE_TAG_NAMES:null},bindElement:function(e){if(e){if(!this.isElementBindable(e))return void Kekule.error(Kekule.$L("ErrorMsg.WIDGET_CAN_NOT_BIND_TO_ELEM").format(this.getClassName(),e.tagName));var n=e.className;n&&this.setCustomHtmlClassName(this.getCustomHtmlClassName()||" "+n);var s=Kekule.DomUtils,a=Kekule.HtmlElementUtils;!function(e){for(var t=s.getDirectChildElems(e),n=t.length-1;n>=0;--n){var r=t[n];a.hasClass(r,i.DYN_CREATED)&&e.removeChild(r)}}(e);var r=this.getDocument().createDocumentFragment(),o=this.doCreateSubElements(this.getDocument(),r);if(o&&o.length)for(var l=0,u=o.length;l<u;++l){var d=o[l];a.addClass(d,i.DYN_CREATED)}(o&&o.length||r.children&&r.children.length||r.childNodes&&r.childNodes.length)&&e.appendChild(r),this.doBindElement(e),Kekule.DomUtils.hasAttribute(e,"disabled")&&this.setEnabled(!1);var h=e.getAttribute("width"),g=e.getAttribute("height");(Kekule.ObjUtils.notUnset(h)||Kekule.ObjUtils.notUnset(g))&&(h=parseFloat((h||"").toString())||0,g=parseFloat((g||"").toString())||0,this.setDimension(h,g));var c=Kekule.DomUtils.getDataset(e);if(c)for(var p in c){var E=c[p];try{Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,p,E)}catch(e){Kekule.warn(e)}}var f=this.getWidgetClassName();t.addClass(e,f),(f=this.getCustomHtmlClassName())&&t.addClass(e,f),this.getTextSelectable()||t.addClass(e,i.NONSELECTABLE),this._pendingHtmlClassNames&&(t.addClass(e,this._pendingHtmlClassNames),this._pendingHtmlClassNames="");var T=this.getTouchAction();Kekule.ObjUtils.notUnset(T)&&this.setTouchAction(T),this.getIsDumb()||this.installUiEventHandlers(e),e.__$kekule_widget__=this,this.invokeEvent("bind",{widget:this,element:e})}},doBindElement:function(e){},unbindElement:function(e){if(e){this.getIsDumb()||this.uninstallUiEventHandlers(e);var i=this.getWidgetClassName();t.removeClass(e,i),this.doUnbindElement(e),e.__$kekule_widget__=void 0;try{delete e.__$kekule_widget__}catch(e){}this.invokeEvent("unbind",{widget:this,element:e})}},doUnbindElement:function(e){},elementChanged:function(e,t){t&&this.unbindElement(t),e&&this.bindElement(e)},observeElementAttribChangesChanged:function(e){var t=this.getElement();e?this._installAttribMutationObserver(t):this._uninstallAttribMutationObserver(t)},_installAttribMutationObserver:function(e){if(Kekule.X.MutationObserver){if(!this._attribMutationObserver){var t=new Kekule.X.MutationObserver(this._reactElemAttribMutationBind);this._attribMutationObserver=t}this._attribMutationObserver.observe(e,{attributes:!0})}},_uninstallAttribMutationObserver:function(e){this._attribMutationObserver&&this._attribMutationObserver.disconnect()},_reactElemAttribMutation:function(e){for(var t=this.getElement(),i=0,n=e.length;i<n;++i){var s=e[i];if("attributes"===s.type&&s.target===t){var a=s.attributeName;if(a&&Kekule.DomUtils.isDataAttribName(a)){var r=Kekule.DomUtils.getDataAttribCoreName(a);if(r){var o=t.getAttribute(a);Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,r,o)}}}}},createDecorationContent:function(e,n){var s=e.ownerDocument.createElement("span");return t.addClass(s,[i.PART_CONTENT,i.PART_DECORATION_CONTENT,i.DYN_CREATED]),n?e.insertBefore(s,n):e.appendChild(s),s},createTextContent:function(e,n,s){var a=n.ownerDocument.createElement("span");return t.addClass(a,[i.PART_CONTENT,i.PART_TEXT_CONTENT,i.DYN_CREATED]),a.innerHTML=e,s?n.insertBefore(a,s):n.appendChild(a),a},createGlyphContent:function(e,n,s){var a=e.ownerDocument.createElement("span");return t.addClass(a,[i.PART_CONTENT,i.PART_GLYPH_CONTENT,i.DYN_CREATED]),s&&t.addClass(a,s),n?e.insertBefore(a,n):e.appendChild(a),a},_touchActionNoneTouchStartHandler:function(e){e.preventDefault()},installUiEventHandlers:function(e){for(var t=Kekule.Widget.UiLocalEvents,i=0,n=t.length;i<n;++i)Kekule.X.Event.addListener(e,t[i],this.reactUiEventBind)},uninstallUiEventHandlers:function(e){for(var t=Kekule.Widget.UiLocalEvents,i=0,n=t.length;i<n;++i)Kekule.X.Event.removeListener(e,t[i],this.reactUiEventBind)},reactUiEvent:function(e){if(this.getStatic());else if(this.getEnabled()){var t,i=!1,n=e.getType(),s=e.getTarget(),a=Kekule.Widget.Utils.getBelongedResponsiveWidget(s)===this,r=Kekule.X.Event.KeyCode;if("mousemove"===n||"pointermove"===n){this.reactPointerMoving(e);var o=this.getEventMouseRelCoord(e),l=this.testMouseCursor(o,e);Kekule.ObjUtils.notUnset(l)&&this.getElement()&&(this.setCursor(l),i=!0)}else if("touchmove"===n){if(this.reactPointerMoving(e),this.getIsActive()&&!this.isCaptureMouse()){var u=e.touches[0];if(u){var d=this.getDocument().elementFromPoint(u.clientX,u.clientY);Kekule.DomUtils.isOrIsDescendantOf(d,this.getElement())||(this.setIsHover(!1),this.setIsActive(!1))}else this.setIsHover(!1),this.setIsActive(!1)}i=!0}else if("focus"===n)a&&e.getTarget()===this.getCoreElement()&&(this.setIsFocused(!0),i=!0);else if("blur"===n){if(a&&e.getTarget()==this.getCoreElement()){var h=this.getDocument().activeElement,g=this.getElement();h&&(Kekule.DomUtils.isDescendantOf(h,g)||h===g)||this.setIsFocused(!1),i=!0}}else if("pointerover"===n)"touch"===e.pointerType||e.ghostMouseEvent||this.setIsHover(!0),i=!0;else if("mouseout"===n||"touchleave"===n){if(!e.ghostMouseEvent){var c=e.getRelatedTarget();c&&Kekule.DomUtils.isOrIsDescendantOf(c,this.getCoreElement())||(this.setIsHover(!1),this.isCaptureMouse()||(this.reactDeactiviting(e),i=!0))}}else"pointerdown"===n&&e.getButton()===Kekule.X.Event.MouseButton.LEFT?(a&&!e.ghostMouseEvent&&this.reactActiviting(e),i=!0):"pointerup"===n&&e.getButton()===Kekule.X.Event.MouseButton.LEFT||"touchcancel"===n?(a&&!e.ghostMouseEvent&&this.reactDeactiviting(e),i=!0):"keydown"===n?(t=e.getKeyCode())!==r.ENTER&&t!==r.SPACE||(a&&!this.getIsActive()&&this.reactActiviting(e),i=!0):"keyup"===n&&((t=e.getKeyCode())!==r.ENTER&&t!==r.SPACE||(a&&this.getIsActive()&&this.reactDeactiviting(e),i=!0));this.doBeforeDispatchUiEvent(e);var p=Kekule.Widget.getEventHandleFuncName(e.getType());i=this[p]?this[p](e):this.dispatchEventToIaControllers(e)||i,this.doReactUiEvent(e),this.invokeEvent(n,{htmlEvent:e})}else e.stopPropagation();if(this.getActualBubbleUiEvents()){var E=this.getParent();E&&E.reactUiEvent&&E.reactUiEvent(e)}},doReactUiEvent:function(e){},doBeforeDispatchUiEvent:function(e){},_supportGestureEvent:function(){return void 0!==Kekule.$jsRoot.Hammer&&document&&document.addEventListener},startObservingGestureEvents:function(t){if(this._supportGestureEvent()){t||(t=Kekule.Widget.TouchGestures);var i=e.exclude(t,this.getObservingGestureEvents()||[]);i.length&&this.installHammerTouchHandlers(i)}},stopObservingGestureEvents:function(t){if(this._supportGestureEvent()&&this.getObservingGestureEvents()){t||(t=Kekule.Widget.TouchGestures);var i=e.intersect(t,this.getObservingGestureEvents());i.length&&this.uninstallHammerTouchHandlers(i)}},installHammerTouchHandlers:function(e){if(this._supportGestureEvent()){e||(e=Kekule.Widget.TouchGestures);var t=this.getCoreElement(),i=new Hammer(t);return e.indexOf("pinch")>=0&&i.get("pinch").set({enable:!0}),e.indexOf("rotate")>=0&&i.get("rotate").set({enable:!0}),i.on(e.join(" "),this.reactTouchGestureBind),this._hammertime=i,this.setPropStoreFieldValue("observingGestureEvents",e),i}},uninstallHammerTouchHandlers:function(e){this._hammertime&&(e||(e=this.getObservingGestureEvents()),this._hammertime.off(e.join(" "),this.reactTouchGestureBind))},reactTouchGesture:function(e){var t=Kekule.Widget.getTouchGestureHandleFuncName(e.getType&&e.getType()||e.type);this[t]?this[t](e):this.dispatchEventToIaControllers(e,"hammer")},reactActiviting:function(e){this.getIsActive()||(this.setIsActive(!0),this.doReactActiviting(e),this.invokeEvent("activate",{widget:this}))},doReactActiviting:function(e){},reactDeactiviting:function(e){this.getIsActive()&&(this.doReactDeactiviting(e),this.invokeEvent("deactivate",{widget:this}),this.setIsActive(!1))},doReactDeactiviting:function(e){},reactPointerMoving:function(e){this.doReactPointerMoving(e)},doReactPointerMoving:function(e){},dispatchEventToIaControllers:function(e,t){var i=!1,n=this.getActiveIaController();return n&&(i="hammer"===t?n.handleGestureEvent(e):n.handleUiEvent(e)),i||(n=this.getDefIaController())&&(i="hammer"===t?n.handerGestureEvent(e):n.handleUiEvent(e)),i},getEventMouseRelCoord:function(e,t){t||(t=this.getCoreElement());var i={x:e.getClientX(),y:e.getClientY()},n=Kekule.HtmlElementUtils.getElemPageRect(t,!0),s={x:n.left-t.scrollLeft,y:n.top-t.scrollTop};return Kekule.CoordUtils.substract(i,s)},testMouseCursor:function(e,t){var i=this.doTestMouseCursor(e,t);if(!i){var n=this.getActiveIaController();n&&(i=n.testMouseCursor(e,t)),i||(n=this.getDefIaController())&&(i=n.testMouseCursor(e,t))}return i},doTestMouseCursor:function(e,t){return null},setMouseCapture:function(e){var t=this.getGlobalManager();e?t.setMouseCaptureWidget(this):this.isCaptureMouse()&&t.setMouseCaptureWidget(null)},isCaptureMouse:function(){return this.getGlobalManager().getMouseCaptureWidget()===this},_filterDraggedDataItemByKinds:function(e,t){if(e.items){for(var i=[],n=0,s=e.items.length;n<s;++n){var a=e.items[n];t.indexOf(a.kind)>=0&&i.push(a)}return i}return null},dragStart:function(e){if(this.getDraggable()){var t=this.doDragStart(e);return this.invokeEvent("dragStart",{widget:this,dataTransfer:e.dataTransfer,startingElem:e.targetElem}),t}return!1},doDragStart:function(e,t){return!0},dragEnd:function(e){var t=this.doDragEnd(e);return this.invokeEvent("dragEnd",{widget:this,dataTransfer:e.dataTransfer,startingElem:e.targetElem}),t},doDragEnd:function(e){},acceptDragSrc:function(e){if(this.getDroppable()){var t=!0,i={widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files};if(this.invokeEvent("dragAcceptQuery",i),Kekule.ObjUtils.notUnset(i.result))return t=i.result;var n=this.getDroppableDataKinds();return n&&(e.dataTransfer.items?t=!!this._filterDraggedDataItemByKinds(e.dataTransfer,n).length:n.indexOf("file")>=0&&e.dataTransfer.files&&e.dataTransfer.files.length&&(t=!0)),t&&this.doAcceptDragSrc(e)}return!1},doAcceptDragSrc:function(e){return!0},dragOver:function(e){if(this.getDroppable()&&this.acceptDragSrc(e)){var t=this.doDragOver(e);return this.invokeEvent("dragOver",{widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files}),t}return!1},doDragOver:function(e){return!0},dragLeave:function(e){var t=this.doDragLeave(e);return this.invokeEvent("dragLeave",{widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files}),t},doDragLeave:function(e){},dragDrop:function(e){if(this.getDroppable()&&this.acceptDragSrc(e)){var t=this.doDragDrop(e),i=this.getDroppableDataKinds();if(!i||i.indexOf("file")>=0){var n=e.dataTransfer.files;n&&n.length&&(t=t||this.doFileDragDrop(n))}var s={widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files};return this.invokeEvent("dragDrop",s),t||s._preventDefault}return!1},doDragDrop:function(e){return!1},doFileDragDrop:function(e){return!0},addIaController:function(e,t,i){this.getIaControllerMap().set(e,t),i&&this.setDefIaControllerId(e),t&&t.setWidget(this)},removeIaController:function(e){var t=this.getIaControllerMap().get(e);t&&(this.getIaControllerMap().remove(e),e===this.getDefIaControllerId()&&this.setDefIaControllerId(null),e===this.getActiveIaControllerId()&&this.setActiveIaControllerId(null),t.setWidget(null))},getIaController:function(e){return this.getIaControllerMap().get(e)},execute:function(e){this.doExecute(e),this.invokeEvent("execute",{widget:this,htmlEvent:e})},doExecute:function(e){},isPeriodicalExecuting:function(){return this._periodicalExecBind},startPeriodicalExec:function(e){var t=this.getPeriodicalExecDelay()||0;this._periodicalExecuting=!0,this._periodicalExecHtmlEvent=e,setTimeout(this._periodicalExecBind,t)},stopPeriodicalExec:function(){this._periodicalExecuting=!1,this._periodicalExecHtmlEvent=null},_periodicalExec:function(e){this.isPeriodicalExecuting()&&(this._waitPeriodicalProcess||(this._waitPeriodicalProcess=!0,this.execute(this._periodicalExecHtmlEvent),this._waitPeriodicalProcess=!1),setTimeout(this._periodicalExecBind,this.getPeriodicalExecInterval()||20))}}),Kekule.Widget.InteractionController=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.InteractionController",initialize:function($super,e){$super(),e&&this.setWidget(e)},doFinalize:function($super){this.setWidget(null),$super()},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},activated:function(e){},handleUiEvent:function(e){var t=e.getType(),i=Kekule.Widget.getEventHandleFuncName(t);return!!this[i]&&this[i](e)},handleGestureEvent:function(e){var t=e.type,i=Kekule.Widget.getEventHandleFuncName(t);return!!this[i]&&this[i](e)},_defEventHandler:function(e){return!1},testMouseCursor:function(e,t){return this.doTestMouseCursor(e,t)},doTestMouseCursor:function(e,t){return null},_getEventMouseCoord:function(e,t){var i=t||this.getWidget().getElement(),n=e.getTarget(),s=e.getOffsetCoord(!0);if(n===i)return s;var a=Kekule.HtmlElementUtils.getElemPagePos(i),r=Kekule.HtmlElementUtils.getElemPagePos(n),o={x:r.x-a.x,y:r.y-a.y};return s=Kekule.CoordUtils.substract(s,o)}}),Kekule.Widget.DumbWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DumbWidget",initialize:function($super,e){$super(e,!0)},doGetWidgetClassName:function($super){return $super()+" "+i.DUMB_WIDGET},doCreateRootElement:function(e){return e.createElement("span")}}),Kekule.Widget.PlaceHolder=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.PlaceHolder",initialize:function($super,e,t){this.setPropStoreFieldValue("targetWidgetClass",t),$super(e,!0)},initProperties:function(){this.defineProp("targetWidgetClass",{dataType:DataType.CLASS,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("targetWidgetClass");if(!e){var t=this.getPropStoreFieldValue("targetWidgetClassName");t&&(e=ClassEx.findClass(t))}return e}}),this.defineProp("targetWidgetClassName",{dataType:DataType.STRING,getter:function(){var e=this.getTargetWidgetClass();return e?ClassEx.getClassName(e):this.getPropStoreFieldValue("targetWidgetClassName")},setter:function(e){this.setPropStoreFieldValue("targetWidgetClassName",e),this.setTargetWidgetClass(ClassEx.findClass(e))}}),this.defineProp("target",{dataType:DataType.STRING,getter:function(){return this.getTargetWidgetClassName()},setter:function(e){this.setTargetWidgetClassName(e)}}),this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:"false",setter:null,getter:function(){var e=this.getPropStoreFieldValue("targetWidget");return e||(e=this.createTargetWidget()),e}})},doGetWidgetClassName:function($super){var e=$super()+" "+i.PLACEHOLDER,t=this.getTargetWidgetClass();if(t){var n=ClassEx.getPrototype(t).getWidgetClassName();e=Kekule.StrUtils.addTokens(e,n)}return e},doCreateRootElement:function(e){return e.createElement("img")},doReactUiEvent:function(e){this.createTargetWidget()},createTargetWidget:function(){var t=this.getTargetWidgetClass();if(t){try{var i=this.getElement(),n=this.getParent();n&&n instanceof Kekule.Widget.PlaceHolder&&(n=n.createTargetWidget());var s=e.clone(this.getChildWidgets());this.unbindElement(this.getElement()),this.setPropStoreFieldValue("element",null);var a=new t(i);if(a){if(n){var r=this.getNextSibling();this.setParent(null),a.setPropStoreFieldValue("parent",n),n._insertChild(a,r)}if(s)for(var o=0,l=s.length;o<l;++o)s[o].setParent(a)}}finally{this.finalize()}return a}Kekule.error(Kekule.$L("ErrorMsg.WIDGET_UNAVAILABLE_FOR_PLACEHOLDER"))}}),Kekule.Widget.Utils={getWidgetOnElem:function(e,t){var i=e.__$kekule_widget__;return!t&&i instanceof Kekule.Widget.PlaceHolder&&(i=i.getTargetWidget()),i},getWidgetsInsideElem:function(e,t){var i,n=Kekule.Widget.Utils.getWidgetOnElem(e);if(i=n?[n]:[],!t)return i;for(var s=Kekule.DomUtils.getDirectChildElems(e),a=0,r=s.length;a<r;++a){var o=s[a],l=Kekule.Widget.Utils.getWidgetsInsideElem(o,t);i=i.concat(l)}return i},getWidgetById:function(e,t){t||(t=document);var i=t.getElementById(e);return i?Kekule.Widget.Utils.getWidgetOnElem(i):void 0},getBelongedWidget:function(e){for(var t=null;e&&!t;)t=Kekule.Widget.Utils.getWidgetOnElem(e),e=e.parentNode;return t},getBelongedResponsiveWidget:function(e){for(var t=null;e&&!t;)(t=Kekule.Widget.Utils.getWidgetOnElem(e))&&t.getStatic()&&(t=null),e=e.parentNode;return t},createFromHash:function(e,t){var i=t.widgetClass||t.widget;if("string"==typeof i&&(i=ClassEx.findClass(i)),!i)return Kekule.error(Kekule.$L("ErrorMsg.WIDGET_CLASS_NOT_FOUND")),null;for(var n=new i(e),s=Kekule.ObjUtils.getOwnedFieldNames(t,!0),a=0,r=(s=Kekule.ArrayUtils.exclude(s,["widget","widgetClass","htmlClass","children"])).length;a<r;++a){var o=s[a],l=t[o];if(o.startsWith("#")&&DataType.isFunctionValue(l)){var u=o.substr(1);n.addEventListener(u,l)}else n.hasProperty(o)&&n.setPropValue(o,l)}if(t.htmlClass&&n.addClassName(t.htmlClass,!0),t.children){var d=t.children;if(DataType.isArrayValue(d))for(a=0,r=d.length;a<r;++a){var h=d[a],g=Kekule.Widget.Utils.createFromHash(n,h);g&&g.appendToWidget(n)}}return n},setWidgetPropFromElemAttrib:function(e,t,i){var n=t.camelize(),s=e.getPropertyDataType(n);if(s)if(s===DataType.STRING)e.setPropValue(n,i);else if(Kekule.PredefinedResReferer.isResValue(i))Kekule.PredefinedResReferer.loadResource(i,function(t,i){e.loadPredefinedResDataToProp&&e.loadPredefinedResDataToProp(n,t,i)},null,e.getDocument());else if(i.startsWith("#")&&ClassEx.isOrIsDescendantOf(ClassEx.findClass(s),Kekule.Widget.BaseWidget)){var a=i.substr(1).trim();Kekule.Widget.Utils._setWidgetRefPropFromId(e,n,a)}else{var r=JSON.parse(i);if(Kekule.ObjUtils.notUnset(r)){var o=Class.ObjSerializerFactory.getSerializer("json").load(null,r);e.setPropValue(n,o)}}},_setWidgetRefPropFromId:function(e,t,i){if(i){var n=Kekule.Widget.getWidgetById(i,e.getDocument());n&&e.setPropValue(t,n)}}},Kekule.Widget.getWidgetOnElem=Kekule.Widget.Utils.getWidgetOnElem,Kekule.Widget.getWidgetById=Kekule.Widget.Utils.getWidgetById,Kekule.$W=Kekule.Widget.Utils.getWidgetById,Kekule.Widget.getBelongedWidget=Kekule.Widget.Utils.getBelongedWidget,Kekule.Widget.createFromHash=Kekule.Widget.Utils.createFromHash,Kekule.Widget.GlobalManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.GlobalManager",INFO_FIELD:"__$info__",ISOLATED_LAYER_FIELD:"__$isolated_layer__",initialize:function($super,e){$super(),this._document=e||document,this._touchEventSeq=[],this._hammertime=null,this.setPropStoreFieldValue("popupWidgets",[]),this.setPropStoreFieldValue("dialogWidgets",[]),this.setPropStoreFieldValue("modalWidgets",[]),this.setPropStoreFieldValue("autoResizeWidgets",[]),this.setPropStoreFieldValue("widgets",[]),this.setPropStoreFieldValue("draggingElems",[]),this.setPropStoreFieldValue("preserveWidgetList",!0),this.setPropStoreFieldValue("enableMouseEventToPointerPolyfill",!0),this.setPropStoreFieldValue("enableHammerGesture",!1),this.reactUiEventBind=this.reactUiEvent.bind(this),this.reactTouchGestureBind=this.reactTouchGesture.bind(this),this.reactWindowResizeBind=this.reactWindowResize.bind(this),Kekule.X.domReady(this.domReadyInit.bind(this))},finalize:function($super){this.uninstallWindowEventHandlers(Kekule.DocumentUtils.getDefaultView(this._document)),this.uninstallGlobalDomMutationHandlers(this._document.documentElement),this.uninstallGlobalEventHandlers(this._document.body),this._hammertime=null,this.setPropStoreFieldValue("popupWidgets",null),this.setPropStoreFieldValue("widgets",null),this.setPropStoreFieldValue("draggingElems",null),$super()},initProperties:function(){this.defineProp("mouseCaptureWidget",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("popupWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("dialogWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("modalWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("autoResizeWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("draggingElems",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("preserveWidgetList",{dataType:DataType.BOOL,serializable:!1,setter:function(e){this.setPropStoreFieldValue("preserveWidgetList",e),e||this.setPropStoreFieldValue("widgets",[])}}),this.defineProp("widgets",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("currHoverWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("currActiveWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("currFocusedWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("modalBackgroundElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("enableHammerGesture",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableMouseEventToPointerPolyfill",{dataType:DataType.BOOL,serializable:!1})},domReadyInit:function(){this.installGlobalEventHandlers(this._document.documentElement),this.getEnableHammerGesture()&&(this._hammertime=this.installGlobalHammerTouchHandlers(this._document.body)),this.installGlobalDomMutationHandlers(this._document.documentElement),this.installWindowEventHandlers(Kekule.DocumentUtils.getDefaultView(this._document))},notifyWidgetCreated:function(e){this.getPreserveWidgetList()&&this.getWidgets().push(e),this.invokeEvent("widgetCreate",{widget:e})},notifyWidgetFinalized:function(e){this.getWidgets()&&Kekule.ArrayUtils.remove(this.getWidgets(),e),this.getPopupWidgets()&&Kekule.ArrayUtils.remove(this.getPopupWidgets(),e),this.getDialogWidgets()&&Kekule.ArrayUtils.remove(this.getDialogWidgets(),e),this.getAutoResizeWidgets()&&Kekule.ArrayUtils.remove(this.getAutoResizeWidgets(),e),e===this.getCurrActiveWidget()&&this.setCurrActiveWidget(null),e===this.getCurrFocusedWidget()&&this.setCurrFocusedWidget(null),this.invokeEvent("widgetFinalize",{widget:e})},notifyWidgetHoverChanged:function(e,t){var i=this.getCurrHoverWidget();t?e!==i&&(i&&i.setIsHover(!1),this.setCurrHoverWidget(e)):i===e&&this.setCurrHoverWidget(null)},notifyWidgetActiveChanged:function(e,t){var i=this.getCurrActiveWidget();t?e!==i&&(i&&i.setIsActive(!1),this.setCurrActiveWidget(e)):i===e&&this.setCurrActiveWidget(null)},notifyWidgetFocusChanged:function(e,t){var i=this.getCurrFocusedWidget();t?e!==i&&(i&&i.setIsFocused(!1),this.setCurrFocusedWidget(e)):i===e&&this.setCurrFocusedWidget(null)},hasPopupWidgets:function(){return!!this.getPopupWidgets().length},hasDialogWidgets:function(){return!!this.getDialogWidgets().length},getBelongedResponsiveWidget:function(e){return Kekule.Widget.Utils.getBelongedResponsiveWidget(e)},notifyWidgetEventFired:function(e,t,i){var n=Object.extend({},i);n.widget=e,this.invokeEvent(t,n)},installGlobalEventHandlers:function(e){if(!this._globalEventInstalled){for(var t=Kekule.Widget.UiEvents,i=0,n=t.length;i<n;++i)"touchstart"===t[i]||"touchmove"===t[i]||"touchend"===t[i]?Kekule.X.Event.addListener(e,t[i],this.reactUiEventBind,{passive:!0}):Kekule.X.Event.addListener(e,t[i],this.reactUiEventBind);this._globalEventInstalled=!0}},uninstallGlobalEventHandlers:function(e){for(var t=Kekule.Widget.UiEvents,i=0,n=t.length;i<n;++i)Kekule.X.Event.removeListener(e,t[i],this.reactUiEventBind)},installWindowEventHandlers:function(e){Kekule.X.Event.addListener(e,"resize",this.reactWindowResizeBind)},uninstallWindowEventHandlers:function(e){Kekule.X.Event.removeListener(e,"resize",this.reactWindowResizeBind)},installGlobalHammerTouchHandlers:function(e){if(void 0!==Kekule.$jsRoot.Hammer){var t=new Hammer(e);return t.get("pinch").set({enable:!0}),t.get("rotate").set({enable:!0}),t.on(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind),this._hammertime=t,t}},uninstallGlobalHammerTouchHandlers:function(e){this._hammertime&&this._hammertime.off(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind)},installGlobalDomMutationHandlers:function(e){var t=this;if(Kekule.X.MutationObserver){var i=new Kekule.X.MutationObserver(function(e){for(var i=0,n=e.length;i<n;++i){var s=e[i];if("childList"===s.type){for(var a=0,r=(o=s.addedNodes).length;a<r;++a){(l=o[a]).nodeType===Node.ELEMENT_NODE&&t._handleDomAddedElem(l)}var o;for(a=0,r=(o=s.removedNodes).length;a<r;++a){var l;(l=o[a]).nodeType===Node.ELEMENT_NODE&&t._handleDomRemovedElem(l)}}}});i.observe(e,{childList:!0,subtree:!0}),this._domMutationObserver=i}else this._reactDomNodeInserted=function(e){var i=e.getTarget();i.nodeType===Node.ELEMENT_NODE&&t._handleDomAddedElem(i)},this._reactDomNodeRemoved=function(e){var i=e.getTarget();i.nodeType===Node.ELEMENT_NODE&&t._handleDomRemovedElem(i)},Kekule.X.Event.addListener(e,"DOMNodeInserted",this._reactDomNodeInserted),Kekule.X.Event.addListener(e,"DOMNodeRemoved",this._reactDomNodeRemoved)},uninstallGlobalDomMutationHandlers:function(e){this._domMutationObserver&&this._domMutationObserver.disconnect(),this._reactDomNodeInserted&&Kekule.X.Event.removeListener(e,"DOMNodeInserted",this._reactDomNodeInserted),this._reactDomNodeRemoved&&Kekule.X.Event.removeListener(e,"DOMNodeRemoved",this._reactDomNodeRemoved)},_handleDomAddedElem:function(e){for(var t=Kekule.Widget.Utils.getWidgetsInsideElem(e,!0),i=0,n=t.length;i<n;++i){(s=t[i]).insertedToDom()}var s;(s=Kekule.Widget.Utils.getBelongedWidget(e))&&(s.getElement()===e?s.insertedToDom():s.domElemAdded(e))},_handleDomRemovedElem:function(e){for(var t=Kekule.Widget.Utils.getWidgetsInsideElem(e,!0),i=0,n=t.length;i<n;++i){(s=t[i]).removedFromDom()}var s;(s=Kekule.Widget.Utils.getBelongedWidget(e))&&s.domElemRemoved(e)},isMouseEvent:function(e){return e.startsWith("mouse")||"click"===e},isTouchEvent:function(e){return e.startsWith("touch")},isPointerEvent:function(e){return e.startsWith("pointer")},mapTouchToPointerEvent:function(e){var t,i=e.getType(),n=e;if(n.pointerType="touch","touchstart"===i?t="pointerdown":"touchmove"===i?t="pointermove":"touchleave"===i?t="pointerout":"touchend"===i&&(t="pointerup"),t){n.setType(t),n.button=Kekule.X.Event.MouseButton.LEFT;var s=e.touches[0],a=["clientX","clientY","pageX","pageY","screenX","screenY"];if(s){for(var r={},o=0,l=a.length;o<l;++o){n[d=a[o]]=s[d],r[d]=s[d]}if("touchstart"!==i){var u=this._document.elementFromPoint(n.clientX,n.clientY);n.setTarget(u)}this._touchPointerMapData={positionCache:r,targetCache:n.getTarget()}}else{if(this._touchPointerMapData)for(o=0,l=a.length;o<l;++o){var d;n[d=a[o]]=this._touchPointerMapData.positionCache[d]}n.setTarget(this._touchPointerMapData.targetCache)}return n}return null},reactUiEvent:function(e){var t,i=e.getType();if(this.getMouseCaptureWidget()&&(this.isMouseEvent(i)||this.isTouchEvent(i)||this.isPointerEvent(i)))t=this.getMouseCaptureWidget(),!0;else{var n=e.getTarget();t=this.getBelongedResponsiveWidget(n)}if("touchstart"===i)this._touchEventSeq=["touchstart"],this._touchDoneTimeStamp=null;else if("touchcancel"===i)this._touchEventSeq=[];else if("touchend"===i)"touchstart"===this._touchEventSeq[0]&&(this._touchEventSeq.push("touchend"),this._touchDoneTimeStamp=Date.now());else if(["mousedown","mouseup","mouseover","mouseout","click"].indexOf(i)>=0)if("touchstart"===this._touchEventSeq[0]&&"touchend"===this._touchEventSeq[1])e.ghostMouseEvent=!0,"click"===i&&(this._touchEventSeq=[],this._touchDoneTimeStamp=Date.now());else if(this._touchDoneTimeStamp){Date.now()-this._touchDoneTimeStamp<1e3&&(e.ghostMouseEvent=!0)}var s=Kekule.Widget.getEventHandleFuncName(e.getType());if(this[s]&&this[s](e),t&&t.reactUiEvent(e),!e.ghostMouseEvent&&!Kekule.BrowserFeature.pointerEvent&&this.getEnableMouseEventToPointerPolyfill()){var a=["mousedown","mousemove","mouseout","mouseover","mouseup"].indexOf(i);if(a>=0)e.setType(["pointerdown","pointermove","pointerout","pointerover","pointerup"][a]),e.pointerType="mouse",this.reactUiEvent(e);else if(["touchstart","touchmove","touchleave","touchend","touchcancel"].indexOf(i)>=0){var r=this.mapTouchToPointerEvent(e);r&&this.reactUiEvent(r)}}},reactTouchGesture:function(e){var t=Kekule.Widget.getTouchGestureHandleFuncName(e.getType&&e.getType()||e.type);this[t]&&this[t](e);var i=Kekule.Widget.getBelongedWidget(e.target);i&&i.reactTouchGesture(e)},reactWindowResize:function(e){for(var t=this.getAutoResizeWidgets(),i=0,n=t.length;i<n;++i)t[i].isShown()&&t[i].autoResizeToClient()},_startPointerHolderTimer:function(e){var t=this;return this._pointerHolderTimer={pointerType:e.pointerType,button:e.getButton(),coord:{x:e.getClientX(),y:e.getClientY()},target:e.getTarget(),_timeoutId:setTimeout(function(){var i=e;i.setType("pointerhold"),t._pointerHolderTimer=null,t.reactUiEvent(i)},Kekule.Widget._PointerHoldParams.DURATION_THRESHOLD),cancel:function(){clearTimeout(t._pointerHolderTimer._timeoutId),t._pointerHolderTimer=null}},this._pointerHolderTimer},react_pointerdown:function(e){if(this.hasPopupWidgets()&&!e.ghostMouseEvent&&e.getButton()===Kekule.X.Event.MouseButton.LEFT){var t=e.getTarget();this.hidePopupWidgets(t)}this._pointerHolderTimer?e.pointerType===this._pointerHolderTimer.pointerType&&e.getButton()===this._pointerHolderTimer.button||this._pointerHolderTimer.cancel():this._startPointerHolderTimer(e)},react_pointerup:function(e){this._pointerHolderTimer&&this._pointerHolderTimer.cancel()},react_pointermove:function(e){if(this._pointerHolderTimer)if(e.getTarget()!==this._pointerHolderTimer.target)this._pointerHolderTimer.cancel();else{var t=this._pointerHolderTimer.coord,i={x:e.getClientX(),y:e.getClientY()};Kekule.CoordUtils.getDistance(t,i)>Kekule.Widget._PointerHoldParams.MOVEMENT_THRESHOLD&&this._pointerHolderTimer.cancel()}},react_keydown:function(e){e.getKeyCode()===Kekule.X.Event.KeyCode.ESC&&(this.hasPopupWidgets()?this.hidePopupWidgets(null,!0):this.hasDialogWidgets()&&this.hideTopmostDialogWidget(null,!0))},react_touchstart:function(e){if(this.hasPopupWidgets()){var t=e.getTarget();this.hidePopupWidgets(t)}},react_dragstart:function(e){this._clearDraggingElems();var t=e.getTarget();if(t&&e.dataTransfer){var i=this._appendDraggingElem(t);if(e.dataTransfer.setData)try{e.dataTransfer.setData(Kekule.Widget.DragDrop.ELEM_INDEX_DATA_TYPE,""+i)}catch(e){}var n=Kekule.Widget.getBelongedWidget(t);n&&n.dragStart({htmlEvent:e,dataTransfer:e.dataTransfer,startingElem:t})}},react_dragend:function(e){var t=e.getTarget();if(t){var i=Kekule.Widget.getBelongedWidget(t);i&&i.dragEnd({htmlEvent:e,dataTransfer:e.dataTransfer,startingElem:t})}this._dragDone(e)},react_dragover:function(e){var t=e.getTarget(),i=this._getNearestDragDropDestWidget(Kekule.Widget.getBelongedWidget(t));if(i&&i.getDroppable()&&e.dataTransfer){var n=this._getElemAndWidgetInDraggingTransfer(e.dataTransfer),s={htmlEvent:e,dataTransfer:e.dataTransfer,srcElem:n.elem,srcWidget:n.widget};i.acceptDragSrc(s)&&(e.preventDefault(),i.dragOver(s))}},react_dragleave:function(e){var t=e.getTarget(),i=this._getNearestDragDropDestWidget(Kekule.Widget.getBelongedWidget(t));if(i&&i.getDroppable()&&e.dataTransfer){var n=this._getElemAndWidgetInDraggingTransfer(e.dataTransfer),s={htmlEvent:e,dataTransfer:e.dataTransfer,srcElem:n.elem,srcWidget:n.widget};i.acceptDragSrc(s)&&i.dragLeave(s)}},react_drop:function(e){var t=e.getTarget(),i=this._getNearestDragDropDestWidget(Kekule.Widget.getBelongedWidget(t));if(i&&i.getDroppable()){var n=this._getElemAndWidgetInDraggingTransfer(e.dataTransfer),s={htmlEvent:e,dataTransfer:e.dataTransfer,srcElem:n.elem,srcWidget:n.widget};i.acceptDragSrc(s)&&i.dragDrop(s)&&e.preventDefault()}this._dragDone(e)},_dragDone:function(e){this._clearDraggingElems();var t=e.dataTransfer;t&&(t.items?t.items.clear():t.clearData())},_getNearestDragDropDestWidget:function(e){if(!e)return null;if(e.getDroppable())return e;var t=e.getParent();return t&&this._getNearestDragDropDestWidget(t)},_getElemAndWidgetInDraggingTransfer:function(e){var t,i;if(e.getData){try{var n=e.getData(Kekule.Widget.DragDrop.ELEM_INDEX_DATA_TYPE);if(Kekule.ObjUtils.notUnset(n)){var s=parseInt(n)||0;t=this.getDraggingElems()[s]}}catch(e){var a=this.getDraggingElems();a&&1===a.length&&(t=a[0])}t&&(i=Kekule.Widget.getBelongedWidget(t))}return{elem:t,widget:i}},_clearDraggingElems:function(){this.setPropStoreFieldValue("draggingElems",[])},_appendDraggingElem:function(e){var t=this.getDraggingElems();return t.push(e),t.length-1},unpreparePopupWidget:function(e){e.setPopupCaller(null),this.restoreElem(e.getElement())},preparePopupWidget:function(e,t,i){e.setPopupCaller(t);var n,s,a=e.getElement(),r=a.ownerDocument,o=this.getTopmostLayer(r,!0),l=a.parentNode===o,u=Kekule.Widget.ShowHideType,d=e.getAutoAdjustSizeOnPopup();if(i===u.DROPDOWN?(s=Kekule.StyleUtils.isSelfOrAncestorPositionFixed(t.getElement()),n=this._calcDropDownWidgetPosInfo(e,t,s)):n=this._calcPopupWidgetPosInfo(e,l),d&&n){var h=t||e,g=(r=h.getDocument?h.getDocument():h.ownerDocument,Kekule.DocumentUtils.getClientVisibleBox(r)),c=g.right-g.left,p=g.bottom-g.top,E=n.rect;E.left+E.width>c+g.left&&(n.width=g.right-E.left+"px",n.widthChanged=!0),E.top+E.height>p+g.top&&(n.height=g.bottom-E.top+"px",n.heightChanged=!0)}if(l?this.moveElemToTopmostLayer(a,!0):this.moveElemToTopmostLayer(a),n){var f=["left","top","right","bottom"];n.widthChanged&&f.push("width"),n.heightChanged&&f.push("height");var T={},C=a.style;i===u.DROPDOWN&&s?C.position="fixed":Kekule.StyleUtils.isAbsOrFixPositioned(a)||(C.position="absolute");for(var m=0,v=f.length;m<v;++m){var P=f[m],_=n[P];_&&(T[P]=C[P]||"",C[P]=_)}this._getElemStoredInfo(a).styles=T}},_calcPopupWidgetPosInfo:function(e,t){var i,n=Kekule.HtmlElementUtils,s=e.getElement();e.isShown()||(s.style.visible="hidden",s.style.display="");var a=n.getElemBoundingClientRect(s,!0);return i={rect:a},t||"fixed"!==Kekule.StyleUtils.getComputedStyle(s,"position")&&(i.top=a.top+"px",i.left=a.left+"px"),i},_calcDropDownWidgetPosInfo:function(e,t,i){var n=Kekule.HtmlElementUtils,s=Kekule.Widget.Position,a=t.getDropPosition?t.getDropPosition():null,r=t.getParent(),o=r&&r.getLayout()||Kekule.Widget.Layout.HORIZONTAL,l=t.getElement(),u=n.getElemBoundingClientRect(l,!0),d=Kekule.DocumentUtils.getClientVisibleBox(t.getDocument()),h=e.getElement();h.style.visible="hidden",h.style.display="";var g=this.getIsolatedLayer(h.ownerDocument,!0);g.appendChild(h),h.style.position="relative";var c=n.getElemOffsetDimension(h),p=n.getElemScrollDimension(h),E=n.getElemPageRect(h,!0);if(h.style.position="absolute",g.removeChild(h),!a||a===s.AUTO)if(a=0,o===Kekule.Widget.Layout.VERTICAL){var f=u.x-d.left,T=d.right-u.x-u.width;T>=c.width?a|=s.RIGHT:a|=f>T?s.LEFT:s.RIGHT}else{var C=u.y-d.top,m=d.bottom-u.y-u.height;m>=c.height?a|=s.BOTTOM:a|=C>m?s.TOP:s.BOTTOM}Kekule.StyleUtils,u=n.getElemBoundingClientRect(l,!i);var v,P,_=p.width,y=p.height;if(a&s.LEFT)v=u.left-E.width;else if(a&s.RIGHT)v=u.right;else{var S=u.right-d.left;v=d.right-u.left>=E.width?u.left:S>=E.width?u.right-E.width:Math.max(d.left,d.right-E.width)}if(a&s.TOP)P=u.top-E.height;else if(a&s.BOTTOM)P=u.bottom;else{var O=u.bottom-d.top;P=d.bottom-u.top>=E.height?u.bottom:O>=E.height?u.bottom-E.height:Math.max(d.top,d.bottom-E.height)}var D={};return D.rect={left:v,top:P,width:_,height:y},v+="px",P+="px",_+="px",y+="px",D.left=v,D.top=P,D.width=_,D.height=y,D},_fillPersistentPopupWidgetsInHidden:function(e,t,i,n){var s,a,r;n.push(e);try{e&&e instanceof Kekule.Widget.BaseWidget?(s=e.getElement(),a=e.getParent(),r=e.getPopupCaller()):s=e instanceof HTMLElement?e:null}catch(e){s=null}if(s){for(var o=0,l=t.length;o<l;++o){var u=t[o];if(u===e)i.push(u);else{var d=u.getElement();Kekule.DomUtils.isDescendantOf(s,d)&&i.push(u)}}a&&n.indexOf(a)<=0&&this._fillPersistentPopupWidgetsInHidden(a,t,i,n),r&&n.indexOf(r)<=0&&this._fillPersistentPopupWidgetsInHidden(r,t,i,n)}},hidePopupWidgets:function(e,t){var i=this.getPopupWidgets(),n=Kekule.Widget.getBelongedWidget(e),s=[];n&&this._fillPersistentPopupWidgetsInHidden(n,i,s,[]);for(var a=i.length-1;a>=0;--a){var r=i[a],o=r.getElement();if(o){if(s.indexOf(r)>=0)continue;e&&(o===e||Kekule.DomUtils.isDescendantOf(e,o))||(t?r.dismiss():r.hide())}else Kekule.ArrayUtils.remove(this.getPopupWidgets(),r)}},hideTopmostDialogWidget:function(e,t){var i=this.getDialogWidgets()||[],n=i[i.length-1];n&&(n.getElement()?t?n.dismiss():n.hide():Kekule.ArrayUtils.remove(this.geDialogWidgets(),n))},registerPopupWidget:function(e){e.addClassName(i.SHOW_POPUP),Kekule.ArrayUtils.pushUnique(this.getPopupWidgets(),e)},unregisterPopupWidget:function(e){e.removeClassName(i.SHOW_POPUP),Kekule.ArrayUtils.remove(this.getPopupWidgets(),e)},registerDialogWidget:function(e){e.addClassName(i.SHOW_DIALOG),Kekule.ArrayUtils.pushUnique(this.getDialogWidgets(),e)},unregisterDialogWidget:function(e){e.removeClassName(i.SHOW_DIALOG),Kekule.ArrayUtils.remove(this.getDialogWidgets(),e)},registerModalWidget:function(e){var t=this.getCurrModalWidget();t&&t.removeClassName(i.SHOW_ACTIVE_MODAL),Kekule.ArrayUtils.pushUnique(this.getModalWidgets(),e),e.addClassName(i.SHOW_ACTIVE_MODAL)},unregisterModalWidget:function(e){e.removeClassName(i.SHOW_ACTIVE_MODAL),Kekule.ArrayUtils.remove(this.getModalWidgets(),e);var t=this.getCurrModalWidget();t&&t.addClassName(i.SHOW_ACTIVE_MODAL)},getCurrModalWidget:function(){var e=this.getModalWidgets();return e&&e.length?e[0]:null},prepareModalWidget:function(e){var t=e.getDocument(),n=this.getModalBackgroundElem();n||((n=t.createElement("div")).className=i.MODAL_BACKGROUND,this.setPropStoreFieldValue("modalBackgroundElem",n));var s=e.getElement();e.setModalInfo({oldParent:s.parentNode,oldSibling:s.nextSibling}),s.parentNode&&s.parentNode.removeChild(s),n.parentNode&&n.parentNode.removeChild(n),t.body.appendChild(n),t.body.appendChild(s),this.registerModalWidget(e)},unprepareModalWidget:function(e){e.getDocument();this.unregisterModalWidget(e);var t=e.getElement().parentNode;t&&t.removeChild(e.getElement());var i=e.getModalInfo();i&&(i.oldParent&&i.oldParent.insertBefore(e.getElement(),i.oldSibling),e.setModalInfo(null));var n=this.getCurrModalWidget(),s=this.getModalBackgroundElem();s&&(n?(s.parentNode&&s.parentNode.removeChild(s),n.getElement().parentNode.insertBefore(s,n.getElement())):s.parentNode&&s.parentNode.removeChild(s))},registerAutoResizeWidget:function(e){Kekule.ArrayUtils.pushUnique(this.getAutoResizeWidgets(),e)},unregisterAutoResizeWidget:function(e){Kekule.ArrayUtils.remove(this.getAutoResizeWidgets(),e)},getTopmostLayer:function(e,t){return e.body},getIsolatedLayer:function(e,t){var i=e[this.ISOLATED_LAYER_FIELD];return!i&&t&&(i=this._createIsolatedLayer(e),e[this.ISOLATED_LAYER_FIELD]=i),i},_createIsolatedLayer:function(e){var t=e.createElement("div");return t.className=i.ISOLATED_LAYER,e.body.appendChild(t),t},_getElemStoredInfo:function(e){var t=null;return e&&((t=e[this.INFO_FIELD])||(t={},e[this.INFO_FIELD]=t)),t},_clearElemStoredInfo:function(e){e[this.INFO_FIELD]&&(e[this.INFO_FIELD]=void 0)},moveElemToTopmostLayer:function(e,t){if(!t){var i=this._getElemStoredInfo(e);i.parentElem=e.parentNode,i.nextSibling=e.nextSibling}this.getTopmostLayer(e.ownerDocument).appendChild(e)},restoreElem:function(e){if(e){var t=this._getElemStoredInfo(e);if(t){for(var i=t.styles,n=Kekule.ObjUtils.getOwnedFieldNames(i),s=e.style,a=0,r=n.length;a<r;++a){var o=n[a],l=i[o];l?s[o]=l:Kekule.StyleUtils.removeStyleProperty(s,o)}t.parentElem&&(t.nextSibling?t.parentElem.insertBefore(e,t.nextSibling):t.parentElem.appendChild(e)),e[this.INFO_FIELD]=null}}}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.GlobalManager),Kekule.Widget.globalManager=Kekule.Widget.GlobalManager.getInstance()}(),function(){"use strict";var e,t=function(){var e=["monospace","sans-serif","serif"],t=document.getElementsByTagName("body")[0],i=document.createElement("span");i.style.fontSize="72px",i.innerHTML="mmmmmmmmmmlli";var n={},s={};for(var a in e)i.style.fontFamily=e[a],t.appendChild(i),n[e[a]]=i.offsetWidth,s[e[a]]=i.offsetHeight,t.removeChild(i);this.detect=function(a){var r=!1;for(var o in e){i.style.fontFamily=a+","+e[o],t.appendChild(i);var l=i.offsetWidth!=n[e[o]]||i.offsetHeight!=s[e[o]];t.removeChild(i),r=r||l}return r}};Kekule.Widget.FontDetector={detect:function(i){var n=e;return n||(n=new t,e=n),n.detect(i)}};var i=["Arial, Helvetica, sans-serif","Georgia, Times New Roman, Times, serif","Courier New, Courier, monospace","Tahoma, Geneva, sans-serif","Trebuchet MS, Arial, Helvetica, sans-serif","Arial Black, Gadget, sans-serif","Palatino Linotype, Book Antiqua, Palatino, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","MS Serif, New York, serif","Lucida Console, Monaco, monospace","Comic Sans MS, cursive"];Kekule.Widget.FontEnumerator={getAvailableFontFamilies:function(e){e||(e=i);for(var t=[],n=0,s=e.length;n<s;++n){var a=e[n];Kekule.Widget.FontDetector.detect(a)&&t.push(a)}return t}}}(),function(){"use strict";Kekule.Widget.Clipboard=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Clipboard",STORAGE_KEY:"__$kekule_widget_clipboard__",initialize:function($super){if($super(),this._data=new Kekule.MapEx(!0),Kekule.BrowserFeature.localStorage){this._crossPageStorage=window.localStorage,this.setEnableCrossPageClipboard(!0);var e=this;Kekule.X.Event.addListener(window,"storage",function(t){if(e.getEnableCrossPageClipboard()){var i=t.key,n=e._extractSessionDataType(i);n&&e.invokeEvent("setData",{dataType:n,data:e.deserializeData(t.newValue)})}})}},finalize:function($super){this._data.finalize(),$super()},initProperties:function(){this.defineProp("enableCrossPageClipboard",{dataType:DataType.BOOL})},_useSessionClipboard:function(){return this.getEnableCrossPageClipboard()&&Kekule.BrowserFeature.localStorage},_extractSessionDataType:function(e){return e.startsWith(this.STORAGE_KEY)?e.substr(this.STORAGE_KEY.length):null},serializeData:function(e){var t;if(DataType.isSimpleValue(e))t=JSON.stringify(e);else{var i={};Class.ObjSerializerFactory.getSerializer("json").save(e,i),t=JSON.stringify(i)}return t},deserializeData:function(e){var t=JSON.parse(e);return DataType.isSimpleValue(t)?t:Class.ObjSerializerFactory.getSerializer("json").load(null,t)},setData:function(e,t){if(this._useSessionClipboard()){var i,n=this.serializeData(t);try{this._crossPageStorage.setItem(this.STORAGE_KEY+e,n),i=!0}catch(e){Kekule.warn(e)}i||this._data.set(e,t)}else this._data.set(e,t);return this.invokeEvent("setData",{dataType:e,data:t}),this},getData:function(e){if(this._useSessionClipboard()){var t,i;try{t=this._crossPageStorage.getItem(this.STORAGE_KEY+e),i=!0}catch(e){Kekule.warn(e)}if(i)return t?this.deserializeData(t):null}return this._data.get(e)},hasData:function(e){if(this._useSessionClipboard()){var t,i;try{t=this._crossPageStorage.getItem(this.STORAGE_KEY+e),i=!0}catch(e){Kekule.warn(e)}if(i)return Kekule.ObjUtils.notUnset(t)}return Kekule.ObjUtils.notUnset(this._data.get(e))},clearData:function(){if(this._useSessionClipboard())for(var e=this.getTypes(),t=0,i=e.length;t<i;++t)this._crossPageStorage.removeItem(this.STORAGE_KEY+e[t]);else this._data.clear();return this.invokeEvent("setData",{dataType:null,data:null}),this},getTypes:function(){if(this._useSessionClipboard()){for(var e=[],t=0,i=this._crossPageStorage.length;t<i;++t){var n=this._crossPageStorage.key(t),s=this._extractSessionDataType(n);s&&e.push(s)}return e}return this._data.getKeys()},setObjects:function(e,t){for(var i=[],n=Class.ObjSerializerFactory.getSerializer("json"),s=0,a=t.length;s<a;++s){var r=t[s],o={};n.save(r,o),i.push(o)}var l=JSON.stringify(i);return this.setData(e,l)},getObjects:function(e){var t=this.getData(e);if(DataType.isSimpleValue(t)){var i=JSON.parse(t);DataType.isArrayValue(i)||(i=[i]);for(var n=[],s=Class.ObjSerializerFactory.getSerializer("json"),a=0,r=i.length;a<r;++a){var o=i[a],l=s.load(null,o);n.push(l)}return n}return t}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.Clipboard),Kekule.Widget.clipboard=Kekule.Widget.Clipboard.getInstance()}(),function(){Kekule.Widget.EvokeMode={ALWAYS:0,EVOKEE_CLICK:1,EVOKEE_MOUSE_ENTER:2,EVOKEE_MOUSE_LEAVE:3,EVOKEE_MOUSE_DOWN:4,EVOKEE_MOUSE_UP:5,EVOKEE_MOUSE_MOVE:6,EVOKEE_TOUCH:7,EVOKER_CLICK:11,EVOKER_MOUSE_ENTER:12,EVOKER_MOUSE_LEAVE:13,EVOKER_MOUSE_DOWN:14,EVOKER_MOUSE_UP:15,EVOKER_MOUSE_MOVE:16,EVOKER_TOUCH:17,EVOKEE_TIMEOUT:21,EVOKER_TIMEOUT:22};var e=Kekule.Widget.EvokeMode;Kekule.Widget.DynamicEvokeHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DynamicEvokeHelper",evokeEvents:["click","mouseenter","mouseleave","mousedown","mouseup","touchstart"],DEF_TIMEOUT:5e3,initialize:function($super,e,t,i,n,s){$super(),this._timeoutRevokeHandle=null,this.reactEvokeEventsBind=this.reactEvokeEvents.bind(this),this.checkTimeoutRevokeBind=this.checkTimeoutRevoke.bind(this),this.setTimeout(s||this.DEF_TIMEOUT),this.setPropStoreFieldValue("evokeModes",i||[]),this.setPropStoreFieldValue("revokeModes",n||[]),this.linkWidgets(e,t)},finalize:function($super){this.unlinkWidgets(this.getEvokee(),this.getEvoker()),$super()},initProperties:function(){this.defineProp("evokee",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("evoker",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("evokeModes",{dataType:DataType.ARRAY}),this.defineProp("revokeModes",{dataType:DataType.ARRAY}),this.defineProp("timeout",{dataType:DataType.INT}),this.defineProp("showHideType",{dataType:DataType.INT})},evoke:function(){this.getEvoker()&&(clearTimeout(this._timeoutRevokeHandle),this.getEvoker().show(this.getEvokee(),null,this.getShowHideType()),this.postponeTimeoutCheck())},revoke:function(){this.getEvoker()&&(clearTimeout(this._timeoutRevokeHandle),this.getEvoker().getDocument().body.focus(),this.getEvoker().hide(this.getEvokee(),null,this.getShowHideType()))},doObjectChange:function($super,e){$super(e),Kekule.ArrayUtils.intersect(e,["evokeModes","revokeModes"]).length>0&&this.evokeModesChanged()},linkWidgets:function(e,t){this.setPropStoreFieldValue("evokee",e),this.setPropStoreFieldValue("evoker",t),this.installEventHandlers(e,this.evokeEvents,this.reactEvokeEventsBind),this.installEventHandlers(t,this.evokeEvents,this.reactEvokeEventsBind),this.updateOnAlwaysMode()},unlinkWidgets:function(e,t){this.uninstallEventHandlers(e,this.evokeEvents,this.reactEvokeEventsBind),this.uninstallEventHandlers(t,this.evokeEvents,this.reactEvokeEventsBind)},installEventHandlers:function(e,t,i){for(var n=0,s=t.length;n<s;++n)e.addEventListener(t[n],i)},uninstallEventHandlers:function(e,t,i){for(var n=0,s=t.length;n<s;++n)e.removeEventListener(t[n],i)},evokeModesChanged:function(){this.updateOnAlwaysMode()},updateOnAlwaysMode:function(){this.getEvokeModes().indexOf(e.ALWAYS)>=0?this.evoke():this.getRevokeModes().indexOf(e.ALWAYS)>=0&&this.revoke()},checkTimeoutRevoke:function(t){if(this.getEvoker()){var i=Kekule.DomUtils,n=this.getEvoker().getDocument().activeElement,s=this.getRevokeModes(),a=[];s.indexOf(e.EVOKEE_TIMEOUT)>=0&&a.push(this.getEvokee().getElement()),s.indexOf(e.EVOKER_TIMEOUT)>=0&&a.push(this.getEvoker().getElement());for(var r=!1,o=0,l=a.length;o<l;++o){var u=a[o];if(n===u||i.isDescendantOf(n,u)){r=!0;break}}r?this.postponeTimeoutCheck():this.revoke()}},postponeTimeoutCheck:function(){if(this.hasTimeoutMode(this.getRevokeModes())){if(this.getEvokeModes().indexOf(e.ALWAYS)>=0)return;this._timeoutRevokeHandle=setTimeout(this.checkTimeoutRevokeBind,this.getTimeout())}},hasTimeoutMode:function(t){return Kekule.ArrayUtils.intersect([e.EVOKEE_TIMEOUT,e.EVOKER_TIMEOUT],t).length>0},getEventTypeOfMode:function(t){switch(t){case e.EVOKEE_CLICK:case e.EVOKER_CLICK:return"click";case e.EVOKEE_MOUSE_ENTER:case e.EVOKER_MOUSE_ENTER:return"mouseenter";case e.EVOKEE_MOUSE_LEAVE:case e.EVOKER_MOUSE_LEAVE:return"mouseleave";case e.EVOKEE_MOUSE_DOWN:case e.EVOKER_MOUSE_DOWN:return"mousedown";case e.EVOKEE_MOUSE_UP:case e.EVOKER_MOUSE_UP:return"mouseup";case e.EVOKEE_MOUSE_MOVE:case e.EVOKER_MOUSE_MOVE:return"mousemove";case e.EVOKEE_TOUCH:case e.EVOKER_TOUCH:return"touchstart"}},isEvokeTargetOnEvokee:function(t){return t>=e.EVOKEE_CLICK&&t<=e.EVOKEE_TOUCH},reactEvokeEvents:function(t){var i=t.htmlEvent.getType(),n=t.target;if(n===this.getEvokee()||n===this.getEvoker()){var s=t.target===this.getEvokee();if(!this.getEvoker().isShown()){if(this.getRevokeModes().indexOf(e.ALWAYS)>=0)return;for(var a=0,r=(o=this.getEvokeModes()).length;a<r;++a)if(s===this.isEvokeTargetOnEvokee(o[a])&&i===this.getEventTypeOfMode(o[a]))return void this.evoke()}else{if(this.getEvokeModes().indexOf(e.ALWAYS)>=0)return;var o;for(a=0,r=(o=this.getRevokeModes()).length;a<r;++a)if(s===this.isEvokeTargetOnEvokee(o[a])&&i===this.getEventTypeOfMode(o[a]))return void this.revoke()}}}})}(),function(){"use strict";var e=Kekule.HtmlElementUtils;Kekule.Widget.StyleResource=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.StyleResource",initialize:function($super,e,t){$super(),this.setPropStoreFieldValue("name",e),t&&this.setCssClassName(t)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,setter:null}),this.defineProp("cssClassName",{dataType:DataType.STRING})},linkTo:function(t){return e.addClass(this._getElement(t),this.getCssClassName()),this},unlinkFrom:function(t){e.removeClass(this._getElement(t),this.getCssClassName())},_getElement:function(e){return e instanceof Kekule.Widget.BaseWidget?e.getElement():e}}),Kekule.Widget.StyleResourceManager={_resources:{},register:function(e){var i=e.getName();return i&&(t._resources[i]=e),t},unregister:function(e){var i;return"string"==typeof e?i=e:e.getName&&(i=e.getName()),i&&delete t._resources[i],t},getResource:function(e){return t._resources[e]}},Kekule.Widget.StyleResourceNames={PREFIX:"$$",CURSOR_ROTATE:"$$cursor_rotate",CURSOR_ROTATE_NE:"$$cursor_rotate_ne",CURSOR_ROTATE_NW:"$$cursor_rotate_nw",CURSOR_ROTATE_SE:"$$cursor_rotate_se",CURSOR_ROTATE_SW:"$$cursor_rotate_sw",ICON_COLOR_PICK:"$$icon_color_pick",ICON_COLOR_NOTSET:"$$icon_color_default",ICON_COLOR_MIXED:"$$icon_color_mixed",BUTTON_YES_OK:"$$btn_yes_ok",BUTTON_NO_CANCEL:"$$btn_no_cancel",BUTTON_RESET:"$$btn_reset",BUTTON_LOAD_FILE:"$$btn_load_file",ICON_REMOVE:"$$icon_remove"};var t=Kekule.Widget.StyleResourceManager,i=Kekule.Widget.StyleResource,n=Kekule.Widget.StyleResourceNames;t.register(new i(n.CURSOR_ROTATE,"K-Res-Cursor-Rotate")),t.register(new i(n.CURSOR_ROTATE_NE,"K-Res-Cursor-Rotate-NE")),t.register(new i(n.CURSOR_ROTATE_NW,"K-Res-Cursor-Rotate-NW")),t.register(new i(n.CURSOR_ROTATE_SE,"K-Res-Cursor-Rotate-SE")),t.register(new i(n.CURSOR_ROTATE_SW,"K-Res-Cursor-Rotate-SW")),t.register(new i(n.ICON_COLOR_PICK,"K-Res-Icon-Color-Pick")),t.register(new i(n.ICON_COLOR_NOTSET,"K-Res-Icon-Color-NotSet")),t.register(new i(n.ICON_COLOR_MIXED,"K-Res-Icon-Color-Mixed")),t.register(new i(n.BUTTON_YES_OK,"K-Res-Button-YesOk")),t.register(new i(n.BUTTON_NO_CANCEL,"K-Res-Button-NoCancel")),t.register(new i(n.BUTTON_RESET,"K-Res-Button-Reset")),t.register(new i(n.BUTTON_LOAD_FILE,"K-Res-Button-LoadFile")),t.register(new i(n.ICON_REMOVE,"K-Res-Icon-Remove"))}(),function(){var e=Kekule.DomUtils;Kekule.ArrayUtils;Kekule.Widget.AutoLauncher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.AutoLauncher",WIDGET_ATTRIB:"data-widget",WIDGET_ATTRIB_ALT:"data-kekule-widget",PLACEHOLDER_ATTRIB:"data-placeholder",FIELD_PARENT_WIDGET_ELEM:"__$kekule_parent_widget_elem$__",initialize:function($super){$super(),this._executingFlag=0,this._pendingWidgetRefMap=new Kekule.MapEx(!0),this._pendingElems=[],this._handlingPendings=!1,this._execOnPendingBind=this._execOnPending.bind(this);var e=this;Kekule.Widget.Utils._setWidgetRefPropFromId=function(t,i,n){if(n){var s=Kekule.Widget.getWidgetById(n,t.getDocument());if(s)t.setPropValue(i,s);else{var a=t.getDocument().getElementById(n);a&&e.isExecuting()&&e.addPendingWidgetRefItem(a,t,i)}}}},finalize:function($super){this._pendingElems=null,this._pendingWidgetRefMap=null,$super()},getPendingElems:function(){return this._pendingElems},addPendingElem:function(e,t,i,n,s){this._pendingElems.push({doc:e,elem:t,parent:i,widgetClass:n,execOnChildren:s})},handlePendingElems:function(e){if(!this._handlingPendings){if(this._handlingPendings=!0,e)this._pendingElems.push({callback:e});this.beginExec(),setTimeout(this._execOnPendingBind,0)}},_execOnPending:function(){var e=this._pendingElems.shift();if(e)try{e.elem?this.createWidgetOnElem(e.doc,e.elem,e.parent):e.callback&&setTimeout(e.callback,0)}finally{setTimeout(this._execOnPendingBind,0)}else this._handlingPendings=!1,this.endExec()},getPendingWidgetRefMap:function(){return this._pendingWidgetRefMap},addPendingWidgetRefItem:function(e,t,i){this._pendingWidgetRefMap.set(e,{widget:t,propName:i})},removePendingWidgetRefItem:function(e){this._pendingWidgetRefMap.remove(e)},handlePendingWidgetRef:function(){for(var e=this._pendingWidgetRefMap.getKeys(),t=0,i=e.length;t<i;++t){var n=e[t],s=Kekule.Widget.getWidgetOnElem(n);if(s){var a=this._pendingWidgetRefMap.get(n);a.widget.setPropValue(a.propName,s)}this.removePendingWidgetRefItem(n)}},beginExec:function(){++this._executingFlag},endExec:function(){this._executingFlag>0&&--this._executingFlag,this._executingFlag<=0&&this.handlePendingWidgetRef()},isExecuting:function(){return this._executingFlag>0},execute:function(e,t,i){var n=Kekule.ObjUtils.notUnset(t)?t:Kekule.Widget.AutoLauncher.deferring;n||this.beginExec();try{"function"==typeof e.querySelector?this.executeOnElemBySelector(e.ownerDocument,e,null,n):this.executeOnElem(e.ownerDocument,e,null,n),n&&this.handlePendingElems(i)}finally{n||(this.endExec(),i&&i())}},executeOnElem:function(t,i,n,s){if(this.isElemLaunchable(i)){var a=null,r=this.getElemWidgetClass(i),o=n;if(s)r&&(this.addPendingElem(t,i,n,r,!1),o=i);else{var l=n;!l||l instanceof Kekule.Widget.BaseWidget||(l=Kekule.Widget.getWidgetOnElem(n)),o=(a=this.createWidgetOnElem(t,i,l,r))||i}if(s&&!r||!s&&!a||Kekule.Widget.AutoLauncher.enableCascadeLaunch)for(var u=e.getDirectChildElems(i),d=0,h=u.length;d<h;++d){var g=u[d];this.executeOnElem(t,g,o,s)}}},executeOnElemBySelector:function(e,t,i,n){var s="["+this.WIDGET_ATTRIB+"],["+this.WIDGET_ATTRIB_ALT+"]",a=t.querySelectorAll(s);if(this.getElemWidgetClass(t)&&(a=Array.prototype.slice.call(a)).unshift(t),a&&a.length){for(var r=0,o=a.length;r<o;++r){var l=a[r],u=this._findParentCandidateElem(l,a,0,r-1);u&&(l[this.FIELD_PARENT_WIDGET_ELEM]=u)}for(r=0,o=a.length;r<o;++r){l=a[r];if(this.isElemLaunchable(l)){var d=l[this.FIELD_PARENT_WIDGET_ELEM]||null;!Kekule.Widget.AutoLauncher.enableCascadeLaunch&&d||(n?this.addPendingElem(e,l,d,null,!1):this.createWidgetOnElem(e,l,d))}}}},_findParentCandidateElem:function(e,t,i,n){for(var s=null,a=e.parentNode;a&&!s;){for(var r=n;r>=i;--r)if(a===t[r])return s=t[r];s||(a=a.parentNode)}return s},createWidgetOnElem:function(e,t,i,n){var s=null,a=Kekule.Widget.getWidgetOnElem(t);if(a)return a;if(n||(n=this.getElemWidgetClass(t)),n){var r=Kekule.Widget.AutoLauncher,o=!1;if(r.placeHolderStrategy!==r.PlaceHolderStrategies.DISABLED){var l=t.getAttribute(this.PLACEHOLDER_ATTRIB)||"";o=(o=r.placeHolderStrategy===r.PlaceHolderStrategies.EXPLICIT&&Kekule.StrUtils.strToBool(l)||r.placeHolderStrategy===r.PlaceHolderStrategies.IMPLICIT)&&ClassEx.getPrototype(n).canUsePlaceHolderOnElem(t)}if(s=o?new Kekule.Widget.PlaceHolder(t,n):new n(t)){var u=i;!u||u instanceof Kekule.Widget.BaseWidget||(u=Kekule.Widget.getWidgetOnElem(i)),u&&s.setParent(u)}}return s},isElemLaunchable:function(e){return!(e.isContentEditable&&!Kekule.Widget.AutoLauncher.enableOnEditable)},getElemWidgetClass:function(e){var t=null,i=e.getAttribute(this.WIDGET_ATTRIB);return i||(i=e.getAttribute(this.WIDGET_ATTRIB_ALT)),i&&(t=this.getWidgetClass(i)),t},getWidgetClass:function(e){return ClassEx.findClass(e)}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.AutoLauncher),Kekule.Widget.autoLauncher=Kekule.Widget.AutoLauncher.getInstance(),Kekule.Widget.AutoLauncher.PlaceHolderStrategies={DISABLED:"disabled",IMPLICIT:"implicit",EXPLICIT:"explicit"},Kekule.Widget.AutoLauncher.enabled=!0,Kekule.Widget.AutoLauncher.enableCascadeLaunch=!0,Kekule.Widget.AutoLauncher.enableDynamicDomCheck=!0,Kekule.Widget.AutoLauncher.enableOnEditable=!1,Kekule.Widget.AutoLauncher.placeHolderStrategy=Kekule.Widget.AutoLauncher.PlaceHolderStrategies.EXPLICIT,Kekule.Widget.AutoLauncher.deferring=!1,Kekule.Widget.WidgetsReady={isReady:!1,funcs:[],ready:function(e){t.isReady?e():t.funcs.push(e)},fireReady:function(){if(!t.isReady){t.isReady=!0;for(var e=t.funcs;e.length;){e.shift()()}}}};var t=Kekule.Widget.WidgetsReady;Kekule.Widget.ready=t.ready;var i=function(){if(!i.done)if(Kekule._isLoaded()){var e=Kekule.Widget.AutoLauncher.deferring?function(){Kekule.X.DomReady.resume()}:null,n=function(){try{t.fireReady()}finally{e&&e()}};if(Kekule.Widget.AutoLauncher.enabled?(Kekule.Widget.AutoLauncher.deferring&&Kekule.X.DomReady.suspend(),Kekule.Widget.autoLauncher.execute(document.body,null,n)):n(),Kekule.X.MutationObserver)new Kekule.X.MutationObserver(function(e){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck&&Kekule.Widget.AutoLauncher.enabled)for(var t=0,i=e.length;t<i;++t){var n=e[t];if("childList"===n.type)for(var s=n.addedNodes,a=0,r=s.length;a<r;++a){var o=s[a];o.nodeType===Node.ELEMENT_NODE&&Kekule.Widget.autoLauncher.execute(o)}}}).observe(document.body,{childList:!0,subtree:!0});else Kekule.X.Event.addListener(document,"DOMNodeInserted",function(e){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck&&Kekule.Widget.AutoLauncher.enabled){var t=e.getTarget();t.nodeType===(Node.ELEMENT_NODE||1)&&Kekule.Widget.autoLauncher.execute(t)}});i.done=!0}else Kekule._registerAfterLoadSysProc(i)};Kekule.X.domReady(i)}(),function(){var e=Kekule.Widget.Direction,t=Kekule.StyleUtils;Kekule.Widget.BaseTransition=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseTransition",initialize:function($super){$super()},initProperties:function(){this.defineProp("element",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("caller",{dataType:DataType.OBJECT,serializable:!1})},canExecute:function(e,t){return!0},prepare:function(e,t,i){},finish:function(e,t,i){},execute:function(e,t,i,n){this.setElement(e),t&&this.setCaller(t);var s=Object.extend({from:0,to:1},n),a=this,r=function(){r.__$applied__||(r.__$applied__=!0,a.finish(e,t,s),i&&i())};r.__$applied__=!1,this.prepare(e,t,s);a=this;var o={element:e,caller:t,callback:i,doneCallback:r,options:n,executor:this,halt:function(){a.halt(o)}};return this.doExecute(e,t,r,s),o},doExecute:function(e,t,i,n){},halt:function(e){e.executor!==this?e.executor.halt(e):(this.doHalt(e),e.doneCallback&&e.doneCallback())},doHalt:function(e){},setElementProp:function(e,t,i){}}),Kekule.Widget.Css3Transition=Class.create(Kekule.Widget.BaseTransition,{CLASS_NAME:"Kekule.Widget.Css3Transition",initialize:function($super){$super()},initProperties:function(){this.defineProp("cssProperty",{dataType:DataType.STRING}),this.defineProp("timingFunc",{dataType:DataType.STRING})},getAffectedCssPropNames:function(e){},getTransCssPropNames:function(e){},storeCssInlineValues:function(e,t){for(var i=e.style,n={},s=0,a=t.length;s<a;++s){var r=t[s];n[r]=i[r]}return n},restoreCssInlineValues:function(e,t,i){for(var n=e.style,s=0,a=t.length;s<a;++s){var r=t[s];if(i[r])n[r]=i[r];else try{n.removeProperty(r)}catch(e){n[r]=""}}},storeCssComputedValues:function(e,i){for(var n={},s=0,a=i.length;s<a;++s){var r=i[s],o=t.getComputedStyle(e,r);n[r]=o}return n},canExecute:function(e,t){return Kekule.BrowserFeature.cssTransition},isSupported:function(){return Kekule.BrowserFeature.cssTransition},isAppear:function(e){return!!e.isAppear},isDisappear:function(e){return!!e.isDisappear},setTransitionProp:function(e,t,i){for(var n=["Moz"+t.capitalizeFirst(),"Webkit"+t.capitalizeFirst(),t],s=0,a=n.length;s<a;++s)e[n[s]]=i},getOriginCssInlineValues:function(){return this._originCssInlineValues},getComputedCssValues:function(){return this._computedCssValues},prepare:function(e,t,i){this.setCssProperty(this.getTransCssPropNames(i).join(","));var n=this.getAffectedCssPropNames(i);this._affectedCssPropNames=n,this._originCssInlineValues=this.storeCssInlineValues(e,n),this._computedCssValues=this.storeCssComputedValues(e,n)},finish:function(e,t,i){(1===i.to||this.isAppear(i)||this.isDisappear(i))&&this.restoreCssInlineValues(e,this._affectedCssPropNames,this._originCssInlineValues)},doExecute:function(e,t,i,n){var s=Kekule.StyleUtils,a=e.style;this.isAppear(n),this.isDisappear(n);if(this.isSupported()){this.setElementProp(e,n.from,n),s.isDisplayed(e)||s.setDisplay(e,!0),s.isVisible(e)||s.setVisibility(e,!0);var r,o=this.getCssProperty();this.setTransitionProp(a,"transitionProperty",o),(o=this.getTimingFunc())&&this.setTransitionProp(a,"transitionTimingFunction",o),o=n.duration.toString()+"ms",this.setTransitionProp(a,"transitionDuration",o);var l=this,u=function(t){Kekule.X.Event.removeListener(e,"transitionend",u),l.setTransitionProp(a,"transition",""),r&&clearTimeout(r),i&&i()};this._currEventHandler=u,Kekule.X.Event.addListener(e,"transitionend",u),r=setTimeout(u,n.duration+100),setTimeout(function(){l.setElementProp(e,n.to,n)},0)}else{try{this.setElementProp(e,n.to,n)}catch(e){}i&&setTimeout(i,0)}},doHalt:function(e){var t=e.element;t&&this.setTransitionProp(t.style,"transitionProperty","none")}}),Kekule.Widget.Css3OpacityTrans=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3OpacityTrans",canExecute:function($super,e,t){return!!Kekule.BrowserFeature.cssTranform},getAffectedCssPropNames:function(e){return["opacity"]},getTransCssPropNames:function(e){return["opacity"]},setElementProp:function(e,t,i){var n=parseFloat(this._computedCssValues.opacity)||1;e.style.opacity=n*t}}),Kekule.Widget.Css3SlideTransition=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3SlideTransition",initialize:function($super,e){$super(),Kekule.ObjUtils.notUnset(e)&&this.setDirection(e)},initProperties:function(){this.defineProp("direction",{dataType:DataType.INT})},canExecute:function($super,e,t){return!0},prepare:function($super,e,i,n){t.setDisplay(e,!0),this._direction=this.getActualDirection(e,n),$super(e,i,n),e.style.overflow="hidden",this._clearDimesionConstraints(e)},_clearDimesionConstraints:function(e){var t=e.style;t.minWidth="0",t.minHeight="0",t.maxWidth="none",t.maxHeight="none"},setElementProp:function(i,n,s){var a,r=this._direction;if(e.isInHorizontal(r)){a=this.getComputedCssValues().width;var o=t.analysisUnitsValue(a);if(i.style.width=o.value*n+o.units,a=this.getComputedCssValues().left){var l=t.analysisUnitsValue(a);l.units===o.units&&(i.style.left=o.value*(1-n)+l.value+l.units)}}if(e.isInVertical(r)){a=this.getComputedCssValues().height;var u=t.analysisUnitsValue(a);if(i.style.height=u.value*n+u.units,a=this.getComputedCssValues().top){var d=t.analysisUnitsValue(a);d.units===u.units&&(i.style.top=u.value*(1-n)+d.value+d.units)}}},getAffectedCssPropNames:function(e){var t=[].concat(this.getTransCssPropNames(e));return t=t.concat(["overflow","min-width","min-height","max-width","max-height"])},getTransCssPropNames:function(t){var i=this.getActualDirection(this.getElement(),t),n=[];return e.isInHorizontal(i)&&(n.push("width"),i&e.RTL&&n.push("left")),e.isInVertical(i)&&(n.push("height"),i&e.BTT&&n.push("top")),n},getRefRect:function(e){var t,i=Kekule.HtmlElementUtils;return this.getCaller()?(t=i.getElemPageRect(this.getCaller()),Kekule.RectUtils.isZero(t)&&(t=(e||{}).callerPageRect||null)):t=null,t},getActualDirection:function(e,t){e||(e=this.getElement());var i=Kekule.Widget.Direction,n=Kekule.HtmlElementUtils,s=this.getDirection();if(!s||s===i.AUTO){var a=this.getRefRect(t);if(a){var r={x:a.x+a.width/2,y:a.y+a.height/2},o=n.getElemPagePos(e),l=n.getElemClientDimension(e),u={x:o.x+(l.width||0)/2,y:o.y+(l.height||0)/2},d=Kekule.CoordUtils.substract(u,r);if(a.width<1)s=d.x>=0?i.LTR:i.RTL;else if(d.x<1)s=d.y>=0?i.TTB:i.BTT;else{s=Math.abs(a.height/a.width)>Math.abs(d.y/d.x)?d.x>=0?i.LTR:i.RTL:d.y>=0?i.TTB:i.BTT}}else s=i.TTB}return s}}),Kekule.Widget.Css3GrowTransition=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3GrowTransition",initialize:function($super,e){$super(),e&&(e.ownerDocument?this.setBaseElement(e):this.setCaller(e))},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(e){var t=Kekule.HtmlElementUtils,i=null;return this.getBaseRect()?i=this.getBaseRect():this.getCaller()&&(i=t.getElemBoundingClientRect(this.getCaller(),!0),Kekule.RectUtils.isZero(i)&&(i=(e||{}).callerPageRect||null)),i||(i={x:0,y:0,width:0,height:0}),i},canExecute:function($super,e,t){return!0},prepare:function($super,e,i,n){t.setDisplay(e,!0),$super(e,i,n),e.style.overflow="hidden",Kekule.HtmlElementUtils.makePositioned(e);var s=this.getRefRect(n),a=Kekule.HtmlElementUtils.getElemBoundingClientRect(e,!0),r={x:a.x-s.x,y:a.y-s.y,width:a.width-s.width,height:a.height-s.height};this._delta=r,this._clearDimesionConstraints(e)},_clearDimesionConstraints:function(e){var t=e.style;t.minWidth="0",t.minHeight="0",t.maxWidth="none",t.maxHeight="none"},setElementProp:function(e,i,n){var s,a=this.getComputedCssValues(),r=this._delta,o=1-i,l=e.style;"px"===(s=t.analysisUnitsValue(a.left)).units&&(l.left=s.value-o*r.x+"px"),"px"===(s=t.analysisUnitsValue(a.top)).units&&(l.top=s.value-o*r.y+"px"),"px"===(s=t.analysisUnitsValue(a.width)).units&&(l.width=s.value-o*r.width+"px"),"px"===(s=t.analysisUnitsValue(a.height)).units&&(l.height=s.value-o*r.height+"px")},getAffectedCssPropNames:function(e){var t=[].concat(this.getTransCssPropNames(e));return t=t.concat(["overflow","min-width","min-height","max-width","max-height"])},getTransCssPropNames:function(e){return["left","top","width","height","position"]}}),Kekule.BrowserFeature&&Kekule.BrowserFeature.cssTranform&&(Kekule.Widget.Css3TransformTrans=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3TransformTrans",getAffectedCssPropNames:function(e){return["transform","transformOrigin"]},getTransCssPropNames:function(e){return["transform","transformOrigin"]},prepare:function($super,e,t,i){$super(e,t,i);var n=Kekule.StyleUtils.getTransformMatrixValues(e);n&&(n.scaleX=n.a,n.scaleY=n.d),this._computedTransMatrixInfo=n},setElemTransform:function(e,t,i,n,s){var a=[n,0,0,s,t,i];Kekule.StyleUtils.setTransformMatrixArrayValues(e,a)}}),Kekule.Widget.Css3TransformGrowTransition=Class.create(Kekule.Widget.Css3TransformTrans,{CLASS_NAME:"Kekule.Widget.Css3TransformGrowTransition",initialize:function($super,e){$super(),e&&(e.ownerDocument?this.setBaseElement(e):this.setCaller(e))},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(e){var t=Kekule.HtmlElementUtils,i=null;return this.getBaseRect()?i=this.getBaseRect():this.getCaller()&&(i=t.getElemBoundingClientRect(this.getCaller(),!0),Kekule.RectUtils.isZero(i)&&(i=(e||{}).callerPageRect||null)),i||(i={x:0,y:0,width:0,height:0}),i},prepare:function($super,e,i,n){t.setDisplay(e,!0),$super(e,i,n),e.style.overflow="hidden",Kekule.HtmlElementUtils.makePositioned(e);var s=this.getRefRect(n),a=Kekule.HtmlElementUtils.getElemBoundingClientRect(e,!0),r={x:a.x-s.x,y:a.y-s.y};this._translateDelta=r,this._initialScale={x:s.width/a.width,y:s.height/a.height},this._computedTransMatrixInfo?(this._endScale={x:this._computedTransMatrixInfo.scaleX,y:this._computedTransMatrixInfo.scaleY},this._endTranslate={x:this._computedTransMatrixInfo.tx,y:this._computedTransMatrixInfo.ty}):(this._endScale={x:1,y:1},this._endTranslate={x:0,y:0})},setElementProp:function(e,t,i){this.getComputedCssValues();var n=this._translateDelta,s=this._initialScale,a=this._endScale,r={x:this._endTranslate.x-(1-t)*n.x,y:this._endTranslate.y-(1-t)*n.y},o={x:t*a.x+(1-t)*s.x,y:t*a.y+(1-t)*s.y};e.style.transformOrigin="0 0 0",this.setElemTransform(e,r.x,r.y,o.x,o.y)}})),Kekule.Widget.Css3TransitionSimpleClassCreator={create:function(e,t,i,n){var s=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:e,initialize:function($super){$super(),this.setCssProperty(t),this.setTimingFunc(i)}});return n&&(s=ClassEx.extend(s,n)),s}};Kekule.Widget.Css3TransitionSimpleClassCreator}(),function(){Kekule.StyleUtils;Kekule.Widget.ShowHideManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideManager",initialize:function($super){$super(),this.setEnableTransition(!0),this.setShowDuration(450),this.setHideDuration(450)},initProperties:function(){this.defineProp("enableTransition",{dataType:DataType.BOOL}),this.defineProp("transitionSelector",{dataType:"Kekule.Widget.ShowHideTransitionSelector",serializable:!1}),this.defineProp("showDuration",{dataType:DataType.INT}),this.defineProp("hideDuration",{dataType:DataType.INT})},_getCallerElement:function(e){return e?e.getElement?e.getElement():Kekule.DomUtils.isElement(e)?e:null:null},isUsingTransition:function(){return this.getEnableTransition()&&this.getTransitionSelector()},selectTransition:function(e,t,i){var n=this.getTransitionSelector();if(!n)return null;var s=n.selectTransition(e,t,i);return s&&t&&s.setCaller(this._getCallerElement(t)),s},show:function(e,t,i,n,s){var a=Object.extend(s||{},{from:0,to:1,isAppear:!0,duration:this.getShowDuration()}),r=this.selectTransition(e,t,n);if(r&&this.isUsingTransition()&&r.canExecute(e.getElement(),a)){return r.execute(e.getElement(),this._getCallerElement(t),function(t){e.setVisible(!0,!0),e.setDisplayed(!0,!0),i&&i()},a)}return e.setVisible(!0,!0),e.setDisplayed(!0,!0),i&&i(),null},hide:function(e,t,i,n,s,a){var r=Object.extend(a,{from:1,to:0,isDisappear:!0,duration:this.getHideDuration()}),o=(s=!!a.useVisible,this.selectTransition(e,t,n));if(o&&this.isUsingTransition()&&o.canExecute(e.getElement(),r)){return o.execute(e.getElement(),this._getCallerElement(t),function(){e&&(s?e.setVisible(!1,!0):e.setDisplayed(!1,!0)),i&&i()},r)}return s?e.setVisible(!1,!0):e.setDisplayed(!1,!0),i&&i(),null}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.ShowHideManager),Kekule.Widget.showHideManager=Kekule.Widget.ShowHideManager.getInstance(),Kekule.Widget.ShowHideTransitionSelector=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideTransitionSelector",initialize:function($super){$super(),this.setTransitionClassMap({})},initProperties:function(){this.defineProp("transitionClassMap",{dataType:DataType.OBJECT,serializable:!1})},_getTransClassOfType:function(e){var t=this.getTransitionClassMap();return t[e]||t[Kekule.Widget.ShowHideType.DEFAULT]},addTransitionClass:function(e,t){this.getTransitionClassMap()[e]=t},selectTransition:function(e,t,i){var n;Kekule.Widget.ShowHideType;return(n=t?this._getTransClassOfType(i):this._getTransClassOfType(Kekule.Widget.ShowHideType.DEFAULT))?new n:null}});var e=new Kekule.Widget.ShowHideTransitionSelector,t=Kekule.Widget.ShowHideType;e.addTransitionClass(t.DEFAULT,Kekule.Widget.Css3OpacityTrans),e.addTransitionClass(t.DROPDOWN,Kekule.Widget.Css3SlideTransition),e.addTransitionClass(t.POPUP,Kekule.Widget.Css3TransformGrowTransition||Kekule.Widget.Css3GrowTransition),e.addTransitionClass(t.DIALOG,Kekule.Widget.Css3TransformGrowTransition||Kekule.Widget.Css3GrowTransition),Kekule.Widget.showHideManager.setTransitionSelector(e)}(),function(){"use strict";Kekule.HtmlElementUtils;var e=Kekule.X.Event,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{RESIZEGRIPPER:"K-Resize-Gripper"});var i=Class.PropertyScope;Kekule.Widget.ResizeGripper=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ResizeGripper",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e){if(this.reactMousemoveBind=this.reactMousemove.bind(this),this.reactMouseupBind=this.reactMouseup.bind(this),this.reactTouchmoveBind=this.reactTouchmove.bind(this),this.reactTouchendBind=this.reactTouchend.bind(this),$super(e),!this.getTarget())if(this.getParent())this.setTarget(this.getParent());else{var t=this.getElement().parentNode;t&&this.setTarget(t)}},initProperties:function(){this.defineProp("target",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getTarget()!==e&&(this.setPropStoreFieldValue("target",e),this.targetChanged(e))}}),this.defineProp("retainAspectRatio",{dataType:DataType.BOOL}),this.defineProp("isUnderResizing",{dataType:DataType.BOOL,serializable:!1,setter:null,scope:i.PRIVATE}),this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:!1,scope:i.PRIVATE}),this.defineProp("baseDimension",{dataType:DataType.HASH,serializable:!1,scope:i.PRIVATE}),this.defineProp("baseAspectRatio",{dataType:DataType.FLOAT,serializable:!1,scope:i.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+t.RESIZEGRIPPER},doCreateRootElement:function(e){return e.createElement("span")},targetChanged:function(e){var t;(t=this.targetIsWidget(e)?e.getResizerElement?e.getResizerElement():e.getChildrenHolderElement():e)&&this.appendToElem(t)},targetIsWidget:function(e){return e instanceof Kekule.Widget.BaseWidget},getTargetDimension:function(e){var t=e||this.getTarget();return this.targetIsWidget(t)?t.getDimension():Kekule.HtmlElementUtils.getElemPageRect(t,!0)},setTargetDimension:function(e,t,i){var n=e||this.getTarget();if(this.targetIsWidget(n))n.setDimension(t,i);else{var s=n.style;s.width=t+"px",s.height=i+"px"}},prepareResizing:function(e,t){if(!this.getIsUnderResizing()){var i=this._getMoveEventReceiverElem(this.getElement());this._installEventHandlers(i),this._setMouseCapture(this.getElement(),!0,t),this.setBaseCoord(e);var n=this.getTargetDimension();this.setBaseDimension(n),this.setBaseAspectRatio(n.width/n.height),this.setPropStoreFieldValue("isUnderResizing",!0)}},doneResizing:function(e){this._setMouseCapture(this.getElement(),!1,e);var t=this._getMoveEventReceiverElem(this.getElement());this._uninstallEventHandlers(t),this.setBaseCoord(null),this.setBaseDimension(null),this.setPropStoreFieldValue("isUnderResizing",!1)},resizeTo:function(e){var t=Kekule.CoordUtils.substract(e,this.getBaseCoord()),i=this.getBaseDimension(),n=i.width+t.x,s=i.height+t.y;if(this.getRetainAspectRatio()){var a=this.getBaseAspectRatio();n/s>a?n=a*s:n/s<a&&(s=n/a)}this.setTargetDimension(this.getTarget(),n,s)},reactMousemove:function(e){if(this.getIsUnderResizing()){var t={x:e.getScreenX(),y:e.getScreenY()};this.resizeTo(t),e.stopPropagation(),e.preventDefault()}},reactMouseup:function(e){e.getButton()===Kekule.X.Event.MouseButton.LEFT&&this.getIsUnderResizing()&&(this.doneResizing(e),e.preventDefault())},reactTouchmove:function(e){if(this.getIsUnderResizing()){var t={x:e.getScreenX(),y:e.getScreenY()};this.resizeTo(t),e.stopPropagation(),e.preventDefault()}},reactTouchend:function(e){this.getIsUnderResizing()&&(this.doneResizing(e),e.preventDefault())},_elemSupportCapture:function(e){return!!e.setCapture},_setMouseCapture:function(e,t,i){e&&(t?(e.setCapture&&e.setCapture(!0),e.setPointerCapture&&Kekule.ObjUtils.notUnset(i.pointerId)&&e.setPointerCapture(i.pointerId)):(e.releaseCapture&&e.releaseCapture(),e.releasePointerCapture&&Kekule.ObjUtils.notUnset(i.pointerId)&&e.releasePointerCapture(i.pointerId)))},_getMoveEventReceiverElem:function(e){return this._elemSupportCapture(e)?e:e.ownerDocument.documentElement},_installEventHandlers:function(t){e.addListener(t,"mousemove",this.reactMousemoveBind),e.addListener(t,"touchmove",this.reactTouchmoveBind),e.addListener(t,"mouseup",this.reactMouseupBind),e.addListener(t,"touchend",this.reactTouchendBind)},_uninstallEventHandlers:function(t){e.removeListener(t,"mousemove",this.reactMousemoveBind),e.removeListener(t,"touchmove",this.reactTouchmoveBind),e.removeListener(t,"mouseup",this.reactMouseupBind),e.removeListener(t,"touchend",this.reactTouchendBind)},doReactActiviting:function($super,e){$super(e);var t={x:e.getScreenX(),y:e.getScreenY()};this.prepareResizing(t,e)}}),ClassEx.extend(Kekule.Widget.BaseWidget,{resizableChanged:function(){var e;this.getResizable()?((e=new Kekule.Widget.ResizeGripper(this)).setRetainAspectRatio(this.getResizeWithAspectRatio()),this.setPropStoreFieldValue("resizeGripper",e)):((e=this.getResizeGripper())&&e.finalize(),this.setPropStoreFieldValue("resizeGripper",null))}}),ClassEx.defineProps(Kekule.Widget.BaseWidget,[{name:"resizable",dataType:DataType.BOOL,setter:function(e){e!==this.getResizable()&&(this.setPropStoreFieldValue("resizable",e),this.resizableChanged())}},{name:"resizeWithAspectRatio",dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("resizeWithAspectRatio",e),this.getResizeGripper()&&this.getResizeGripper().setRetainAspectRatio(e)}},{name:"isResizing",dataType:DataType.BOOL,serializable:!1,scope:i.PRIVATE,setter:null,getter:function(){var e=this.getResizeGripper();return!!e&&e.getIsUnderResizing()}},{name:"resizeGripper",dataType:"Kekule.Widget.ResizeGripper",serializable:!1,setter:null,scope:i.PRIVATE}])}(),function(){"use strict";var e=Kekule.HtmlElementUtils,t=Kekule.StyleUtils,i=Kekule.X.Event,n=Class.PropertyScope;Kekule.Widget.MoveHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.MoveHelper",initialize:function($super,e,t){$super(),this.reactMouseDownBind=this.reactMouseDown.bind(this),this.reactMouseUpBind=this.reactMouseUp.bind(this),this.reactMouseMoveBind=this.reactMouseMove.bind(this),this.reactTouchDownBind=this.reactTouchDown.bind(this),this.reactTouchEndBind=this.reactTouchEnd.bind(this),this.reactTouchMoveBind=this.reactTouchMove.bind(this),this.__$K_initialMoverInfo__={},this.setCssPropX("left").setCssPropY("top").setMovingCursor("move").setMovingCursorDelay(500),this.setTarget(e),this.setGripper(t),this.setEnabled(!0)},doFinalize:function($super){this.setGripper(null),$super()},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("target",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("gripper",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getPropStoreFieldValue("gripper")||this.getTarget()},setter:function(e){var t=this.getPropStoreFieldValue("gripper");e!==t&&(this.setPropStoreFieldValue("gripper",e),this.gripperChanged(e,t))}}),this.defineProp("isMoving",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("cssPropX",{dataType:DataType.STRING}),this.defineProp("cssPropY",{dataType:DataType.STRING}),this.defineProp("movingCursor",{dataType:DataType.STRING}),this.defineProp("movingCursorDelay",{dataType:DataType.INT}),this.defineProp("movable",{dataType:DataType.BOOL,setter:null,getter:function(){return this.getEnabled()&&this.getGripper()}})},_objIsWidget:function(e){return e instanceof Kekule.Widget.BaseWidget},_getElement:function(e){return this._objIsWidget(e)?e.getElement():e},getTargetElement:function(){var e=this.getTarget();return this._objIsWidget(e)?e.getElement():e},getGripperElement:function(){var e=this.getGripper();return this._objIsWidget(e)?e.getElement():e},gripperChanged:function(e,t){t&&this.installEventHandlers(this._getElement(t)),e&&this.installEventHandlers(this._getElement(e))},installEventHandlers:function(e){e&&(i.addListener(e,"mousedown",this.reactMouseDownBind),i.addListener(e,"touchstart",this.reactTouchDownBind))},uninstallEventHandlers:function(e){e&&(i.removeListener(e,"mousedown",this.reactMouseDownBind),i.removeListener(e,"touchstart",this.reactTouchDownBind))},_elemSupportCapture:function(e){return!!e.setCapture},_getMoveEventReceiverElem:function(e){return this._elemSupportCapture(e)?e:e.ownerDocument.documentElement},setMouseCapture:function(e){var t=this.getGripperElement();t&&(e?t.setCapture&&t.setCapture(!0):t.releaseCapture&&t.releaseCapture())},beginMoving:function(t){if(!this.getIsMoving()){var n=this.getTargetElement();e.makePositioned(n),this.saveInitialInformation(t);var s=this._getMoveEventReceiverElem(this.getGripperElement());i.addListener(s,"mousemove",this.reactMouseMoveBind),i.addListener(s,"touchmove",this.reactTouchMoveBind),i.addListener(s,"mouseup",this.reactMouseUpBind),i.addListener(s,"touchend",this.reactTouchEndBind),this.setMouseCapture(!0),this._setCursorHandle=this.delaySetMoveCursor(),this.setIsMoving(!0)}},endMoving:function(){this.setIsMoving(!1),this.setMouseCapture(!1);var e=this.getGripperElement(),t=this._getMoveEventReceiverElem(e);if(i.removeListener(t,"mousemove",this.reactMouseMoveBind),i.removeListener(t,"touchmove",this.reactTouchMoveBind),i.removeListener(t,"mouseup",this.reactMouseUpBind),i.removeListener(t,"touchend",this.reactTouchEndBind),this.clearCursorSetter(),e){var n=this.__$K_initialMoverInfo__.cursor;e.style.cursor=n||"",this.__$K_initialMoverInfo__.cursor=null}},moveTo:function(e){this.clearCursorSetter(),this.doSetMoveCursor();var t=this.getTargetElement();if(t){var i=this.__$K_initialMoverInfo__,n=Kekule.CoordUtils.substract(e,i.pointerCoord);"right"===(this.getCssPropX()||"").toLowerCase()?t.style.right=i.elemCoord.x-n.x+"px":t.style.left=i.elemCoord.x+n.x+"px","bottom"===(this.getCssPropY()||"").toLowerCase()?t.style.bottom=i.elemCoord.y-n.y+"px":t.style.top=i.elemCoord.y+n.y+"px"}},delaySetMoveCursor:function(){return setTimeout(this.doSetMoveCursor.bind(this),this.getMovingCursorDelay()||0)},doSetMoveCursor:function(){var e=this.getGripperElement();e&&this.getMovingCursor()&&(e.style.cursor=this.getMovingCursor())},clearCursorSetter:function(){this._setCursorHandle&&clearTimeout(this._setCursorHandle)},saveInitialInformation:function(i){var n=this.getTargetElement();if(n){var s;this.__$K_initialMoverInfo__.pointerCoord=i;var a=(t.getComputedStyle(n,"position")||"").toLowerCase(),r=(this.getCssPropX()||"left").toLowerCase(),o=(this.getCssPropY()||"top").toLowerCase();if("relative"===a)s={x:t.analysisUnitsValue(t.getComputedStyle(n,"left")).value||0,y:t.analysisUnitsValue(t.getComputedStyle(n,"top")).value||0},r="left",o="top";else s={x:n.offsetLeft,y:n.offsetTop};var l=e.getElemOffsetDimension(n);"right"===r&&(s.x+=l.width),"bottom"===o&&(s.y+=l.height),this.__$K_initialMoverInfo__.elemCoord=s,this.getGripperElement()&&(this.__$K_initialMoverInfo__.cursor=this.getGripperElement().style.cursor)}},reactMouseDown:function(e){this.getTargetElement()&&this.getEnabled()&&e.getButton()===i.MouseButton.LEFT&&(this.beginMoving({x:e.getScreenX(),y:e.getScreenY()},e.getTarget()),e.preventDefault())},reactMouseUp:function(e){e.getButton()===i.MouseButton.LEFT&&this.getIsMoving()&&(this.endMoving(),e.preventDefault())},reactMouseMove:function(e){if(this.getIsMoving()){var t={x:e.getScreenX(),y:e.getScreenY()};this.moveTo(t),e.preventDefault()}},reactTouchDown:function(e){this.getEnabled()&&(this.beginMoving({x:e.getScreenX(),y:e.getScreenY()},e.getTarget()),e.preventDefault())},reactTouchEnd:function(e){this.getIsMoving()&&(this.endMoving(),e.preventDefault())},reactTouchMove:function(e){if(this.getIsMoving()){var t={x:e.getScreenX(),y:e.getScreenY()};this.moveTo(t),e.preventDefault()}}}),ClassEx.extend(Kekule.Widget.BaseWidget,{_getMoveHelper:function(e){var t=this.getMoveHelper();return!t&&e&&(t=new Kekule.Widget.MoveHelper(this)),t},movingGripperChanged:function(){var e,t=this.getMovingGripper();t?(e=this._getMoveHelper(!0)).setGripper(t):(e=this._getMoveHelper(!1))&&e.setGripper(null)}}),ClassEx.defineProps(Kekule.Widget.BaseWidget,[{name:"movable",dataType:DataType.BOOL,getter:function(){return this._getMoveHelper()&&this._getMoveHelper().getMovable()},setter:function(e){if(e!==this.getMovable())if(e)this.setMovingGripper(this.getDefaultMovingGripper&&this.getDefaultMovingGripper()||this);else{var t=this._getMoveHelper();t&&t.setEnabled(!1)}}},{name:"movingGripper",dataType:DataType.OBJECT,setter:function(e){e!==this.getMovingGripper()&&(this.setPropStoreFieldValue("movingGripper",e),this.movingGripperChanged())}},{name:"isMoving",dataType:DataType.BOOL,serializable:!1,scope:n.PRIVATE,setter:null,getter:function(){var e=this.getMoveHelper();return!!e&&e.getIsMoving()}},{name:"moveHelper",dataType:"Kekule.Widget.MoveHelper",serializable:!1,setter:null,scope:n.PRIVATE}])}(),function(){var e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.Glyph=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Glyph",initialize:function($super,e,t){this._imgElem=null,$super(e),t&&this.setNormalInfo(t)},initProperties:function(){this.defineImgInfoProp("normalInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("hoverInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("focusedInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("activeInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("disabledInfo",{dataType:DataType.HASH})},defineImgInfoProp:function(e,t){var i=Object.extend({setter:function(t){t?this.setPropStoreFieldValue(e,Object.extend({},t)):this.setPropStoreFieldValue(e,null),this.imgInfoChanged()}},t);return this.defineProp(e,i)},doGetWidgetClassName:function(){return"K-Glyph"},doCreateRootElement:function(e){return e.createElement("span")},doBindElement:function($super,e){$super(),this.createImgContainer(e)},createImgContainer:function(e,i){var n=e.ownerDocument;this._imgElem=n.createElement("span"),this._imgElem.className=t.FULLFILL,e.innerHTML="",e.appendChild(this._imgElem)},imgInfoChanged:function(){this.updateImg()},stateChanged:function($super){$super(),this.updateImg()},updateImg:function(){var e=Kekule.Widget.State,t=this.getState(),i=t===e.DISABLED?this.getDisabledInfo():t===e.ACTIVE?this.getActiveInfo()||this.getHoverInfo()||this.getFocusedInfo():t===e.HOVER?this.getHoverInfo():t===e.FOCUSED?this.getFocusedInfo():this.getNormalInfo();i=i||this.getNormalInfo(),this.showImgOfInfo(i)},showImgOfInfo:function(i){var n=this._imgElem;n&&(i?(i.className?(n.className=t.FULLFILL,e.addClass(n,i.className)):n.className=t.FULLFILL,n.style.backgroundImage=i.src?"url("+i.src+")":"",n.style.backgroundPosition=i.position||"",n.style.backgroundRepeat=i.repeat||"no-repeat"):n.style.backgroundImage="")}})}(),function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{CONTAINER:"K-Container",PANEL:"K-Panel",PANEL_CAPTION:"K-Panel-Caption",TOOLBAR:"K-Toolbar"});var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames),i=Kekule.StyleUtils;Kekule.Widget.Container=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Container",initialize:function($super,e){$super(e),this.reactShowStateChangeBind=this.reactShowStateChange.bind(this),this.addEventListener("showStateChange",this.reactShowStateChangeBind)},finalize:function($super){this.removeEventListener("showStateChange",this.reactShowStateChangeBind),this.clearWidgets(),$super()},initProperties:function(){this.defineChildDimensionRelatedProp("childWidth"),this.defineChildDimensionRelatedProp("childHeight"),this.defineChildDimensionRelatedProp("childMargin"),this.defineProp("firstChild",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("lastChild",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("allowChildWrap",{dataType:DataType.BOOL,serializable:!1,setter:function(e){this.setPropStoreFieldValue("allowChildWrap",e),e?this.removeClassName(t.NOWRAP):this.addClassName(t.NOWRAP)}})},initPropValues:function($super){$super(),this.setAllowChildWrap(!0)},defineChildDimensionRelatedProp:function(e,t){var i=Object.extend({dataType:DataType.STRING,setter:function(t){this.setPropStoreFieldValue(e,t),this.updateChildSizes()}},t||{});return this.defineProp(e,i)},doGetWidgetClassName:function(){return t.CONTAINER},doCreateRootElement:function(e){return e.createElement("span")},getContainerElement:function(){return this.getElement()},appendWidget:function(e){return e.setParent(this),this},insertWidgetBefore:function(e,t){return e.insertToWidget(this,t),this},removeWidget:function(e,t){e.setParent(null),t||e.finalize()},clearWidgets:function(e){for(var t=this.getChildWidgets(),i=t.length-1;i>=0;--i){var n=t[i];this.removeWidget(n,e)}},_insertChildWidget:function(e,t){var i=t?t.getElement():null,n=this.getContainerElement();n&&(i?n.insertBefore(e.getElement(),i):n.appendChild(e.getElement()))},reactShowStateChange:function(e){this.childrenModified()},childrenModified:function($super){$super();for(var e=this.getChildWidgets(),i=e.length,n=e[a=0];n&&!n.isShown(!0)&&a<i;)n=e[++a];var s=a<i?n:null,a=i-1;for(n=e[i-1];n&&!n.isShown(!0)&&a>=0;)n=e[--a];var r=a>=0?n:null,o=this.getFirstChild(),l=this.getLastChild();s!==o&&(o&&o.removeClassName(t.FIRST_CHILD),s&&s.addClassName(t.FIRST_CHILD),this.setPropStoreFieldValue("firstChild",s)),r!==l&&(l&&l.removeClassName(t.LAST_CHILD),r&&r.addClassName(t.LAST_CHILD),this.setPropStoreFieldValue("lastChild",r))},childWidgetAdded:function($super,e){$super(e);var t=this.getChildWidth();t&&e.setWidth(t);var i=this.getChildHeight();i&&e.setHeight(i);var n=this.getChildMargin();n&&(e.getStyle().margin=n),this._insertChildWidget(e,null)},childWidgetRemoved:function($super,e){$super(e)},childWidgetMoved:function($super,e,t){$super(e,t);var i=e.getElement(),n=this.getChildWidgets()[t+1],s=n?n.getElement():null;s?this.getContainerElement().insertBefore(i,s):this.getContainerElement().appendChild(i)},updateChildSizes:function(){for(var e=this.getChildWidgets(),t=this.getChildWidth()||"",i=this.getChildHeight()||"",n=this.getChildMargin()||"",s=(this.getLayout(),0),a=e.length;s<a;++s){var r=e[s];r.setWidth(t),r.setHeight(i),r.getStyle().margin=n}}}),Kekule.Widget.Panel=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Panel",initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return this.getCaptionElem(!1)&&e.getElementText(this.getCaptionElem())},setter:function(t){e.setElementText(this.getCaptionElem(!0),t),i.setDisplay(this.getCaptionElem(),!!t)}}),this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(i){var n=this.getPropStoreFieldValue("captionElem");if(!n&&i){(n=this.getDocument().createElement("div")).className=t.PANEL_CAPTION;var s=this.getElement();s.insertBefore(n,e.getFirstChildElem(s)),this.setPropStoreFieldValue("captionElem",n)}return n}})},initPropValues:function($super){$super(),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function($super){return $super()+" "+t.PANEL}}),Kekule.Widget.WidgetGroup=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGroup",initialize:function($super,e){$super(e)},initPropValues:function($super){$super(),this.setUseCornerDecoration(!0)},doObjectChange:function($super,e){$super(e),e.indexOf("useCornerDecoration")>=0&&this._updateChildStyles()},childWidgetAdded:function($super,e){e.setUseCornerDecoration&&e.setUseCornerDecoration(!1),$super(e)},layoutChanged:function($super){$super(),this._updateChildStyles()},childrenModified:function($super){$super(),this._updateChildStyles()},_updateChildStyles:function(){Kekule.Widget.Layout,this.getLayout();for(var e=this.getFirstChild(),i=this.getLastChild(),n=this.getUseCornerDecoration(),s=this.getChildWidgets(),a=[t.CORNER_LEADING,t.CORNER_TAILING],r=0,o=s.length;r<o;++r){var l=s[r];l.removeClassName(a),l===e&&n&&l.addClassName(t.CORNER_LEADING),l===i&&n&&l.addClassName(t.CORNER_TAILING)}}}),Kekule.Widget.Toolbar=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.Toolbar",finalize:function($super){var e=this.getChildWidgetInternalNameMap();e&&e.finalize(),$super()},initProperties:function(){this.defineProp("childDefs",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("childDefs",e),this.recreateChildrenByDefs()}}),this.defineProp("childWidgetInternalNameMap",{dataType:DataType.OBJECT,serializable:!1})},doGetWidgetClassName:function($super){return $super()+" "+t.TOOLBAR},doSetShowText:function($super,e){$super(e),this._updateAllChildTextGlyphStyles()},doSetShowGlyph:function($super,e){$super(e),this._updateAllChildTextGlyphStyles()},childWidgetAdded:function($super,e){$super(e),this._updateChildTextGlyphStyles(e)},_updateChildTextGlyphStyles:function(e){e.setShowText&&e.setShowText(this.getShowText()),e.setShowGlyph&&e.setShowGlyph(this.getShowGlyph())},_updateAllChildTextGlyphStyles:function(){for(var e=this.getChildWidgets(),t=e.length-1;t>=0;--t)this._updateChildTextGlyphStyles(e[t])},recreateChildrenByDefs:function(){var e=this.getChildDefs()||[];this.clearWidgets();var t=new Kekule.MapEx(!0);this.setChildWidgetInternalNameMap(t);for(var i=this.getDefaultChildWidgetClassName(),n=0,s=e.length;n<s;++n){var a=e[n];a.widget||a.widgetClass||!i||(a=Object.extend({widget:i},a));var r=Kekule.Widget.createFromHash(this,a);r&&(r.appendToWidget(this),a.internalName&&t.set(a.internalName,r))}},getDefaultChildWidgetClassName:function(){return null},getChildWidgetByInternalName:function(e){var t=this.getChildWidgetInternalNameMap();return t?t.get(e):null}})}(),function(){"use strict";var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames);Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MENU:"K-Menu",POPUPMENU:"K-PopupMenu",MENUBAR:"K-MenuBar",MENUITEM:"K-MenuItem",MENUITEM_NORMAL:"K-MenuItem-Normal",MENUITEM_SEPARATOR:"K-MenuItem-Separator",SUBMENU_MARKER:"K-SubMenu-Marker",CHECKMENU_MARKER:"K-CheckMenu-Marker"}),Kekule.Widget.MenuItem=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.MenuItem",BINDABLE_TAG_NAMES:["li"],SUB_MENU_TAGS:["ol","ul"],initialize:function($super,e,t){$super(e),t&&this.setText(t),this._subMenuMarker=null,this._checkMarker=null},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(e){e===Kekule.Widget.MenuItem.SEPARATOR_TEXT?this.setIsSeparator(!0):(e&&this.setIsSeparator(!1),this.changeContentText(e))}}),this.defineProp("checked",{dataType:DataType.BOOL,setter:function(e){this.getPropStoreFieldValue("checked")!==e&&(this.setPropStoreFieldValue("checked",e),this.checkChanged())}}),this.defineProp("autoCheck",{dataType:DataType.BOOL}),this.defineProp("isSeparator",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("isSeparator",e),this.isSeparatorChanged(e)}})},initPropValues:function($super){$super(),this.setUseCornerDecoration(!1),this.setIsSeparator(!1)},doGetWidgetClassName:function($super){return $super()+" "+t.MENUITEM},doCreateRootElement:function(e){return e.createElement("li")},changeContentText:function(e){this.getElement().innerHTML=e||""},isSeparatorChanged:function(e){e?(this.setText("&nbsp;"),this.removeClassName(t.MENUITEM_NORMAL),this.addClassName(t.MENUITEM_SEPARATOR),this.setStatic(!0)):(this.removeClassName(t.MENUITEM_SEPARATOR),this.addClassName(t.MENUITEM_NORMAL),this.setStatic(!1))},doBindElement:function($super,t){$super(t);for(var i=e.getDirectChildElems(t),n=0,s=i.length;n<s;++n){var a=i[n];a.nodeType===Node.ELEMENT_NODE&&this.bindSubMenu(a),a=a.nextSibling}},doDomElemAdded:function(e){Kekule.Widget.getWidgetOnElem(e)||this.bindSubMenu(e)},checkChanged:function(){this.getChecked()?(this._createCheckMarker(),this.addClassName(t.STATE_CHECKED),this.invokeEvent("check")):this.removeClassName(t.STATE_CHECKED)},_createCheckMarker:function(){var e;(e=this._checkMarker)||((e=this.getDocument().createElement("span")).className=t.CHECKMENU_MARKER,this.getElement().appendChild(e),this._checkMarker=e);return e},_removeCheckMarker:function(){this._checkMarker&&(this._checkMarker.parentNode.removeChild(this._checkMarker),this._checkMarker=null)},childWidgetAdded:function($super,e){if($super(e),e instanceof Kekule.Widget.Menu)e.setIsSubMenu(!0);else if(e instanceof Kekule.Widget.MenuItem){var t=this.getSubMenu(!0);(function(){e.setParent(t),e.appendToWidget(t)}).defer(10)}},childrenModified:function($super){$super(),this.subMenuChanged()},bindSubMenu:function(e){var t=e.tagName.toLowerCase();if("ul"===t||"ol"===t){var i=new Kekule.Widget.PopupMenu(e);return this.addSubMenu(i),i}},subMenuChanged:function(){var e=this.getSubMenu();e?this._createSubMenuMarker(e):this._removeSubMenuMarker()},getSubMenu:function(e){for(var t=this.getChildWidgets(),i=0,n=t.length;i<n;++i){var s=t[i];if(s instanceof Kekule.Widget.Menu)return s}return e?this.createSubMenu():null},addSubMenu:function(e){return e.appendToWidget(this),this},removeSubMenu:function(e){return e.setParent(null),e},createSubMenu:function(){var e=new Kekule.Widget.PopupMenu(this);return this.addSubMenu(e),e},_createSubMenuMarker:function(e){var i;(i=this._subMenuMarker)||((i=this.getDocument().createElement("span")).className=t.SUBMENU_MARKER,this.getElement().appendChild(i),this._subMenuMarker=i);return i},_removeSubMenuMarker:function(){this._subMenuMarker&&(this._subMenuMarker.parentNode.removeChild(this._subMenuMarker),this._subMenuMarker=null)},isLeafItem:function(){var e=this.getElement();return!(e.getElementsByTagName("ul").length||e.getElementsByTagName("ol").length)},isPeriodicalExecuting:function($super){return $super()&&this.getIsActive()},doReactActiviting:function($super,e){$super(e),this.isLeafItem()&&this.getEnablePeriodicalExec()&&this.startPeriodicalExec(e)},doReactDeactiviting:function($super,e){this.isLeafItem()&&(this.stopPeriodicalExec(),this.getIsActive()&&(this.execute(e),this.getAutoCheck()&&this.setChecked(!this.getChecked()),this.notifyDeactivated()))},notifyDeactivated:function(){var e=this.getParent();e&&e.childDeactivated&&e.childDeactivated(this)},childDeactivated:function(e){var t=this.getParent();t&&t.childDeactivated&&t.childDeactivated(this)}}),Kekule.Widget.MenuItem.SEPARATOR_TEXT="-",Kekule.Widget.MenuItem.createFromHash=function(e,t){var i=t;return DataType.isSimpleValue(i)&&(i=i===Kekule.Widget.MenuItem.SEPARATOR_TEXT?{isSeparator:!0}:{text:i}),i.widget||i.widgetClass||(i.widget=Kekule.Widget.MenuItem),Kekule.Widget.createFromHash(e,i)},Kekule.Widget.Menu=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Menu",BINDABLE_TAG_NAMES:["ol","ul"],MENU_ITEM_TAG:"li",initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("isSubMenu",{dataType:DataType.BOOL,serializable:!1,setter:function(e){this.setPropStoreFieldValue("isSubMenu",e),e&&this.setLayout(Kekule.Widget.Layout.VERTICAL)}})},initPropValues:function($super){$super(),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function($super){return $super()+" "+t.MENU},doCreateRootElement:function(e){return e.createElement("ul")},doBindElement:function($super,e){$super(e);for(var t=Kekule.DomUtils.getDirectChildElems(e),i=0,n=t.length;i<n;++i){var s=t[i];s.nodeType===Node.ELEMENT_NODE&&this.bindMenuItem(s),s=s.nextSibling}},doDomElemAdded:function(e){this.bindMenuItem(e)},bindMenuItem:function(e){if("li"===e.tagName.toLowerCase()){var t=new Kekule.Widget.MenuItem(e);return t.setParent(this),t}},getSubMenuTagName:function(){return this.getElement().tagName},getMenuItems:function(t){t||(t=this.getElement());for(var i=e.getDirectChildElems(t,this.MENU_ITEM_TAG),n=[],s=0,a=i.length;s<a;++s){var r=Kekule.Widget.getWidgetOnElem(i[s]);r&&r instanceof Kekule.Widget.MenuItem&&n.push(r)}return n},insertMenuItem:function(e,t){return e.insertToWidget(this,t),this},appendMenuItem:function(e){return e.appendToWidget(this),this},removeMenuItem:function(e,t){e.setParent(null),t||e.finalize()},clearMenuItems:function(e){return this.clearWidgets(e),this},isTopLevel:function(){var e=this.getParent();return!e||!(e instanceof Kekule.Widget.MenuItem||e instanceof Kekule.Widget.Menu)},childDeactivated:function(e){var t=this.getParent();t&&t.childDeactivated&&t.childDeactivated(this)},createChildrenByDefs:function(e){for(var t=0,i=e.length;t<i;++t){var n=e[t];Kekule.Widget.MenuItem.createFromHash(this,n)}return this}}),Kekule.Widget.PopupMenu=Class.create(Kekule.Widget.Menu,{CLASS_NAME:"Kekule.Widget.PopupMenu",initPropValues:function($super){$super(),this.setLayout(Kekule.Widget.Layout.VERTICAL)},doGetWidgetClassName:function($super){return $super()+" "+t.POPUPMENU},childDeactivated:function(e){}}),Kekule.Widget.MenuBar=Class.create(Kekule.Widget.Menu,{CLASS_NAME:"Kekule.Widget.MenuBar",doGetWidgetClassName:function($super){return $super()+" "+t.MENUBAR}})}(),function(){"use strict";var e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{BUTTON:"K-Button",BUTTON_KINDED:"K-Button-Kinded",BUTTON_GROUP:"K-Button-Group",COMPACT_BUTTON:"K-Compact-Button",BTN_COMPACT_MARK:"K-Compact-Mark"}),Kekule.Widget.Button=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Button",BINDABLE_TAG_NAMES:["input","button","a","label"],CSS_DROPDOWN_CLASS_NAME:"K-DropDownMark",DEF_GLYPH_WIDTH:"16px",DEF_GLYPH_HEIGHT:"16px",initialize:function($super,e,t){this._elemTextPart=null,this._elemLeadingGlyphPart=null,this._elemTailingGlyphPart=null,$super(e),t&&this.setText(t)},initProperties:function(){this.defineElemAttribMappingProp("actionType","type"),this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this._elemTextPart||this.getElement();return e?e.innerHTML:null},setter:function(e){this.changeContentText(e)}}),this.defineProp("leadingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("leadingGlyph");return!t&&e&&(t=this._createDefaultGlyphWidget(this._elemLeadingGlyphPart),this.setPropStoreFieldValue("leadingGlyph",t)),t}}),this.defineProp("tailingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("tailingGlyph");return!t&&e&&(t=this._createDefaultGlyphWidget(this._elemTailingGlyphPart),this.setPropStoreFieldValue("tailingGlyph",t)),t}}),this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("showLeadingGlyph",e),this._elemLeadingGlyphPart.style.display=e&&this.getShowGlyph()?"":"none"}}),this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("showTailingGlyph",e),this._elemTailingGlyphPart.style.display=e&&this.getShowGlyph()?"":"none"}}),this.defineProp("buttonKind",{dataType:DataType.STRING,setter:function(e){var t=this.getButtonKind();e!==t&&(this.cancelButtonKind(t),this.applyButtonKind(e),this.setPropStoreFieldValue("buttonKind",e))}})},initPropValues:function($super){$super(),this.setPropStoreFieldValue("showText",!0),this.setPropStoreFieldValue("showGlyph",!0),this.setPropStoreFieldValue("showLeadingGlyph",!0),this.setPropStoreFieldValue("showTailingGlyph",!0),this.setPropStoreFieldValue("useCornerDecoration",!0),this.setAllowTextWrap(!1)},_createDefaultGlyphWidget:function(e){var t=new Kekule.Widget.Glyph(this);return t.setWidth(this.DEF_GLYPH_WIDTH).setHeight(this.DEF_GLYPH_HEIGHT),t.setStatic(!0).setInheritState(!0).setInheritStatic(!0).setInheritEnabled(!0),t.appendToElem(e),t},doGetWidgetClassName:function($super){return $super()+" "+t.BUTTON},doCreateRootElement:function(e){var t=e.createElement("button");return t.setAttribute("type","button"),t},doBindElement:function($super,i){$super(i);var n=i.innerHTML||"";i.innerHTML="",this._elemTextPart=this.createTextContent(n,i),this._elemLeadingGlyphPart=this.createGlyphContent(i,this._elemTextPart,t.PART_PRI_GLYPH_CONTENT),this._elemTailingGlyphPart=this.createGlyphContent(i,null,t.PART_ASSOC_GLYPH_CONTENT),this.getUseCornerDecoration()&&e.addClass(i,t.CORNER_ALL)},changeContentText:function(e){this._elemTextPart.innerHTML=e||""},isPeriodicalExecuting:function($super){return $super()&&this.getIsActive()},doReactActiviting:function($super,e){$super(e),this.getEnablePeriodicalExec()&&this.startPeriodicalExec(e)},doReactDeactiviting:function($super,e){this.stopPeriodicalExec(),this.getIsActive()&&this.execute(e)},cancelButtonKind:function(e){e&&(this.removeClassName(e),this.removeClassName(t.BUTTON_KINDED))},applyButtonKind:function(e){e&&(this.addClassName(t.BUTTON_KINDED),this.addClassName(e))}}),Kekule.Widget.Button.Kinds={DROPDOWN:"K-Kind-DropDown",POPUP:"K-Kind-Popup",SEARCH:"K-Kind-Search",EDIT:"K-Kind-Edit",ENTER:"K-Kind-Enter"},Kekule.Widget.CheckButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.CheckButton",initialize:function($super,e,t){$super(e,t)},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,setter:function(e){this.getPropStoreFieldValue("checked")!==e&&(this.setPropStoreFieldValue("checked",e),this.checkChanged(),this.stateChanged())}}),this.defineProp("autoCheck",{dataType:DataType.BOOL})},initPropValues:function($super){$super(),this.setAutoCheck(!0)},checkChanged:function(){this.getChecked()?this.invokeEvent("check"):this.invokeEvent("uncheck"),this.invokeEvent("checkChange",{checked:this.getChecked()})},getStateClassName:function($super,e){return $super(this.getChecked()?Kekule.Widget.State.ACTIVE:e)},doReactDeactiviting:function($super,e){var t=this.getChecked();$super(e),this.getAutoCheck()&&this._doToggleCheckOnSelf(t)},_doToggleCheckOnSelf:function(e){this.getEnabled()&&this.setChecked(!e)}}),Kekule.Widget.RadioButton=Class.create(Kekule.Widget.CheckButton,{CLASS_NAME:"Kekule.Widget.RadioButton",initialize:function($super,e,t){$super(e,t)},initProperties:function(){this.defineProp("group",{dataType:DataType.STRING})},checkChanged:function($super){$super(),this.getChecked()&&this.uncheckSiblings()},uncheckSiblings:function(){var e=this.getParent(),t=this.getGroup();if(e)for(var i=e.getChildWidgets(),n=0,s=i.length;n<s;++n){var a=i[n];a!==this&&a.getGroup&&a.setChecked&&a.getGroup()===t&&a.setChecked(!1)}},doReactDeactiviting:function($super,e){$super(e)},_doToggleCheckOnSelf:function($super,e){e||$super(e)},_doCheckOnSelf:function(){this.getEnabled()&&this.setChecked(!0)}}),Kekule.Widget.DropDownButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.DropDownButton",doFinalize:function($super){$super()},initProperties:function(){this.defineProp("dropDownWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("dropDownWidget");if(!e){var t=this.getDropDownWidgetGetter();t&&(e=t(this),this.setPropStoreFieldValue("dropDownWidget",e))}return e},setter:function(e){this.setPropStoreFieldValue("dropDownWidget",e),e&&e.setDisplayed(!1)}}),this.defineProp("dropDownWidgetGetter",{dataType:DataType.FUNCTION,serializable:!1}),this.defineProp("dropPosition",{dataType:DataType.INT})},doCreateRootElement:function($super,e){return $super(e)},calcActualDropPosition:function(){var e=Kekule.Widget.Position,t=this.getDropPosition();if(!t){var i=this.getParent(),n=i?i.getLayout():Kekule.Widget.Layout.HORIZONTAL,s=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),!0),a=Kekule.HtmlElementUtils.getViewportDimension(this.getElement()),r=this.getDropDownWidget().getElement();r.style.visible="hidden",r.style.display="",this.getElement().appendChild(r);var o=Kekule.HtmlElementUtils.getElemOffsetDimension(r);if(this.getElement().removeChild(r),n)if(n===Kekule.Widget.Layout.VERTICAL){var l=s.x,u=a.width-l-s.width;t=u>=o.width?e.RIGHT:l>u?e.LEFT:e.RIGHT}else{var d=s.y,h=a.height-d-s.height;t=h>=o.height?e.BOTTOM:d>h?e.TOP:e.BOTTOM}}return t},showDropDownWidget:function(){var e=this.getDropDownWidget();e.getElement().style.position="absolute";this.getElement();e.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN),this.invokeEvent("dropDown",{dropDown:e})},hideDropDownWidget:function(){this.getDropDownWidget().hide(this)},isDropDownWidgetShown:function(){var e=this.getDropDownWidget();return e&&e.isShown()},doExecute:function($super,e){this.getDropDownWidget()&&(this.isDropDownWidgetShown()?this.hideDropDownWidget():this.showDropDownWidget()),$super(e)}}),Kekule.Widget.ButtonGroup=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Widget.ButtonGroup",initialize:function($super,e){$super(e)},initPropValues:function($super){$super(),this.setPropStoreFieldValue("showText",!0),this.setPropStoreFieldValue("showGlyph",!0),this.setAllowChildWrap(!1)},doGetWidgetClassName:function($super){return $super()+" "+t.BUTTON_GROUP},doCreateRootElement:function(e){return e.createElement("span")},getDefaultChildWidgetClassName:function(){return"Kekule.Widget.Button"}}),Kekule.Widget.CompactButtonSet=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.CompactButtonSet",initialize:function($super,e,t){this.reactSetButtonExecuteBind=this.reactSetButtonExecute.bind(this),this.setPropStoreFieldValue("showCompactMark",!0),this.setPropStoreFieldValue("cloneSelectedOutlook",!0),$super(e,t),this.getButtonSet()||this.initButtonGroup()},initProperties:function(){this.defineProp("buttonSet",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,setter:function(e){var t=this.getButtonSet();t!==e&&(t&&t.finalize(),this.initButtonGroup(e))}}),this.defineProp("buttonSetLayout",{dataType:DataType.INT}),this.defineProp("selected",{dataType:"Kekule.Widget.Button",serializable:!1,setter:function(e){if(e)this.getButtonSet().hasChild(e)&&(this.getCloneSelectedOutlook()&&this.cloneSetButton(e),e.setChecked&&e.setChecked(!0));else{var t=this.getSelected();t&&t.setChecked(!1)}this.setPropStoreFieldValue("selected",e)}}),this.defineProp("cloneSelectedOutlook",{dataType:DataType.BOOL}),this.defineProp("showCompactMark",{dataType:DataType.BOOL,setter:function(e){this.getShowCompactMark()!==e&&(this.setPropStoreFieldValue("showCompactMark",e),e?this.createCompactMark():this.removeCompactMark())}})},doGetWidgetClassName:function($super){return $super()+" "+t.COMPACT_BUTTON},doSetShowText:function($super,e){return this.getButtonSet()&&this.getButtonSet().setShowText(e),$super(e)},doSetShowGlyph:function($super,e){return this.getButtonSet()&&this.getButtonSet().setShowGlyph(e),$super(e)},createCompactMark:function(){var e=this.getElement();this._compactMark&&e.removeChild(this._compactMark);var i=this.getDocument().createElement("span");return i.className=t.BTN_COMPACT_MARK,e.appendChild(i),this._compactMark=i,i},removeCompactMark:function(){var e=this.getElement();this._compactMark&&e.removeChild(this._compactMark)},initButtonGroup:function(e){if(e)var t=this._getCheckedButtonInGroup(e);else e=new Kekule.Widget.ButtonGroup(this);e.setDisplayed(!1),e.setShowText(this.getShowText()),e.setShowGlyph(this.getShowGlyph()),this.setPropStoreFieldValue("buttonSet",e),this.setDropDownWidget(e),e.addEventListener("execute",this.reactSetButtonExecuteBind),e.addEventListener("check",this.reactSetButtonExecuteBind),t&&this.cloneSetButton(t)},_getCheckedButtonInGroup:function(e){for(var t=e.getChildWidgets(),i=0,n=t.length;i<n;++i){var s=t[i];if(s.getChecked&&s.getChecked())return s}return null},cloneSetButton:function(e){if(this.getCloneSelectedOutlook()){for(var t=this.getElement(),i=this.getButtonSet().getElement(),n=Kekule.DomUtils,s=n.getDirectChildElems(t),a=n.getDirectChildElems(e.getElement()),r=!1,o=0,l=s.length;o<l;++o){(u=s[o])!==i?t.removeChild(u):r=!0}for(o=0,l=a.length;o<l;++o){var u=a[o].cloneNode(!0);r?t.insertBefore(u,i):t.appendChild(u)}this._clonedCustomHtmlClassName&&this.removeClassName(this._clonedCustomHtmlClassName),this._clonedCustomHtmlClassName=e.getCustomHtmlClassName(),this._clonedCustomHtmlClassName&&this.addClassName(this._clonedCustomHtmlClassName),this._compactMark=null,this.createCompactMark()}},calcActualButtonSetLayout:function(){var e=Kekule.Widget.Layout,t=this.getButtonSetLayout();if(!t){var i=this.getParent();t=(i?i.getLayout():e.HORIZONTAL)===e.VERTICAL?e.HORIZONTAL:e.VERTICAL}return t},showDropDownWidget:function($super){var e=this.calcActualButtonSetLayout();this.getButtonSet().setLayout(e),$super()},reactSetButtonExecute:function(e){if(e.target instanceof Kekule.Widget.Button&&e.target!==this.getSelected()&&(!this._currExecButton||this._currExecButton!==e.target))try{this._currExecButton=e.target,e.target.setIsFocused(!1),e.target.setIsHover(!1),e.target.setIsActive(!1),this.setSelected(e.target),this.getButtonSet().isShown()&&this.getButtonSet().hide(),this.invokeEvent("select",{selected:e.target})}finally{this._currExecButton=null}},append:function(e,t){return this.getButtonSet().appendWidget(e),t&&this.setSelected(e),this},insertBefore:function(e,t,i){return this.getButtonSet().insertWidgetBefore(e),i&&this.setSelected(e),this},remove:function(e,t){return this.getButtonSet().removeWidget(e,t),this}})}(),function(){var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,i=Kekule.Widget.HtmlClassNames,n=Kekule.ObjUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OVERLAP:"K-Overlap",FORMCONTROL:"K-FormControl",CHECKBOX:"K-CheckBox",TEXTBOX:"K-TextBox",COMBOTEXTBOX:"K-ComboTextBox",COMBOTEXTBOX_ASSOC_WIDGET:"K-ComboTextBox-Assoc-Widget",BUTTONTEXTBOX:"K-ButtonTextBox",TEXTAREA:"K-TextArea",SELECTBOX:"K-SelectBox",COMBOBOX:"K-ComboBox",COMBOBOX_TEXTWRAPPER:"K-ComboBox-TextWrapper",NUMINPUT:"K-NumInput"}),Kekule.Widget.FormWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.FormWidget",initialize:function($super,e,t){this.reactValueChangeBind=this.reactValueChange.bind(this),this.reactInputBind=this.reactInput.bind(this),this.setPropStoreFieldValue("isDirty",!1),$super(e,t)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,getter:function(){return this.getCoreElement().name},setter:function(e){this.getCoreElement().name=e}}),this.defineProp("value",{dataType:DataType.VARIANT,serializable:!1,getter:function(){return this.getCoreElement().value},setter:function(e){this.getCoreElement().value=e}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getCoreElement().readOnly},setter:function(e){this.getCoreElement().readOnly=e}})},getTextSelectable:function(){return!0},doGetWidgetClassName:function($super){return $super()+" "+i.FORMCONTROL},doBindElement:function($super,e){$super(e);var t=this.getCoreElement();if(t){var i=Kekule.Browser.IE&&8===Kekule.Browser.IEVersion;Kekule.X.Event.addListener(t,"change",this.reactValueChangeBind),Kekule.X.Event.addListener(t,"input",this.reactInputBind),i?(this._bindKeyupEvent=!0,Kekule.X.Event.addListener(t,"keyup",this.reactInputBind)):this._bindKeyupEvent=!1}},doUnbindElement:function($super,e){var t=this.getCoreElement();t&&(Kekule.X.Event.removeListener(t,"change",this.reactValueChangeBind),Kekule.X.Event.removeListener(t,"input",this.reactInputBind),this._bindKeyupEvent&&Kekule.X.Event.removeListener(t,"keyup",this.reactInputBind)),$super(e)},notifyValueChanged:function(){this.setIsDirty(!0),this.invokeEvent("valueChange",{widget:this,value:this.getValue()})},selectAll:function(){var e=this.getCoreElement();return e&&e.select&&e.select(),this},reactValueChange:function(){this.notifyValueChanged()},reactInput:function(e){this.setIsDirty(!0),this.invokeEvent("valueInput",{widget:this,value:this.getValue()})}}),Kekule.Widget.CheckBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.CheckBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e,t){$super(e),Kekule.ObjUtils.notUnset(t)&&this.setChecked(!!t)},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,getter:function(){var e=this.getCoreElement();return!!e&&e.checked},setter:function(e){var t=this.getCoreElement();t&&(t.checked=!!e)}}),this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.DomUtils.getElementText(this.getLabelElem())},setter:function(e){Kekule.DomUtils.setElementText(this.getLabelElem(),e)}})},getCoreElement:function(){return this.getInputElem()},doGetWidgetClassName:function($super){return $super()+" "+i.CHECKBOX},getInputElem:function(){var e=this.getElement();if(e){var t=e.getElementsByTagName("input");if(t&&t.length)return t[0]}return null},getLabelElem:function(){var e=this.getElement();if(e){if("label"===e.tagName.toLowerCase())return e;var t=e.getElementsByTagName("label");if(t&&t.length)return t[0]}return null},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var i=e.createElement("label");t.appendChild(i);var n=e.createElement("input");return n.setAttribute("type","checkbox"),i.appendChild(n),[i,n]}}),Kekule.Widget.TextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextBox",BINDABLE_TAG_NAMES:["input"],initialize:function($super,e,t){$super(e),t&&this.setText(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getElement().value},setter:function(e){this.getElement().value=e||""}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}})},doGetWidgetClassName:function($super){return $super()+" "+i.TEXTBOX},doCreateRootElement:function(e){return e.createElement("input")},doBindElement:function($super,e){$super(e),e.setAttribute("type","text")}}),Kekule.Widget.ComboTextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboTextBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e,t){$super(e),t&&this.setText(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var t=this.getTextBox();t&&t.setText(e)}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getTextBox().getPlaceholder()},setter:function(e){this.getTextBox().setPlaceholder(e)}}),this.defineProp("overlapOnTextBox",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("overlapOnTextBox",e),e?this.addClassName(i.OVERLAP):this.removeClassName(i.OVERLAP),this.adjustWidgetsSize()}}),this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:!1,setter:null}),this.defineProp("headingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:function(e){var t=this.getHeadingWidget();if(e!==t&&(this.setPropStoreFieldValue("headingWidget",e),t&&(t.setParent(null),t.removeClassName(i.COMBOTEXTBOX_ASSOC_WIDGET)),e)){var n=this.getTextBox()?this.getTextBox().getElement():this.getTailingWidget()?this.getTailingWidget().getElement():null;e.setParent(this),e.addClassName(i.COMBOTEXTBOX_ASSOC_WIDGET),e.insertToElem(this.getElement(),n)}}}),this.defineProp("tailingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:function(e){var t=this.getTailingWidget();e!==t&&(this.setPropStoreFieldValue("tailingWidget",e),t&&(t.setParent(null),t.removeClassName(i.COMBOTEXTBOX_ASSOC_WIDGET)),e&&(e.setParent(this),e.addClassName(i.COMBOTEXTBOX_ASSOC_WIDGET),e.appendToElem(this.getElement())))}})},finalize:function($super){this._finalizeSubWidgets(),$super()},_finalizeSubWidgets:function(){var e,t=this.getTextBox();t&&t.finalize(),(e=this.getHeadingWidget())&&e.finalize(),(e=this.getTailingWidget())&&e.finalize()},getCoreElement:function($super){var e=this.getTextBox();return e?e.getElement():$super()},doGetWidgetClassName:function($super){return $super()+" "+i.COMBOTEXTBOX},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function($super,e,t){var n=$super(e,t);this._finalizeSubWidgets();var s=new Kekule.Widget.TextBox(this);return s.addClassName(i.TEXTBOX),s.appendToElem(this.getElement()),this.setPropStoreFieldValue("textBox",s),n.push(s.getElement()),n},relayEvent:function($super,e,t){var i=t.widget;return i!==this.getTextBox()&&i!==this.getHeadingWidget()&&i!==this.getTailingWidget()||(t.widget=this),$super(e,t)},doSetEnabled:function(e){var t=this.getTextBox();t&&t.setEnabled(e);var i=this.getHeadingWidget();i&&i.setEnabled(e),(i=this.getTailingWidget())&&i.setEnabled(e)},doResize:function(){this.adjustWidgetsSize()},widgetShowStateChanged:function($super,e,t){$super(e,t),e&&this.adjustWidgetsSize()},doInsertedToDom:function(){this.isShown()&&this.adjustWidgetsSize()},assocWidgetChanged:function(){this.adjustWidgetsSize()},adjustWidgetsSize:function(){var e=Kekule.StyleUtils,t=this.getOverlapOnTextBox(),i=t?"absolute":"relative",n=this.getTextBox().getElement();if(n){var s,a,r,o=Kekule.HtmlElementUtils.getElemPageRect(n);if((a=(s=this.getHeadingWidget())?s.getElement():null)&&s.isShown())if((r=a.style).position=i,t){var l=Kekule.HtmlElementUtils.getElemPageRect(a);r.left=0,r.top=(o.height-l.height)/2+"px",n.style.paddingLeft=l.width+"px"}else e.removeStyleProperty(r,"left"),e.removeStyleProperty(r,"top"),e.removeStyleProperty(n.style,"paddingLeft");else e.removeStyleProperty(n.style,"paddingLeft");if((a=(s=this.getTailingWidget())?s.getElement():null)&&s.isShown())if((r=a.style).position=i,t){l=Kekule.HtmlElementUtils.getElemPageRect(a);r.right=0,r.top=(o.height-l.height)/2+"px",n.style.paddingRight=l.width+"px"}else e.removeStyleProperty(r,"right"),e.removeStyleProperty(r,"top"),e.removeStyleProperty(n.style,"paddingRight");else e.removeStyleProperty(n.style,"paddingRight")}}}),Kekule.Widget.ButtonTextBox=Class.create(Kekule.Widget.ComboTextBox,{CLASS_NAME:"Kekule.Widget.ButtonTextBox",initialize:function($super,e,t){$super(e,t),this.setOverlapOnTextBox(!0)},initProperties:function(){this.defineProp("button",{dataType:"Kekule.Widget.Button",serializable:!1,setter:null,getter:function(){return this.getTailingWidget()}}),this.defineProp("buttonKind",{dataType:DataType.STRING,getter:function(){return this.getButton().getButtonKind()},setter:function(e){this.getButton().setButtonKind(e)}}),this.defineProp("buttonText",{dataType:DataType.STRING,getter:function(){return this.getButton().getText()},setter:function(e){this.getButton().setText(e).setShowText(!!e)}})},doGetWidgetClassName:function($super){return $super()+" "+i.BUTTONTEXTBOX},doCreateSubElements:function($super,e,t){var i=$super(e,t),n=this.createAssocButton();return n&&i.push(n.getElement()),i},createAssocButton:function(){var e=new Kekule.Widget.Button(this);return e.setShowText(!1),this.setTailingWidget(e),e.addEventListener("change",this.adjustWidgetsSize,this),e.addEventListener("execute",function(e){this.invokeEvent("buttonExecute",{widget:this})},this),e},execBtn:function(e){var t=this.getButton();if(t)return t.execute(e),!0},react_keypress:function(e){13===e.getKeyCode()&&this.execBtn(e)},react_keydown:function(e){if(this.getButtonKind()===Kekule.Widget.Button.Kinds.DROPDOWN){var t=Kekule.X.Event.KeyCode;e.getKeyCode()===t.DOWN&&this.execBtn(e)}}}),Kekule.Widget.TextArea=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextArea",BINDABLE_TAG_NAMES:["textarea"],initialize:function($super,e,t){$super(e),t&&this.setText(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getValue()},setter:function(e){this.setValue(e),this.adjustAutoSize()}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}}),this.defineProp("autoSizeX",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeX",e),this._autoSizeChanged()}}),this.defineProp("autoSizeY",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeY",e),this._autoSizeChanged()}}),this.defineProp("wrap",{dataType:DataType.STRING,getter:function(){return this.getElement().wrap},setter:function(e){this.getElement().wrap=e}})},doGetWidgetClassName:function($super){return $super()+" "+i.TEXTAREA},doCreateRootElement:function(e){return e.createElement("textarea")},doBindElement:function($super,e){$super(e),this.adjustAutoSize()},setValue:function($super,e){$super(e),this.adjustAutoSize()},widgetShowStateChanged:function($super,e,t){$super(e,t),e&&this.adjustAutoSize()},doFileDragDrop:function($super,e){if(e){if(Kekule.BrowserFeature.fileapi){var t=this,i=new FileReader;i.onload=function(e){var n=i.result;t.setText(n)},i.readAsText(e[0])}return!0}return $super()},reactValueChange:function($super){this.adjustAutoSize(),$super()},react_keyup:function(){this.adjustAutoSize()},react_keypress:function(){this.adjustAutoSize()},doWidgetShowStateChanged:function(e){e&&this.adjustAutoSize()},_autoSizeChanged:function(){var e=this.getCoreElement().style;this.getAutoSizeX()?(e.overflowX="hidden",this.setWrap("off")):(e.overflowX="auto",this.setWrap("")),this.getAutoSizeY()?e.overflowY="hidden":e.overflowY="auto",this.adjustAutoSize()},adjustAutoSize:function(){(this.getAutoSizeX()||this.getAutoSizeY())&&this.adjustSizeByContent()},adjustSizeByContent:function(){var e=this.getCoreElement(),t=!this.getText(),i=e.style;this.getAutoSizeX()&&(i.width="1px"),this.getAutoSizeY()&&(i.height="1px");var n=Kekule.HtmlElementUtils.getElemScrollDimension(e),s=Kekule.HtmlElementUtils.getElemClientDimension(e);this.getAutoSizeX()&&(t?i.width="1em":n.width>s.width&&(i.width=n.width+"px")),this.getAutoSizeY()&&(t&&(i.height="1em"),n.height>s.height&&(i.height=n.height+"px"))}}),Kekule.Widget.SelectBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.SelectBox",BINDABLE_TAG_NAMES:["select"],ITEM_DATA_FIELD:"__$item_data__",ITEM_VALUE_FIELD:"__$item_value__",initialize:function($super,e,t){$super(e),t&&this.setItems(t)},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){for(var e=this.getAllItemElems(),t=[],i=0,n=e.length;i<n;++i){var s=e[i],a=this._getBoxItemInfo(s);t.push(a)}return t},setter:function(e){var t=this.getElement();if(this.clear(),e)for(var i=Kekule.ArrayUtils.toArray(e),n=0,s=i.length;n<s;++n){var a=i[n];if(a){var r=this._createBoxItemElem(t);this._setBoxItemInfo(r,a)}}}}),this.defineProp("index",{dataType:DataType.INT,getter:function(){return this.getElement().selectedIndex},setter:function(e){this.getElement().selectedIndex=e}})},doGetWidgetClassName:function($super){return $super()+" "+i.SELECTBOX},doCreateRootElement:function(e){return e.createElement("select")},_createBoxItemElem:function(e,t){var i=e.ownerDocument.createElement("option");return t?e.insertBefore(i,t):e.appendChild(i),i},doBindElement:function($super,e){$super(e)},doGetValue:function(){var e=this.getSelectedItemElem();return e?this._getBoxItemInfo(e).value:void 0},doSetValue:function(e){for(var t=this.getAllItemElems(),i=0,n=t.length;i<n;++i){var s=t[i];if(this._getBoxItemInfo(s).value===e)return void this.setIndex(i)}this.setIndex(-1)},getAllItemElems:function(){return e.getDirectChildElems(this.getElement(),"option")},getSelectedItemElem:function(){for(var e=this.getAllItemElems(),t=0,i=e.length;t<i;++t){var n=e[t];if(n.selected)return n}return null},clear:function(){this.getElement().innerHTML=""},dropDown:function(){this.getDocument(),this.getElement();var e=this.getDocument().createEvent("MouseEvents");e.initEvent("mousedown",!0,!0),this.getElement().dispatchEvent(e)},_getBoxItemInfo:function(e){var i={};return i.text=t.getInnerText(e),i.value=e[this.ITEM_VALUE_FIELD],n.notUnset(e.title)&&(i.title=e.title),n.notUnset(e[this.ITEM_DATA_FIELD])&&(i.data=e[this.ITEM_DATA_FIELD]),i},_setBoxItemInfo:function(e,t){DataType.isSimpleValue(t)&&(t={value:t});var i=t.text||t.value;return n.notUnset(i)&&Kekule.DomUtils.setElementText(e,i),e.value=""+t.value,e[this.ITEM_VALUE_FIELD]=t.value,n.notUnset(t.title)&&(e.title=t.title),n.notUnset(t.data)&&(e[this.ITEM_DATA_FIELD]=t.data),t.selected?e.setAttribute("selected","selected"):e.selected=!1,this}}),Kekule.Widget.ComboBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var t=this.getTextBox();t&&(t.setText(e),this.textChanged())}}),this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getSelectBox();return e?e.getItems():null},setter:function(e){var t=this.getSelectBox();t&&t.setItems(e)}}),this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("selectBox",{dataType:"Kekule.Widget.SelectBox",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},finalize:function($super){this._finalizeSubElements(),$super()},_finalizeSubElements:function(){var e=this.getTextBox();e&&e.finalize();var t=this.getSelectBox();t&&t.finalize()},getCoreElement:function($super){var e=this.getTextBox();return e?e.getElement():$super()},doGetWidgetClassName:function($super){return $super()+" "+i.COMBOBOX},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var n=this;this._finalizeSubElements();var s=e.createElement("span");s.className=i.COMBOBOX_TEXTWRAPPER,t.appendChild(s);var a=new Kekule.Widget.TextBox(this);a.appendToElem(s),this.setPropStoreFieldValue("textBox",a);var r=new Kekule.Widget.SelectBox(this);return r.appendToElem(t),this.setPropStoreFieldValue("selectBox",r),r.addEventListener("valueChange",function(e){var t=r.getSelectedItemElem();if(t){var i=t.value,s=t.text||t.value;s!==a.getText()&&(a.setText(s),n.notifyValueChanged()),a.selectAll(),a.focus(),n.invokeEvent("valueSelect",{widget:n,value:i})}}),a.addEventListener("valueChange",function(e){n.textChanged()}),Kekule.X.Event.addListener(a.getElement(),"keydown",function(e){e.getKeyCode()===Kekule.X.Event.KeyCode.DOWN&&r.dropDown()}),[s]},relayEvent:function($super,e,t){var i=t.widget;if(i!==this.getTextBox()&&i!==this.getSelectBox()||(t.widget=this,"valueChange"!==e))return $super(e,t)},textChanged:function(){var e=this.getText(),t=this._getValueOfText(e);this.getSelectBox().setValue(t)},_getValueOfText:function(e){for(var t=this.getSelectBox().getItems(),i=0,n=t.length;i<n;++i){var s=t[i];if(s.text&&s.text===e)return s.value}return e},doSetEnabled:function(e){var t=this.getTextBox();t&&t.setEnabled(e);var i=this.getSelectBox();i&&i.setEnabled(e)},doGetValue:function($super){var e=$super();return this._getValueOfText(e)},doSetValue:function($super,e){var t=e,i=this.getSelectBox().getItems();this.getSelectBox().setIndex(-1);for(var n=0,s=i.length;n<s;++n){var a=i[n];if(a.value===e){t=a.text||a.value,this.getSelectBox().setIndex(n);break}}$super(t)}}),Kekule.Widget.NumInput=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.NumInput",BINDABLE_TAG_NAMES:["input"],DEF_MIN_VALUE:0,DEF_MAX_VALUE:100,DEF_STEP:1,initialize:function($super,e,t,i,s,a){$super(e),n.notUnset(t)&&this.setMinValue(t),n.notUnset(i)&&this.setMaxValue(i),n.notUnset(s)&&this.setStep(s),a&&this.setControlType(a)},initProperties:function(){this.defineProp("minValue",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().min)||null},setter:function(e){this.getElement().min=e}}),this.defineProp("maxValue",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().max)||null},setter:function(e){this.getElement().max=e}}),this.defineProp("step",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().step)||null},setter:function(e){this.getElement().step=e}}),this.defineProp("controlType",{dataType:DataType.STRING,getter:function(){return this.getElement().getAttribute("type")},setter:function(e){this.getElement().setAttribute("type",e)}})},doGetValue:function($super){var e=$super();return e?parseFloat(e):0},doGetWidgetClassName:function($super){return $super()+" "+i.NUMINPUT},doCreateRootElement:function(e){return e.createElement("input")},doBindElement:function($super,e){$super(e),e.setAttribute("type","range")}})}(),function(){"use strict";Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{STATE_COLLAPSED:"K-State-Collapsed",STATE_EMPTY:"K-State-Empty",NESTED_CONTAINER:"K-NestedContainer",NESTED_CONTAINER_ITEM:"K-NestedContainer-Item"}),Kekule.Widget.NestedContainer=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.NestedContainer",DEF_CONTAINER_TAG:"ul",DEF_ITEM_TAG:"li",ITEM_DATA_FIELD:"__$itemData__",initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("itemInitialExpanded",{dataType:DataType.BOOL})},doCreateRootElement:function(e){return e.createElement("div")},doBindElement:function($super,e){$super(e)},getContainerElemTag:function(){return this.DEF_CONTAINER_TAG},getItemElemTag:function(){return this.DEF_ITEM_TAG},_createChildItemElem:function(){var e=this.doCreateChildItemElem();return Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM),Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.STATE_EMPTY),e},doCreateChildItemElem:function(){return this.getDocument().createElement(this.getItemElemTag())},_createChildContainerElem:function(){var e=this.doCreateChildContainerElem();return Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER),e},doCreateChildContainerElem:function(){return this.getDocument().createElement(this.getContainerElemTag())},getChildContainerElem:function(e,t){e||(e=this.getElement());var i=e.getElementsByTagName(this.getContainerElemTag()),n=i.length?i[0]:null;return!n&&t&&(n=this._createChildContainerElem(),e.appendChild(n)),n},getItemData:function(e){return e[this.ITEM_DATA_FIELD]},setItemData:function(e,t){this.doSetItemData(e,t),e[this.ITEM_DATA_FIELD]=t;var i=t.children;if(i&&Kekule.ArrayUtils.isArray(i)){this.clearChildItems(e);for(var n=0,s=i.length;n<s;++n){var a=i[n];this.appendChildItem(e,a)}}return this},doSetItemData:function(e,t){},hasChildItem:function(e){return this.getChildItemCount(e)>0},getChildItemCount:function(e){return this.getChildren(e).length},getChildren:function(e){var t=this.getChildContainerElem(e);return t?Kekule.DomUtils.getDirectChildElems(t,this.getItemElemTag()):[]},getChildItemAt:function(e,t){var i=this.getChildren(e);return i.length&&i.length>t?i[t]:null},insertChildItem:function(e,t,i){var n=this.getChildContainerElem(e,!0);if(t&&Kekule.DomUtils.isElement(t))s=t;else{var s=this._createChildItemElem();this.getItemInitialExpanded()||Kekule.HtmlElementUtils.addClass(s,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),t&&this.setItemData(s,t)}var a=DataType.isSimpleType(i)?this.getChildren(e)[i]:i;return a?n.insertBefore(s,a):n.appendChild(s),this.childItemsChanged(e),s},appendChildItem:function(e,t){return this.insertChildItem(e,t)},removeChildItem:function(e,t){var i=this.getChildContainerElem(e);return i&&(i.removeChild(t),this.hasChildItem(e)||e.removeChild(i),this.childItemsChanged(e)),this},removeChildItemAt:function(e,t){var i=this.getChildItemAt(e,t);return i&&this.removeChildItem(e,i),this},clearChildItems:function(e){var t=this.getChildContainerElem(e);e||(e=this.getElement()),t&&e.removeChild(t),this.childItemsChanged(e)},childItemsChanged:function(e){if(e){var t=Kekule.Widget.HtmlClassNames.STATE_EMPTY;this.hasChildItem(e)?Kekule.HtmlElementUtils.removeClass(e,t):Kekule.HtmlElementUtils.addClass(e,t)}},expandItem:function(e){return Kekule.HtmlElementUtils.removeClass(e,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),this},collapseItem:function(e){return Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),this},toggleExpandStateOfItem:function(e){return Kekule.HtmlElementUtils.toggleClass(e,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),this},isChildItem:function(e){return Kekule.HtmlElementUtils.hasClass(e,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM)},getBelongedChildItem:function(e){for(var t=e,i=this.getElement(),n=this.getDocument().body;t!==i&&t!==n;)if(t=t.parentNode,this.isChildItem(t))return t;return null},getAllChildItems:function(e){var t=[],i=this.getChildContainerElem(e,!1);if(i)for(var n=Kekule.DomUtils.getDirectChildElems(i),s=0,a=n.length;s<a;++s){var r=n[s];if(this.isChildItem(r)){t.push(r);var o=this.getAllChildItems(r);t=t.concat(o)}}return t},getChildItemRange:function(e,t,i){var n=this.getAllChildItems(i),s=n.indexOf(e),a=n.indexOf(t);if(s>=0&&a>=0){if(s>a){var r=!0,o=s;s=a,a=o}var l=n.slice(s,a+1);return r&&(l=l.reverse()),l}return[]}})}(),function(){"use strict";Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TREEVIEW:"K-TreeView",TREEVIEW_EXPANDMARK:"K-TreeView-ExpandMark",TREEVIEW_ITEMCONTENT:"K-TreeView-ItemContent"}),Kekule.Widget.TreeView=Class.create(Kekule.Widget.NestedContainer,{CLASS_NAME:"Kekule.Widget.TreeView",BELONGED_ITEM_FIELD:"__$treeItem__",initProperties:function(){this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("selection");return e||(e=[],this.setPropStoreFieldValue("selection",e)),e},setter:function(e){this.select(e)}}),this.defineProp("selectedItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getSelection();return e.length?e[e.length-1]:null},setter:function(e){this.select(e)}}),this.defineProp("enableMultiSelected",{dataType:DataType.BOOL})},doGetWidgetClassName:function(){return e.TREEVIEW},doCreateChildItemElem:function($super){var t=$super();if(t){var i=this.createGlyphContent(t,null,e.TREEVIEW_EXPANDMARK);i[this.BELONGED_ITEM_FIELD]=t,t._expandMarkerElem=i;var n=this.getDocument().createElement("span");n.className=e.TREEVIEW_ITEMCONTENT,t.appendChild(n),n[this.BELONGED_ITEM_FIELD]=t,t._contentElem=n}return t},doSetItemData:function(e,t){this.setItemText(e,t.text)},getExpandMarkerElem:function(e){return e._expandMarkerElem},getItemContentElem:function(e){return e._contentElem},getTextPartElem:function(e,t){var i=e._textPartElem;return!i&&t&&(i=this.createTextContent("",this.getItemContentElem(e)),e._textPartElem=i),i},setItemText:function(e,t){this.getTextPartElem(e,!0).innerHTML=t},isItemSelected:function(e){var t=this.getSelection();return!!t&&t.indexOf(e)>=0},selectionChanged:function(){this.notifyPropSet("selection",this.getSelection())},clearSelection:function(){var t=this.getSelection();if(t.length){for(var i=0,n=t.length;i<n;++i){var s=t[i];Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(s),e.STATE_SELECTED)}this.setPropStoreFieldValue("selection",[]),this.selectionChanged()}return this},removeFromSelection:function(t){if(t){var i=Kekule.ArrayUtils.toArray(t);if(i&&i.length){for(var n=this.getSelection(),s=0,a=i.length;s<a;++s){var r=i[s];Kekule.ArrayUtils.remove(n,r)&&Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(r),e.STATE_SELECTED)}this.selectionChanged()}}return this},addToSelection:function(t){if(t){var i=Kekule.ArrayUtils.toArray(t);if(i&&i.length){this.getEnableMultiSelected()||(this.clearSelection(),i=[i[i.length-1]]);for(var n=this.getSelection(),s=0,a=i.length;s<a;++s){var r=i[s];this.isItemSelected(r)||(Kekule.HtmlElementUtils.addClass(this.getItemContentElem(r),e.STATE_SELECTED),n.push(r))}this.selectionChanged()}}return this},toggleSelectionState:function(e){if(e){this.beginUpdate();try{var t=Kekule.ArrayUtils.toArray(e);this.getSelection();if(t&&t.length)for(var i=0,n=t.length;i<n;++i){var s=t[i];this.isItemSelected(s)?this.removeFromSelection(s):this.addToSelection(s)}}finally{this.endUpdate()}}},select:function(e){this.beginUpdate();try{if(this.clearSelection(),e)if(this.getEnableMultiSelected())this.addToSelection(e);else{var t=Kekule.ArrayUtils.toArray(e);this.addToSelection(t[t.length-1])}}finally{this.endUpdate()}},react_click:function(e){var t=e.getTarget(),i=t[this.BELONGED_ITEM_FIELD];if(i&&this.isChildItem(i))this.toggleExpandStateOfItem(i);else if(i=this.getBelongedChildItem(t),e.getShiftKey()){var n=this.getSelectedItem();if(n){var s=this.getChildItemRange(n,i);s.length&&(e.getCtrlKey()?this.addToSelection(s):this.select(s))}else this.select(i)}else e.getCtrlKey()?this.toggleSelectionState(i):i&&this.select(i)},react_dblclick:function(e){var t=e.getTarget(),i=this.getBelongedChildItem(t);i&&this.toggleExpandStateOfItem(i)}})}(),function(){"use strict";var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.StyleUtils),i=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DIALOG:"K-Dialog",DIALOG_INSIDE:"K-Dialog-Inside",DIALOG_OVERFLOW:"K-Dialog-Overflow",DIALOG_CLIENT:"K-Dialog-Client",DIALOG_CAPTION:"K-Dialog-Caption",DIALOG_BTN_PANEL:"K-Dialog-Button-Panel"}),Kekule.Widget.DialogButtons={OK:"ok",CANCEL:"cancel",YES:"yes",NO:"no",isPositive:function(e){var t=Kekule.Widget.DialogButtons;return[t.OK,t.YES].indexOf(e)>=0},isNegative:function(e){var t=Kekule.Widget.DialogButtons;return[t.CANCEL,t.NO].indexOf(e)>=0}},Kekule.Widget.Location={DEFAULT:1,CENTER:2,FULLFILL:3,CENTER_OR_FULLFILL:4},Kekule.Widget.Dialog=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Dialog",BINDABLE_TAG_NAMES:["div","span"],BTN_NAME_FIELD:"__$btnName__",initialize:function($super,e,t,i){this._dialogCallback=null,this._modalInfo=null,this._childButtons=[],this.setPropStoreFieldValue("location",Kekule.Widget.Location.CENTER),$super(e),this._dialogOpened=!1,this.setUseCornerDecoration(!0),t&&this.setCaption(t),i&&this.setButtons(i),this.setDisplayed(!1)},doFinalize:function($super){this.getModalInfo()&&this.getGlobalManager().unprepareModalWidget(this),$super()},initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return e.getElementText(this.getCaptionElem())},setter:function(i){e.setElementText(this.getCaptionElem(),i),t.setDisplay(this.getCaptionElem(),!!i)}}),this.defineProp("buttons",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("buttons",e),this.getBtnPanelElem()&&t.setDisplay(this.getBtnPanelElem(),e&&e.length),this.buttonsChanged()}}),this.defineProp("result",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("location",{dataType:DataType.INT}),this.defineProp("clientElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("btnPanelElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC})},initPropValues:function($super){$super(),this.setMovable&&this.setMovable(!0)},getDefaultMovingGripper:function(){return this.getCaptionElem()},getCoreElement:function(){return this.getClientElem()},doGetWidgetClassName:function(){return i.DIALOG},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var n,s=[];return(n=e.createElement("div")).className=i.DIALOG_CAPTION,t.appendChild(n),this.setPropStoreFieldValue("captionElem",n),s.push(n),this.setMovingGripper&&this.setMovingGripper(n),(n=e.createElement("div")).className=i.DIALOG_CLIENT,t.appendChild(n),this.setPropStoreFieldValue("clientElem",n),this.doCreateClientContents(n),s.push(n),(n=e.createElement("div")).className=i.DIALOG_BTN_PANEL,t.appendChild(n),this.setPropStoreFieldValue("btnPanelElem",n),s.push(n),this.buttonsChanged(),s},doCreateClientContents:function(e){},buttonsChanged:function(){for(var e=this._childButtons.length-1;e>=0;--e){this._childButtons[e].finalize()}for(var t=this.getButtons()||[],i=(e=0,t.length);e<i;++e)this.createDialogButton(t[e])},createDialogButton:function(e,t,i,n){var s=this._getPredefinedButtonInfo(e);if(s||(s={text:e}),s){var a=new Kekule.Widget.Button(this,s.text);a[this.BTN_NAME_FIELD]=e,a.addEventListener("execute",this._reactDialogBtnExec,this),a.appendToElem(this.getBtnPanelElem()),a.__$name__=e;var r=t||this._getDialogButtonResName(e);return r&&a.linkStyleResource(r),this._childButtons.push(a),a}return null},_getDialogButtonResName:function(e){var t=Kekule.Widget.DialogButtons;return[t.OK,t.YES].indexOf(e)>=0?Kekule.Widget.StyleResourceNames.BUTTON_YES_OK:[t.CANCEL,t.NO].indexOf(e)>=0?Kekule.Widget.StyleResourceNames.BUTTON_NO_CANCEL:null},_reactDialogBtnExec:function(e){var t=Kekule.Widget.DialogButtons,i=[t.OK,t.YES,t.CANCEL,t.NO],n=e.target;if(n){var s=n.__$name__;i.indexOf(s)>=0&&(this.setResult(s),this.close(s))}},_getPredefinedButtonInfo:function(e){var t=Kekule.Widget.DialogButtons,i=[t.OK,t.CANCEL,t.YES,t.NO],n=[Kekule.$L("WidgetTexts.CAPTION_OK"),Kekule.$L("WidgetTexts.CAPTION_CANCEL"),Kekule.$L("WidgetTexts.CAPTION_YES"),Kekule.$L("WidgetTexts.CAPTION_NO")],s=i.indexOf(e);return s>=0?{text:n[s]}:null},getDialogButton:function(e){for(var t=this._childButtons.length-1;t>=0;--t){var i=this._childButtons[t];if(i[this.BTN_NAME_FIELD]===e)return i}return null},needAdjustPosition:function(){return this.getShowHideType()!==Kekule.Widget.ShowHideType.DROPDOWN},_storePositionInfo:function(){if(this.needAdjustPosition()){var e=this.getElement().style;this._posInfo={left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,position:e.position}}},_restorePositionInfo:function(){if(this.needAdjustPosition()){var e=this.getElement().style,t=this._posInfo;t&&(e.left=t.left,e.top=t.top,e.right=t.right,e.bottom=t.bottom,e.width=t.width,e.height=t.height,e.position=t.position)}},adjustLocation:function(){if(this.needAdjustPosition()){this._storePositionInfo();var e=Kekule.Widget.Location,t=this.getLocation()||e.DEFAULT,n=!1;if(t!==e.DEFAULT){var s,a,r,o,l,u,d=this.getDisplayed(),h=this.getVisible();try{this.setDisplayed(!0,!0),this.setVisible(!0,!0);var g=Kekule.DocumentUtils.getInnerClientDimension(this.getDocument()),c=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),!0),p=c.right-c.left,E=c.bottom-c.top,f=this.getOffsetParent();f&&Kekule.HtmlElementUtils.getElemPageRect(f,!0);n=p>=g.width||E>=g.height}finally{this.setVisible(h,!0),this.setDisplayed(d,!0)}if(t===e.CENTER_OR_FULLFILL)if(n){Kekule.DocumentUtils.getClientVisibleBox(this.getDocument());p>=g.width?(s=0,l=0):s=(g.width-p)/2,E>=g.height?(a=0,u=0):a=(g.height-E)/2}else t=e.CENTER;if(t===e.FULLFILL?(s=0,a=0,l=0,u=0):t===e.CENTER&&(s=(g.width-p)/2,a=(g.height-E)/2),n){this.removeClassName(i.DIALOG_INSIDE),this.addClassName(i.DIALOG_OVERFLOW);var T=Kekule.DocumentUtils.getScrollPosition(this.getDocument());(s+=T.left)<0&&(s=0),(a+=T.top)<0&&(a=0)}else this.removeClassName(i.DIALOG_OVERFLOW),this.addClassName(i.DIALOG_INSIDE);var C=this.getElement().style,m=Kekule.ObjUtils.notUnset;m(s)&&(C.left=s+"px"),m(a)&&(C.top=a+"px"),m(l)&&(C.right=l+"px"),m(u)&&(C.bottom=l+"px"),m(r)&&(C.width=r+"px"),m(o)&&(C.height=o+"px"),this.adjustClientSize(r,o,n)}this._posAdjusted=!0}},adjustClientSize:function(e,t,i){},prepareShow:function(e){var t=this.getElement();t.parentNode||this.getDocument().body.appendChild(t);var i=this;setTimeout(function(){i._dialogCallback=e},0)},openModal:function(e,t){return this.getGlobalManager().prepareModalWidget(this),this.open(e,t)},openPopup:function(e,t){return this.open(e,t,Kekule.Widget.ShowHideType.POPUP)},open:function(e,t,i){return this.prepareShow(e),this.show(t,null,i||Kekule.Widget.ShowHideType.DIALOG),this._dialogOpened=!0,this},close:function(e){this.setResult(e),this.hide()},isPositiveResult:function(e){return Kekule.Widget.DialogButtons.isPositive(e||this.getResult())},isNegativeResult:function(e){return Kekule.Widget.DialogButtons.isNegative(e||this.getResult())},widgetShowStateBeforeChanging:function($super,e){$super(e),e&&(this.adjustLocation(),this.setResult(null))},doWidgetShowStateChanged:function($super,e){$super(e),e||this._dialogCallback&&(this._dialogCallback(this.getResult()),this._dialogCallback=null)},widgetShowStateDone:function($super,e){$super(e),!e&&this._dialogOpened&&(this.getModalInfo()&&this.getGlobalManager().unprepareModalWidget(this),this.isShown()||this._restorePositionInfo(),this._dialogOpened=!1)}})}(),function(){"use strict";var e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MSGPANEL:"K-MsgPanel",MSGPANEL_CONTENT:"K-MsgPanel-Content",MSGGROUP:"K-MsgGroup",MSGGROUP_FOR_WIDGET:"K-Widget-MsgGroup",MSG_NORMAL:"K-Msg-Normal",MSG_INFO:"K-Msg-Info",MSG_WARNING:"K-Msg-Warning",MSG_ERROR:"K-Msg-Error"}),Kekule.Widget.MsgType={NORMAL:"",INFO:"info",WARNING:"warning",ERROR:"error"},Kekule.Widget.MsgPanel=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.MsgPanel",BINDABLE_TAG_NAMES:["span","div"],initialize:function($super,e,t,i){this._contentElem=null,this._elemTextPart=null,this._elemLeadingGlyphPart=null,this._elemTailingGlyphPart=null,this.setPropStoreFieldValue("showText",!0),$super(e),t&&this.setText(t),i&&this.setMsgType(i),this.setUseCornerDecoration(!0)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(e){this.changeContentText(e)}}),this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showLeadingGlyph",e),this._elemLeadingGlyphPart.style.display=e?"":"none"}}),this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showTailingGlyph",e),this._elemTailingGlyphPart.style.display=e?"":"none"}}),this.defineProp("msgType",{dataType:DataType.STRING,setter:function(e){var t=this.getMsgType();if(t!==e){var i=this.getClassNameForMsgType(t),n=this.getClassNameForMsgType(e);i!==n&&(this.removeClassName(i),this.addClassName(n)),this.setPropStoreFieldValue("msgType",e)}}})},doGetWidgetClassName:function($super){return $super()+" "+t.MSGPANEL},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function($super,i,n){var s=e.getInnerText(n);n.innerHTML="";var a=i.createElement("span");a.className=t.MSGPANEL_CONTENT,n.appendChild(a),this._contentElem=a,this._elemTextPart=this.createTextContent(s,a),this._elemLeadingGlyphPart=this.createGlyphContent(a,this._elemTextPart,t.PART_PRI_GLYPH_CONTENT),this._elemTailingGlyphPart=this.createGlyphContent(a,null,t.PART_ASSOC_GLYPH_CONTENT)},doSetUseCornerDecoration:function($super,e){$super(e),e?Kekule.HtmlElementUtils.addClass(this._contentElem,t.CORNER_ALL):Kekule.HtmlElementUtils.removeClass(this._contentElem,t.CORNER_ALL)},getTextSelectable:function(){return!0},changeContentText:function(e){Kekule.DomUtils.setElementText(this._elemTextPart,e||"")},getClassNameForMsgType:function(e){var i=Kekule.Widget.MsgType;switch(e){case i.INFO:return t.MSG_INFO;case i.WARNING:return t.MSG_WARNING;case i.ERROR:return t.MSG_ERROR;default:return t.MSG_NORMAL}}}),Kekule.Widget.MsgGroup=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.MsgGroup",BINDABLE_TAG_NAMES:["span","div"],initialize:function($super,e){$super(e),this.setLayout(Kekule.Widget.Layout.VERTICAL)},initProperties:function(){this.defineProp("reversedOrder",{dataType:DataType.BOOL}),this.defineProp("maxMsgCount",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("maxMsgCount",e),this.clearExcessiveMsgs()}}),this.defineProp("msgFlashTime",{dataType:DataType.INT})},initPropValues:function($super){$super(),this.setMsgFlashTime(6e3)},doGetWidgetClassName:function($super){return $super()+" "+t.MSGGROUP},doCreateRootElement:function(e){return e.createElement("div")},addMessage:function(e,t,i,n){if(e||t){var s=new Kekule.Widget.MsgPanel(this,e,t);s.setFinalizeAfterHiding(!0),n&&s.addClassName(n),this.getReversedOrder()?s.insertToWidget(this,this.getChildAt(0)):s.appendToWidget(this);var a=Kekule.ObjUtils.isUnset(i)?this.getMsgFlashTime():i;return a?s.flash(a,this):s.show(this),this.clearExcessiveMsgs(),s}},clearExcessiveMsgs:function(){var e=this.getMaxMsgCount();if(e&&e>0){var t=this.getChildWidgets().length-e;if(t>0){var i,n=0,s=this,a=function(){n<t&&(i=s.getOldestMsgPanel(),s.hideMsgPanel(i,a),++n)};a()}}},getOldestMsgPanel:function(){return this.getReversedOrder()?this.getLastChild():this.getFirstChild()},hideMsgPanel:function(e,t){return e.hide(this,t),e}}),ClassEx.defineProp(Kekule.Widget.BaseWidget,"msgReporter",{dataType:"Kekule.Widget.MsgGroup",serializable:!1,setter:null,getter:function(e){var i=this.getPropStoreFieldValue("msgReporter");return!i&&e&&((i=new Kekule.Widget.MsgGroup(this)).addClassName(t.MSGGROUP_FOR_WIDGET),i.appendToWidget(this),this.setPropStoreFieldValue("msgReporter",i)),i}}),ClassEx.extend(Kekule.Widget.BaseWidget,{reportMessage:function(e,t,i,n){var s=this.getMsgReporter(!0),a=s.addMessage(e,t,i||0,n);return s.setDisplayed(!0),a},flashMessage:function(e,t,i,n){return this.reportMessage(e,t,i||this.getMsgReporter(!0).getMsgFlashTime(),n)},removeMessage:function(e){e.hide()}})}(),function(){"use strict";Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames,t=Kekule.ArrayUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TABVIEW:"K-TabView",TABVIEW_TABBUTTON:"K-TabView-TabButton",TABVIEW_CLIENT:"K-TabView-Client",TABVIEW_PAGE:"K-TabView-Page",TABVIEW_ACTIVE_PAGE:"K-TabView-Active-Page",TABVIEW_TABBUTTON_CONTAINER:"K-TabView-TabButton-Container",TABVIEW_PAGE_CONTAINER:"K-TabView-Page-Container",TABBUTTONGROUP:"K-TabButtonGroup",TAB_AT_LEFT:"K-TabAtLeft",TAB_AT_RIGHT:"K-TabAtRight",TAB_AT_TOP:"K-TabAtTop",TAB_AT_BOTTOM:"K-TabAtBottom"}),Kekule.Widget.TabPage=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.TabPage",initProperties:function(){this.defineProp("text",{dataType:DataType.STRING})},doGetWidgetClassName:function($super){return $super()+" "+e.TABVIEW_PAGE},doCreateRootElement:function(e){return e.createElement("div")}}),Kekule.Widget.TabButtonGroup=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.TabButtonGroup",initialize:function($super,e){$super(e),this.addEventListener("execute",function(e){var t=e.target;t instanceof Kekule.Widget.RadioButton&&this.invokeEvent("switch",{button:t})},this),this.tabButtonPosChanged()},initProperties:function(){this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(e){this.getTabButtonPosition()!==e&&(this.setPropStoreFieldValue("tabButtonPosition",e),this.tabButtonPosChanged())}})},initPropValues:function($super){$super(),this.setUseCornerDecoration(!1)},doGetWidgetClassName:function($super){return $super()+" "+e.TABBUTTONGROUP},tabButtonPosChanged:function(){var t=Kekule.Widget.Position,i=this.getTabButtonPosition(),n=i&t.LEFT||i&t.RIGHT,s=i&t.RIGHT?e.TAB_AT_RIGHT:i&t.BOTTOM?e.TAB_AT_BOTTOM:i&t.LEFT?e.TAB_AT_LEFT:e.TAB_AT_TOP;this._lastTabBtnPosClassName&&this.removeClassName(this._lastTabBtnPosClassName),this._lastTabBtnPosClassName=s,this.addClassName(this._lastTabBtnPosClassName),this.setLayout(n?Kekule.Widget.Layout.VERTICAL:Kekule.Widget.Layout.HORIZONTAL)}}),Kekule.Widget.TabView=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.TabView",TAB_BTN_FIELD:"__$tabButton__",initialize:function($super,e){this._tabBtnContainer=null,this._pageContainer=null,$super(e),Kekule.ObjUtils.isUnset(this.getUseCornerDecoration())&&this.setUseCornerDecoration(!0),this.tabButtonPosChanged(),this.addEventListener("change",this.reactTabPagePropChange,this)},doFinalize:function($super){this.getTabGroup()&&this.getTabGroup().finalize(),$super()},initProperties:function(){this.defineProp("tabPages",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("tabPages");return e||(e=[],this.setPropStoreFieldValue("tabPages",e)),e},setter:null}),this.defineProp("activeTabPage",{dataType:"Kekule.Widget.TabPage",serializable:!1,setter:function(t){var i=this.getActiveTabPage();i!==t&&this.hasChild(t)&&(this.setPropStoreFieldValue("activeTabPage",t),i&&(i.removeClassName(e.TABVIEW_ACTIVE_PAGE),this._getPageTabButton(i).setChecked(!1)),t&&(t.addClassName(e.TABVIEW_ACTIVE_PAGE),this._getPageTabButton(t).setChecked(!0),this.invokeEvent("switchTab",{tabPage:t})))}}),this.defineProp("activeTabIndex",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getTabPages().indexOf(this.getActiveTabPage())},setter:function(e){var t=this.getTabPages()[e];t&&this.setActiveTabPage(t)}}),this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(e){this.getTabButtonPosition()!==e&&(this.setPropStoreFieldValue("tabButtonPosition",e),this.tabButtonPosChanged())}}),this.defineProp("showTabButtons",{dataType:DataType.BOOL,getter:function(){var e=this.getTabGroup();return e&&e.getDisplayed()},setter:function(e){var t=this.getTabGroup();t&&t.setDisplayed(e)}}),this.defineProp("tabGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+e.TABVIEW},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(t,i){var n=t.createElement("div");n.className=e.TABVIEW_TABBUTTON_CONTAINER;var s=t.createElement("div");return s.className=e.TABVIEW_PAGE_CONTAINER,this._tabBtnContainer=n,this._pageContainer=s,i.appendChild(n),i.appendChild(s),this.setPropStoreFieldValue("tabGroup",this.doCreateTabbar(t,n)),[n,s]},doCreateTabbar:function(e,t){var i=new Kekule.Widget.TabButtonGroup(e);return i.setParent(this),i.appendToElem(t),i.addEventListener("switch",function(e){var t=e.button,i=this._getPageOfTabButton(t);i&&this.setActiveTabPage(i)},this),i},getChildrenHolderElement:function(){return this._pageContainer},getContainerElement:function(){return this._pageContainer},_getPageTabButton:function(e){return e[this.TAB_BTN_FIELD]},_setPageTabButton:function(e,t){e[this.TAB_BTN_FIELD]=t},_getPageOfTabButton:function(e){for(var t=this.getTabPages(),i=0,n=t.length;i<n;++i){var s=t[i];if(this._getPageTabButton(s)===e)return s}return null},childWidgetAdded:function($super,e){if($super(e),e instanceof Kekule.Widget.TabPage){var t=!this.getTabPages().length;e.appendToElem(this._pageContainer),this.getTabPages().push(e),this._insertTabButtonBefore(e),t&&this.setActiveTabPage(e)}},childWidgetRemoved:function($super,e){$super(e),e instanceof Kekule.Widget.TabPage&&(t.remove(this.getTabPages(),e),this._removeTabButton(e))},childWidgetMoved:function($super,e,t){$super(e,t),e instanceof Kekule.Widget.TabPage&&this._changeTabIndex(e,t)},_insertTabButtonBefore:function(e,t){var i=this.getTabGroup(),n=new Kekule.Widget.RadioButton(this.getDocument());this._updateTabButton(e,n),this._setPageTabButton(e,n),t?n.insertToWidget(i,t):n.appendToWidget(i)},_updateTabButton:function(e,t){t||(t=this._getPageTabButton(e)),t.setText(e.getText()||""),e.getHint()&&t.setHint(e.getHint())},_removeTabButton:function(e){var t=this._getPageTabButton(e);t&&t.finalize()},_changeTabIndex:function(e,i){var n=this._getPageTabButton(e);this.getTabGroup()._moveChild(n,i);var s=this.getTabPages(),a=s.indexOf(e);a>=0&&a!==i&&t.changeItemIndex(s,e,i)},reactTabPagePropChange:function(e){var t=e.target;if(t instanceof Kekule.Widget.TabPage){var i=this._getPageTabButton(t);i&&this._updateTabButton(t,i)}},tabButtonPosChanged:function(){var t=Kekule.Widget.Position,i=this.getTabButtonPosition(),n=i&t.BOTTOM||i&t.RIGHT,s=(i&t.LEFT||t.RIGHT,i&t.RIGHT?e.TAB_AT_RIGHT:i&t.BOTTOM?e.TAB_AT_BOTTOM:i&t.LEFT?e.TAB_AT_LEFT:e.TAB_AT_TOP);this._lastTabBtnPosClassName&&this.removeClassName(this._lastTabBtnPosClassName),this._lastTabBtnPosClassName=s,this.addClassName(this._lastTabBtnPosClassName),this.getTabGroup().setTabButtonPosition(i),n?this.getElement().appendChild(this._tabBtnContainer):this.getElement().insertBefore(this._tabBtnContainer,this._pageContainer)},createNewTabPage:function(e,t,i){var n=this.getDocument(),s=new Kekule.Widget.TabPage(n);if(s.setText(e),t&&s.setHint(t),s.appendToWidget(this),i){var a=this.getChildWidgets().indexOf(i);this._moveChild(s,a)}return s}})}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,i=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{VALUELISTEDITOR:"K-ValueListEditor",VALUELISTEDITOR_ROW:"K-ValueListEditor-Row",VALUELISTEDITOR_CELL:"K-ValueListEditor-Cell",VALUELISTEDITOR_INDICATORCELL:"K-ValueListEditor-IndicatorCell",VALUELISTEDITOR_KEYCELL:"K-ValueListEditor-KeyCell",VALUELISTEDITOR_VALUECELL:"K-ValueListEditor-ValueCell",VALUELISTEDITOR_CELL_CONTENT:"K-ValueListEditor-CellContent",VALUELISTEDITOR_VALUECELL_TEXT:"K-ValueListEditor-ValueCellText",VALUELISTEDITOR_INLINE_EDIT:"K-ValueListEditor-InlineEdit",VALUELISTEDITOR_EXPANDMARK:"K-ValueListEditor-ExpandMark",VALUELISTEDITOR_ACTIVE_ROW:"K-ValueListEditor-ActiveRow"}),Kekule.Widget.ValueListEditor=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ValueListEditor",BINDABLE_TAG_NAMES:["table"],ROW_ELEM_TAG:"tr",CELL_ELEM_TAG:"td",ROW_DATA_FIELD:"__$row_data__",ROW_EDIT_INFO_FIELD:"__$row_edit_info__",initialize:function($super,e){$super(e),this._inlineEdit=null,this._isActivitingRow=!1},initProperties:function(){this.defineProp("hash",{dataType:DataType.HASH,getter:function(){return this._getTotalHash()},setter:function(e){this._setTotalHash(e),this.setPropStoreFieldValue("hash",e)}}),this.defineProp("readOnly",{dataType:DataType.BOOL}),this.defineProp("useKeyHint",{dataType:DataType.BOOL}),this.defineProp("valueDisplayMode",{dataType:DataType.INT,enumSource:Kekule.Widget.ValueListEditor.ValueDisplayMode,setter:function(e){this.getValueDisplayMode()!==e&&(this.setPropStoreFieldValue("valueDisplayMode",e),this.valueDisplayModeChanged())}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var n=this.getActiveRow();n!==e&&(n&&(this.finishEditing(),t.removeClass(n,i.VALUELISTEDITOR_ACTIVE_ROW),this._showValueCellText(n)),this._inlineEdit&&this._inlineEdit.finalize(),e&&(t.addClass(e,i.VALUELISTEDITOR_ACTIVE_ROW),this.getReadOnly()||this.createValueEditWidget(e)),this.setPropStoreFieldValue("activeRow",e),this.invokeEvent("activeRowChange",{row:e}))}})},doGetWidgetClassName:function(){return i.VALUELISTEDITOR},doCreateRootElement:function(e){return e.createElement("table")},doBindElement:function($super,e){$super(e)},getRootElem:function(){return this.getElement()},createRowElem:function(e){var n=e.createElement(this.ROW_ELEM_TAG);return t.addClass(n,i.VALUELISTEDITOR_ROW),n},createCellElem:function(e){var n=e.createElement(this.CELL_ELEM_TAG);return t.addClass(n,i.VALUELISTEDITOR_CELL),n},createIndicatorCellElem:function(e){var n=this.createCellElem(e);t.addClass(n,i.VALUELISTEDITOR_INDICATORCELL);var s=e.createElement("span");return n.appendChild(s),n},createKeyCellElem:function(e){var n=this.createCellElem(e);return t.addClass(n,i.VALUELISTEDITOR_KEYCELL),n},createValueCellElem:function(e){var n=this.createCellElem(e);return t.addClass(n,i.VALUELISTEDITOR_VALUECELL),n},createValueEditWidget:function(e){var n=null;if(e===this.getActiveRow()?n=this._inlineEdit:this._inlineEdit&&(this._inlineEdit.finalize(),this._inlineEdit=null),!n){(n=this.doCreateValueEditWidget(e)).setBubbleUiEvents(!0),t.addClass(n.getElement(),i.VALUELISTEDITOR_INLINE_EDIT);var s=this.getValueCell(e),a=this.getCellContentWrapper(s,!0);n.appendToElem(a)}return n&&(n.focus&&n.focus(),n.selectAll&&n.selectAll(),this._inlineEdit=n,this._hideValueCellText(e)),n},doCreateValueEditWidget:function(e){var t=this.getRowData(e),i=this.getValueCellText(e,t),n=this.getValueEditWidgetInfo(e),s=new(0,n.widgetClass)(this);return n.propValues&&s.setPropValues(n.propValues),s.setValue(i),s},getDefaultValueEditWidgetInfo:function(){return{widgetClass:Kekule.Widget.TextBox}},getValueEditWidgetInfo:function(e){return this.getRowEditInfo(e)||this.getDefaultValueEditWidgetInfo()},getRowElems:function(){return this.getRootElem()?e.getDirectChildElems(this.getRootElem(),this.ROW_ELEM_TAG):[]},getRows:function(){return this.getRowElems()},getRowCount:function(){var e=this.getRowElems();return e?e.length:0},getRowAt:function(e){var t=this.getRowElems();return t?t[e]:null},getPrevRow:function(e){for(var t=this.ROW_ELEM_TAG.toLowerCase(),i=e.previousSibling;i&&(i.nodeType!==Node.ELEMENT_NODE||i.tagName.toLowerCase()!==t);)i=i.previousSibling;return i},getNextRow:function(e){for(var t=this.ROW_ELEM_TAG.toLowerCase(),i=e.nextSibling;i&&(i.nodeType!==Node.ELEMENT_NODE||i.tagName.toLowerCase()!==t);)i=i.nextSibling;return i},getKeyCell:function(t){return e.getDirectChildElems(t,this.CELL_ELEM_TAG)[1]},getCellContentWrapper:function(n,s){var a=e.getDirectChildElems(n),r=a?a[0]:null;return!r&&s&&(r=n.ownerDocument.createElement("span"),n.appendChild(r),t.addClass(r,i.VALUELISTEDITOR_CELL_CONTENT)),r},getValueCellTextWrapper:function(e,n){var s=null,a=this.getCellContentWrapper(e,n);if(a){var r=a.getElementsByTagName("span");!(s=r?r[0]:null)&&n&&(s=e.ownerDocument.createElement("span"),a.appendChild(s),t.addClass(s,i.VALUELISTEDITOR_VALUECELL_TEXT))}return s},_hideValueCellText:function(e){var t=this.getValueCellTextWrapper(this.getValueCell(e));t&&(t.style.visibility="hidden")},_showValueCellText:function(e){var t=this.getValueCellTextWrapper(this.getValueCell(e));t&&(t.style.visibility="visible")},getValueCell:function(t){return e.getDirectChildElems(t,this.CELL_ELEM_TAG)[2]},getParentCell:function(t){return e.getNearestAncestorByTagName(t,this.CELL_ELEM_TAG,!0)},getParentRow:function(t){return e.getNearestAncestorByTagName(t,this.ROW_ELEM_TAG,!0)},_createNewRow:function(e){var t=this.getDocument(),i=this.createRowElem(t);if(i){var n=this.createIndicatorCellElem(t);i.appendChild(n);var s=this.createKeyCellElem(t);i.appendChild(s);var a=this.createValueCellElem(t);i.appendChild(a),e&&this.setRowData(i,e)}return i},insertRowBefore:function(e,t){var i=this._createNewRow(e);return i&&this.getRootElem().insertBefore(i,t||null),i},appendRow:function(e){return this.insertRowBefore(e,null)},removeRow:function(e){return e===this.getActiveRow()&&this.setActiveRow(null),this.getRootElem().removeChild(e),this},removeRowAt:function(e){var t=this.getRowAt(e);return t&&this.removeRow(t),this},clear:function(){this.setActiveRow(null),this.getRootElem()&&Kekule.DomUtils.clearChildContent(this.getRootElem())},updateAll:function(){for(var e=this.getRowElems(),t=0,i=e.length;t<i;++t){var n=e[t],s=this.getRowData(n);this.setRowData(n,s)}return this},valueDisplayModeChanged:function(){this.updateAll()},getKeyCellText:function(e,t){return t.title||t.key},getKeyCellHint:function(e,t){return t.hint||this.getKeyCellText(e,t)},getValueCellText:function(e,t){return this.getValueDisplayMode()===n.JSON?JSON.stringify(t.value):""+t.value},valueCellTextToValue:function(e,t,i){return this.getValueDisplayMode()===n.JSON?JSON.parse(e):e},setValueCellText:function(e,t){var i=this.getRowData(t),n=this.valueCellTextToValue(e,t,i);return i.value=n,this.setRowData(t,i),this},getRowData:function(e){return e[this.ROW_DATA_FIELD]},setRowData:function(e,t){e[this.ROW_DATA_FIELD]=t,this.setRowKeyCellContent(e,this.getKeyCellText(e,t),this.getKeyCellHint(e,t)),this.setRowValueCellContent(e,this.getValueCellText(e,t)),e===this.getActiveRow()&&this._inlineEdit&&this.createValueEditWidget(e)},setRowKeyCellContent:function(e,t,i){var n=this.getKeyCell(e),s=this.getCellContentWrapper(n,!0);s.innerHTML=t,this.getUseKeyHint()&&(s.title=i)},setRowValueCellContent:function(e,t){var i=this.getValueCell(e),n=this.getValueCellTextWrapper(i,!0),s=t;""===s?n.innerHTML="&nbsp;":Kekule.DomUtils.setElementText(n,s)},getRowEditInfo:function(e){return e[this.ROW_EDIT_INFO_FIELD]},setRowEditInfo:function(e,t){e[this.ROW_EDIT_INFO_FIELD]=t,e===this.getActiveRow()&&(this.setActiveRow(null),this.setActiveRow(e))},editRow:function(e){this.setActiveRow(e)},finishEditing:function(){var e=this.getActiveRow();return e&&this._inlineEdit&&(this.setValueCellText(this._inlineEdit.getValue(),e),this.invokeEvent("editFinish",{row:e})),this},cancelEditing:function(){var e=this.getActiveRow();if(e&&this._inlineEdit){var t=this.getRowData(e);this.setRowData(e,t),this.invokeEvent("editCancel",{row:e})}return this},_getTotalHash:function(){for(var e={},t=this.getRowElems(),i=0,n=t.length;i<n;++i){var s=t[i],a=this.getRowData(s);a&&(e[a.key]=a.value)}return e},_setTotalHash:function(e){for(var t=this.getRowElems(),i=t.length,n=Kekule.ObjUtils.getOwnedFieldNames(e),s=n.length,a=0;a<s;++a){var r,o=n[a],l=e[o];a<i?(r=this.getRowAt(a),this.setRowData(r,{key:o,value:l})):r=this.appendRow({key:o,value:l})}if(i>s)for(a=i-1;a>=s;--a)this.removeRow(t[a]);var u=this.getActiveRow();return u&&(this.setActiveRow(null),this.setActiveRow(u)),this},react_click:function(e){var t=e.getTarget(),i=this.getParentRow(t);i&&this.setActiveRow(i)},react_keydown:function(e){var t=e.getKeyCode();if(!(e.getAltKey()||e.getShiftKey()||e.getCtrlKey())){var i,n=this.getActiveRow();if(n)t===Kekule.X.Event.KeyCode.UP?i=this.getPrevRow(n):t===Kekule.X.Event.KeyCode.DOWN&&(i=this.getNextRow(n)),i&&this.setActiveRow(i)}},react_keyup:function(e){var t=e.getKeyCode();t===Kekule.X.Event.KeyCode.ESC?this.cancelEditing():t===Kekule.X.Event.KeyCode.ENTER&&this.finishEditing()},react_blur:function(e){}}),Kekule.Widget.ValueListEditor.ValueDisplayMode={SIMPLE:0,JSON:1};var n=Kekule.Widget.ValueListEditor.ValueDisplayMode}(),function(){"use strict";Kekule.DomUtils,Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{COLORPICKER:"K-ColorPicker",COLORPICKER_HEADER:"K-ColorPicker-Header",COLORPICKER_SPEC_COLOR_PALETTE:"K-ColorPicker-Spec-Color-Palette",COLORPICKER_HEXBOX:"K-ColorPicker-HexBox",COLORPICKER_PREVIEWER:"K-ColorPicker-Previewer",COLORPICKER_INPUT:"K-ColorPicker-Input",COLORPICKER_BROWSE_BTN:"K-ColorPicker-Browse-Btn",COLORPICKER_PALETTE:"K-ColorPicker-Palette",COLORPICKER_PALETTE_LINE:"K-ColorPicker-Palette-Line",COLORPICKER_PALETTE_CELL:"K-ColorPicker-Palette-Cell",COLORPICKER_PALETTE_CELL_TRANSPARENT:"K-ColorPicker-Palette-Cell-Transparent",COLORPICKER_SPEC_COLOR_UNSET:"K-Color-Unset",COLORPICKER_SPEC_COLOR_DEFAULT:"K-Color-Default",COLORPICKER_SPEC_COLOR_MIXED:"K-Color-Mixed",COLORPICKER_SPEC_COLOR_TRANSPARENT:"K-Color-Transparent",COLORDROPTEXTBOX:"K-ColorDropTextBox",COLORDROPBUTTON:"K-ColorDropButton",COLORPREVIEWER:"K-ColorPreviewer"}),Kekule.Widget.ColorPicker=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ColorPicker",COLOR_VALUE_FIELD:"__$colorValue__",COLOR_TEXT_FIELD:"__$colorText__",COLOR_CLASS_FIELD:"__ $colorClass__",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e){$super(e),this.setUseCornerDecoration(!0),this.setValue("#000000"),this.setTouchAction("none")},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("value",e),this.getHexBox().innerHTML=e||"&nbsp;",this.getPreviewer().style.backgroundColor=e||"transparent",this.getColorInput()&&(this.getColorInput().value=e)}}),this.defineProp("colorClassName",{dataType:DataType.STRING}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e),this._recreateSpecialColorPaletteCells(this.getDocument(),this.getSpecialColorPalette())}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("hexBox",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("palette",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("previewer",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("colorInput",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("specialColorPalette",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("isPicking",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+e.COLORPICKER},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var i=[];return i.push(this.doCreateHeader(e,t)),i.push(this.doCreatePalette(e,t)),i},doCreateHeader:function(t,i){var n=t.createElement("div");n.className=e.COLORPICKER_HEADER,n.appendChild(this.doCreateSpecialColorPalette(t)),n.appendChild(this.doCreateHexBox(t)),n.appendChild(this.doCreatePreviewer(t));var s=this.doCreateColorInput(t);if(s){n.appendChild(s);var a=this.doCreateColorDialogBtn(t);a&&a.appendToElem(n)}return i.appendChild(n),n},doCreateSpecialColorPalette:function(t){var i=t.createElement("div");return i.className=e.COLORPICKER_SPEC_COLOR_PALETTE,this._recreateSpecialColorPaletteCells(t,i),this.setSpecialColorPalette(i),i},_isPredefinedSpecialColor:function(e){var t=Kekule.Widget.ColorPicker.SpecialColors;return[t.UNSET,t.DEFAULT,t.MIXED,t.TRANSPARENT].indexOf(e)>=0},_getPredefinedSpecialColorInfo:function(t){var i=Kekule.Widget.ColorPicker.SpecialColors,n=[i.UNSET,i.DEFAULT,i.MIXED,i.TRANSPARENT],s=[e.COLORPICKER_SPEC_COLOR_UNSET,e.COLORPICKER_SPEC_COLOR_DEFAULT,e.COLORPICKER_SPEC_COLOR_MIXED,e.COLORPICKER_SPEC_COLOR_TRANSPARENT],a=[Kekule.$L("WidgetTexts.S_COLOR_UNSET"),Kekule.$L("WidgetTexts.S_COLOR_DEFAULT"),Kekule.$L("WidgetTexts.S_COLOR_MIXED"),Kekule.$L("WidgetTexts.S_COLOR_TRANSPARENT")],r={value:t},o=n.indexOf(t);return o>=0&&(r.text=a[o],r.className=s[o]),r},_recreateSpecialColorPaletteCells:function(e,t){Kekule.DomUtils.clearChildContent(t);var i=this.getSpecialColors();if(i&&i.length)for(var n=0,s=i.length;n<s;++n){var a,r=i[n],o={};DataType.isObjectValue(r)?o=r:this._isPredefinedSpecialColor(r)?o=this._getPredefinedSpecialColorInfo(r):o.value=r,a=this.doCreatePaletteCell(e,o.value,o.text,o.className),o.className&&Kekule.HtmlElementUtils.addClass(a,o.className),t.appendChild(a)}},doCreateHexBox:function(t){var i=t.createElement("span");return i.className=e.COLORPICKER_HEXBOX,i.innerHTML="&nbsp",this.setHexBox(i),i},doCreatePreviewer:function(t){var i=t.createElement("span");return i.className=e.COLORPICKER_PREVIEWER,i.innerHTML="&nbsp",this.setPreviewer(i),i},doCreateColorInput:function(t){if(Kekule.BrowserFeature.html5Form.supportType("color")){var i=t.createElement("input");i.setAttribute("type","color"),i.className=e.COLORPICKER_INPUT;var n=this;return Kekule.X.Event.addListener(i,"change",function(e){var t=i.value;n.setValue(t),n.notifyColorSet()}),this.setColorInput(i),i}return null},doCreateColorDialogBtn:function(t){if(Kekule.BrowserFeature.html5Form.supportType("color")){var i=new Kekule.Widget.Button(t);return i.setText(Kekule.$L("WidgetTexts.CAPTION_BROWSE_COLOR")),i.setHint(Kekule.$L("WidgetTexts.HINT_BROWSE_COLOR")),i.setShowText(!1),i.doSetShowGlyph(!0),i.linkStyleResource(Kekule.Widget.StyleResourceNames.ICON_COLOR_PICK),i.addClassName(e.COLORPICKER_BROWSE_BTN),i.addEventListener("execute",this.openColorDialog,this),i}},doCreatePalette:function(t,i){var n=t.createElement("div");n.className=e.COLORPICKER_PALETTE;for(var s=["00","00","11","22","33","44","55","66","77","88","99","AA","BB","CC","DD","EE","FF",null],a=s.length,r=this.doCreatePaletteLine(t),o=0;o<a;o++){var l=s[o]?"#"+s[o]+s[o]+s[o]:"transparent",u=this.doCreatePaletteCell(t,l);r.appendChild(u)}n.appendChild(r);for(a=(s=["00","33","66","99","CC","FF"]).length,o=0;o<a;o++){r=this.doCreatePaletteLine(t);for(var d=0;d<a>>1;d++)for(var h=0;h<a;h++){l="#"+s[d]+s[o]+s[h],u=this.doCreatePaletteCell(t,l);r.appendChild(u)}n.appendChild(r)}for(o=0;o<a;o++){for(r=this.doCreatePaletteLine(t),d=a>>1;d<a;d++)for(h=0;h<a;h++){l="#"+s[d]+s[o]+s[h],u=this.doCreatePaletteCell(t,l);r.appendChild(u)}n.appendChild(r)}return i.appendChild(n),this.setPalette(n),n},doCreatePaletteCell:function(t,i,n,s){var a=t.createElement("span"),r=e.COLORPICKER_PALETTE_CELL;if("transparent"===i)r+=" "+e.COLORPICKER_PALETTE_CELL_TRANSPARENT;else try{a.style.backgroundColor=i}catch(e){}return a[this.COLOR_VALUE_FIELD]=i,a[this.COLOR_TEXT_FIELD]=n||i,a[this.COLOR_CLASS_FIELD]=s,a.className=r,a.title=n||i,a},doCreatePaletteLine:function(t){var i=t.createElement("div");return i.className=e.COLORPICKER_PALETTE_LINE,i},_isPaletteCellElem:function(t){return Kekule.HtmlElementUtils.hasClass(t,e.COLORPICKER_PALETTE_CELL)},openColorDialog:function(){return this.getColorInput()&&this.getColorInput().click(),this},applyColor:function(e){var t=e[this.COLOR_VALUE_FIELD];t&&this.setValue(t);var i=e[this.COLOR_TEXT_FIELD];i&&(this.getHexBox().innerHTML=i);var n=e[this.COLOR_CLASS_FIELD];this.setColorClassName(n)},notifyColorSet:function(){this.setIsDirty(!0),this.invokeEvent("valueSet",{value:this.getValue(),colorClassName:this.getColorClassName()}),this.invokeEvent("valueChange",{value:this.getValue(),colorClassName:this.getColorClassName()})},doReactActiviting:function($super,e){$super(e);var t=e.getTarget();if(this._isPaletteCellElem(t))return this.setIsPicking(!0),this.applyColor(t),!0},doReactDeactiviting:function($super,e){if(this.getIsPicking()){this.setIsPicking(!1);var t=e.getTarget();return this._isPaletteCellElem(t)&&this.applyColor(t),this.notifyColorSet(),!0}$super(e)},reactPointerMoving:function($super,e){if($super(e),this.getIsPicking()){var t=e.getTarget();if(e.getTouches()){var i={x:e.getClientX(),y:e.getClientY()},n=this.getDocument();t=n.elementFromPoint&&n.elementFromPoint(i.x,i.y)||t,e.preventDefault()}return t&&this._isPaletteCellElem(t)&&this.applyColor(t),e.preventDefault(),!0}}}),Kekule.Widget.ColorPicker.SpecialColors={UNSET:"(unset)",DEFAULT:"(default)",MIXED:"(mixed)",TRANSPARENT:"transparent"},Kekule.Widget.ColorDropTextBox=Class.create(Kekule.Widget.ButtonTextBox,{CLASS_NAME:"Kekule.Widget.ColorDropTextBox",initialize:function($super,e,t){$super(e),this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),this.addEventListener("buttonExecute",this.reactDropbuttonExecute,this),this.setShowPreview(!0),t&&this.setValue(t)},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(e){this.getPreviewElem().style.display=e?"inherit":""}}),this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(e){var t=this.getPreviewElem();if(t){var i=this.getColorClassName();i&&Kekule.HtmlElementUtils.removeClass(t,i),e&&Kekule.HtmlElementUtils.addClass(t,e)}this.setPropStoreFieldValue("colorClassName",e)}}),this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("colorPicker");return e||((e=new Kekule.Widget.ColorPicker(this)).setDisplayed(!1),e.getElement().style.position="absolute",e.setSpecialColors(this.getSpecialColors()),e.addEventListener("valueChange",this.reactColorPickerValueSet,this),e.appendToElem(this.getElement()),this.setPropStoreFieldValue("colorPicker",e)),e}}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var t=this.getPropStoreFieldValue("colorPicker");t&&t.setSpecialColors(e)}})},doFinalize:function($super){var e=this.getPropStoreFieldValue("colorPicker");e&&e.finalize(),$super()},doGetWidgetClassName:function($super){return $super()+" "+e.COLORDROPTEXTBOX},doCreateSubElements:function($super,t,i){$super(t,i);var n=new Kekule.Widget.DumbWidget(this);return n.addClassName(e.COLORPREVIEWER),this.setHeadingWidget(n),[n.getElement()]},getPreviewElem:function(){var e=this.getHeadingWidget();if(e)return e.getElement()},showColorPicker:function(){var e=this.getColorPicker();e.isShown()||(e.setValue(this.getValue()),e.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN))},hideColorPicker:function(){var e=this.getPropStoreFieldValue("colorPicker");e&&e.isShown()&&e.hide()},reactDropbuttonExecute:function(e){this.showColorPicker()},reactColorPickerValueSet:function(e){var t=e.value;this.setValue(t),this.setIsDirty(this.getIsDirty()||this.getColorPicker().getIsDirty()),this.setColorClassName(e.colorClassName),this.hideColorPicker(),e.stopPropagation()},doSetValue:function($super,e){$super(e);var t=this.getPreviewElem();t&&(t.style.backgroundColor="transparent",t.style.backgroundColor=e)}}),Kekule.Widget.ColorDropButton=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.ColorDropButton",initialize:function($super,e,t){$super(e),this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),this.setShowPreview(!0),t&&this.setValue(t)},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(e){try{this.getPreviewElem().style.display=e?"inherit":""}catch(e){}}}),this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getText()},setter:function(e){this.setText(e),this.updateColorPreview(e);var t=this.getPropStoreFieldValue("colorPicker");t&&t.setValue(e)}}),this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(e){var t=this.getPreviewElem();if(t){var i=this.getColorClassName();i&&Kekule.HtmlElementUtils.removeClass(t,i),e&&Kekule.HtmlElementUtils.addClass(t,e)}this.setPropStoreFieldValue("colorClassName",e)}}),this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("colorPicker");return e||((e=new Kekule.Widget.ColorPicker(this)).setDisplayed(!1),e.getElement().style.position="absolute",e.setSpecialColors(this.getSpecialColors()),e.addEventListener("valueChange",this.reactColorPickerValueSet,this),this.setPropStoreFieldValue("colorPicker",e)),e}}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var t=this.getPropStoreFieldValue("colorPicker");t&&t.setSpecialColors(e)}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getColorPicker().getIsDirty()},setter:function(e){this.getColorPicker().setIsDirty(e)}})},doFinalize:function($super){var e=this.getPropStoreFieldValue("colorPicker");e&&e.finalize(),$super()},doGetWidgetClassName:function($super){return $super()+" "+e.COLORDROPBUTTON},doGetDropDownWidget:function(){return this.getColorPicker()},getPreviewElem:function(){return this._elemLeadingGlyphPart},showColorPicker:function(){var e=this.getColorPicker();e.isShown()||(e.setValue(this.getValue()),e.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN))},hideColorPicker:function(){var e=this.getPropStoreFieldValue("colorPicker");e&&e.isShown()&&e.hide()},reactColorPickerValueSet:function(e){var t=e.value,i=e.colorClassName;this.setValue(t),this.setColorClassName(i),this.hideColorPicker(),this.invokeEvent("valueChange",{value:t}),e.stopPropagation()},updateColorPreview:function(e){var t=this.getPreviewElem();t&&(t.style.backgroundColor="transparent",t.style.backgroundColor=e)}})}(),function(){"use strict";Kekule.DomUtils,Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TEXTEDITOR:"K-TextEditor",TEXTEDITOR_TOOLBAR:"K-TextEditor-Toolbar",TEXTEDITOR_TEXTAREA:"K-TextEditor-TextArea",TEXTEDITOR_FONTBOX:"K-TextEditor-FontBox",TEXTEDITOR_BTN_FONTSIZEINC:"K-TextEditor-Btn-FontSizeInc",TEXTEDITOR_BTN_FONTSIZEDEC:"K-TextEditor-Btn-FontSizeDec",TEXTEDITOR_BTN_TEXTWRAP:"K-TextEditor-Btn-TextWrap"}),Kekule.Widget.TextEditor=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextEditor",BINDABLE_TAG_NAMES:["div","span"],DEF_TOOLBAR_COMPONENTS:["fontFamily","fontSizeInc","fontSizeDec","textWrap"],initialize:function($super,e){this._toolCompWidgets=[],this.setPropStoreFieldValue("showToolbar",!0),$super(e)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getTextArea();return e?e.getText():null},setter:function(e){var t=this.getTextArea();t&&t.setText(e)}}),this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getTextArea().getReadOnly()},setter:function(e){return this.getTextArea().setReadOnly(e)}}),this.defineProp("wrap",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getTextArea().getWrap()},setter:function(e){var t=this.getTextArea().setWrap(e);return this.updateToolButtonStates(),t}}),this.defineProp("textArea",{dataType:"Kekule.Widget.TextArea",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var e=this.getPropStoreFieldValue("textArea");return e||(e=this.createTextArea(),this.setPropStoreFieldValue("textArea",e)),e}}),this.defineProp("toolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var e=this.getPropStoreFieldValue("toolbar");return e||this.getShowToolbar()&&(e=this.createToolbar(),this.setPropStoreFieldValue("styleToolbar",e)),e}}),this.defineProp("showToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showToolbar",e),this.getToolbar().setDisplayed(e)}}),this.defineProp("toolbarPos",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarPos",e),this.updateChildWidgetPos()}}),this.defineProp("toolbarComponents",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("toolbarComponents");return e||(e=null,this.setPropStoreFieldValue("toolbarComponents",e)),e},setter:function(e){this.setPropStoreFieldValue("toolbarComponents",e),this.recreateToolbarComponents(e)}}),this.defineProp("candidateFontFamilies",{dataType:DataType.ARRAY}),this.defineProp("fontSizeLevel",{dataType:DataType.FLOAT,setter:function(e){this.setPropStoreFieldValue("fontSizeLevel",e),this.setTextStyle({fontSize:e+"em"})}})},finalize:function($super){this._finalizeSubElements(),$super()},_finalizeSubElements:function(){var e=this.getTextArea();e&&e.finalize()},getCoreElement:function($super){var e=this.getTextArea();return e?e.getElement():$super()},getChildrenHolderElement:function($super){return this.getElement()},doGetWidgetClassName:function($super){return $super()+" "+e.TEXTEDITOR},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var i=this.createToolbar();i&&i.appendToElem(t);var n=this.createTextArea();return n.appendToElem(t),this.updateChildWidgetPos(),[i.getElement(),n.getElement()]},doWidgetShowStateChanged:function($super,e){$super(e),e&&(this.updateChildWidgetPos(),this.updateToolButtonStates())},doFileDragDrop:function($super,e){if(e){if(Kekule.BrowserFeature.fileapi){var t=this,i=new FileReader;i.onload=function(e){var n=i.result;t.setText(n)},i.readAsText(e[0])}return!0}return $super()},createToolbar:function(){if(this.getShowToolbar()){var t=new Kekule.Widget.Toolbar(this);return this.setPropStoreFieldValue("toolbar",t),t.addClassName(e.TEXTEDITOR_TOOLBAR),this.recreateToolbarComponents(),t}return null},recreateToolbarComponents:function(e){e||(e=this.getToolbarComponents());var t=e||this.DEF_TOOLBAR_COMPONENTS,i=this.getToolbar();if(i){var n;this._toolCompWidgets.length=0,i.clearWidgets(),i.setShowText(!1),i.setShowGlyph(!0);for(var s=0,a=t.length;s<a;++s){var r=t[s];n="fontFamily"===r?this.createFontFamilyComboBox(i):this.createToolButton(i,r),this._toolCompWidgets[r]=n}this.updateToolButtonStates()}},createFontFamilyComboBox:function(t){for(var i=new Kekule.Widget.ComboBox(t),n=Kekule.Widget.FontEnumerator.getAvailableFontFamilies(this.getCandidateFontFamilies()),s=[],a=0,r=n.length;a<r;++a)s.push({text:n[a],value:n[a]});return i.setHint(Kekule.$L("WidgetTexts.HINT_CHOOSE_FONT_FAMILY")),i.addClassName(e.TEXTEDITOR_FONTBOX),i.setItems(s),i.appendToWidget(t),i.addEventListener("valueChange",function(e){this.setTextStyle({fontFamily:i.getValue()})},this),i},createToolButton:function(t,i){var n,s,a,r=new("textWrap"===i?Kekule.Widget.CheckButton:Kekule.Widget.Button)(t);return r.appendToWidget(t),"textWrap"===i?(n=Kekule.$L("WidgetTexts.CAPTION_TOGGLE_TEXTWRAP"),s=Kekule.$L("WidgetTexts.HINT_TOGGLE_TEXTWRAP"),a=e.TEXTEDITOR_BTN_TEXTWRAP,r.setChecked("off"!==this.getWrap()),r.addEventListener("checkChange",function(e){var t=r.getChecked();this.setWrap(t?"virtual":"off")},this)):"fontSizeInc"===i?(n=Kekule.$L("WidgetTexts.CAPTION_INC_TEXT_SIZE"),s=Kekule.$L("WidgetTexts.HINT_INC_TEXT_SIZE"),a=e.TEXTEDITOR_BTN_FONTSIZEINC,r.addEventListener("execute",this.increaseTextSize,this)):"fontSizeDec"===i&&(n=Kekule.$L("WidgetTexts.CAPTION_DEC_TEXT_SIZE"),s=Kekule.$L("WidgetTexts.HINT_DEC_TEXT_SIZE"),a=e.TEXTEDITOR_BTN_FONTSIZEDEC,r.addEventListener("execute",this.decreaseTextSize,this)),r.setText(n),r.setHint(s),r.addClassName(a),r},createToolCheckButton:function(e,t){var i=new Kekule.Widget.CheckButton(e);return i.appendToWidget(e),i},createTextArea:function(){var t=new Kekule.Widget.TextArea(this);return this.setPropStoreFieldValue("textArea",t),t.addClassName(e.TEXTEDITOR_TEXTAREA),t},updateChildWidgetPos:function(){var e=this.getToolbarPos(),t=this.getToolbar().getElement(),i=this.getTextArea().getElement(),n=t.parentNode;e===Kekule.Widget.Position.BOTTOM?n.insertBefore(i,t):n.insertBefore(t,i)},updateToolButtonStates:function(){var e=this._toolCompWidgets.textWrap;e&&e.setChecked("off"!==this.getWrap())},setTextStyle:function(e){var t=this.getTextArea();if(t)for(var i=Kekule.ObjUtils.getOwnedFieldNames(e),n=0,s=i.length;n<s;++n){var a=i[n];t.setStyleProperty(a,e[a])}return this},increaseTextSize:function(){var e=this.getFontSizeLevel()||1,t=Kekule.ZoomUtils.getNextZoomInRatio(e);this.setFontSizeLevel(t)},decreaseTextSize:function(){var e=this.getFontSizeLevel()||1,t=Kekule.ZoomUtils.getNextZoomOutRatio(e);this.setFontSizeLevel(t)}})}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.StyleUtils,i=Kekule.DomUtils,n=Kekule.HtmlElementUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_GRID:"K-Widget-Grid",WIDGET_GRID_CELL:"K-Widget-Grid-Cell",WIDGET_GRID_ADD_CELL:"K-Widget-Grid-Add-Cell",WIDGET_GRID_INTERACTION_AREA:"K-Widget-Grid-Interaction-Area",WIDGET_GRID_WIDGET_PARENT:"K-Widget-Grid-Widget-Parent",WIDGET_GRID_BUTTON_REMOVE:"K-Widget-Grid-Button-Remove",WIDGET_GRID_ENABLE_CELL_INTERACTION:"K-Widget-Grid-Enable-Cell-Interaction"});var s=Kekule.Widget.HtmlClassNames;Kekule.Widget.WidgetGrid=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGrid",CELL_FIELD:"__$cell__",WIDGET_FIELD:"__$cellWidget__",INTERACTION_AREA_FIELD:"__$interactionArea__",EXCEED_TOPRIGHT_FIELD:"__$exceedTopRight__",BTN_REMOVE_CELL_FIELD:"__$removeCell__",initialize:function($super,e){this._floatClearer=null,this.reactCellMouseEnterBind=this.reactCellMouseEnter.bind(this),this.reactCellMouseLeaveBind=this.reactCellMouseLeave.bind(this),this.reactCellClickBind=this.reactCellClick.bind(this),$super(e),this.addEventListener("change",this.reactChildWidgetChange,this)},initProperties:function(){this.defineProp("childWidgetClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("cellWidth",{dataType:DataType.STRING}),this.defineProp("cellHeight",{dataType:DataType.STRING}),this.defineProp("widgetPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position}),this.defineProp("autoShrinkWidgets",{dataType:DataType.BOOL}),this.defineProp("keepWidgetAspectRatio",{dataType:DataType.BOOL}),this.defineProp("restoreWidgetSizeOnHotTrack",{dataType:DataType.BOOL}),this.defineProp("enableAdd",{dataType:DataType.BOOL,setter:function(e){if(this.setPropStoreFieldValue("enableAdd",e),e)this.setAddingCell(this.createAddCell());else{var t=this.getAddingCell();t&&this.getContainerElement().removeChild(t)}}}),this.defineProp("enableRemove",{dataType:DataType.BOOL,getter:function(){return this.hasClassName(s.WIDGET_GRID_ENABLE_CELL_INTERACTION)},setter:function(e){e?this.addClassName(s.WIDGET_GRID_ENABLE_CELL_INTERACTION):this.removeClassName(s.WIDGET_GRID_ENABLE_CELL_INTERACTION)}}),this.defineProp("hotCell",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getHotCell()!==e&&(this.hotCellChanged(this.getHotCell(),e),this.setPropStoreFieldValue("hotCell",e))}}),this.defineProp("addingCell",{dataType:DataType.OBJECT,serializable:!1})},initPropValues:function(){this.setPropStoreFieldValue("autoShrinkWidgets",!0),this.setPropStoreFieldValue("keepWidgetAspectRatio",!0),this.setPropStoreFieldValue("restoreWidgetSizeOnHotTrack",!0),this.setEnableRemove(!0),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function($super){return $super()+" "+s.WIDGET_GRID},doCreateRootElement:function(e){return e.createElement("div")},doSetUseCornerDecoration:function($super,e){$super(e),this.updateAllCells()},doObjectChange:function($super,t){$super(t),e.intersect(t,["autoShrinkWidgets","keepWidgetAspectRatio","cellWidth","cellHeight","widgetPos"]).length>0&&this.updateAllCells()},doWidgetShowStateChanged:function($super,e){return e&&this.updateAllCells(),$super(e)},each:function(e){for(var t=Kekule.ArrayUtils.clone(this.getChildWidgets()),i=0,n=t.length;i<n;++i)e(t[i])},addWidget:function(e){e.setParent(this)},removeWidget:function(e,t){this.hasChild(e)&&(e.setParent(null),t&&e.finalize())},createWidget:function(){var e=this.doCreateNewChildWidget(this.getDocument());if(e)return e.setParent(this),e},doCreateNewChildWidget:function(e){return null},getFloatClearer:function(){return this._floatClearer||(this._floatClearer=this.getDocument().createElement("div"),this._floatClearer.style.clear="both",this.getContainerElement().appendChild(this._floatClearer)),this._floatClearer},createCell:function(e){var t=!e,i=this.getDocument(),n=i.createElement("div");n.className=s.WIDGET_GRID_CELL+" "+s.DYN_CREATED+(t?" "+s.WIDGET_GRID_ADD_CELL:""),n[this.WIDGET_FIELD]=e,Kekule.X.Event.addListener(n,"mouseenter",this.reactCellMouseEnterBind),Kekule.X.Event.addListener(n,"mouseleave",this.reactCellMouseLeaveBind),Kekule.X.Event.addListener(n,"click",this.reactCellClickBind);var a=i.createElement("div");if(a.className=s.WIDGET_GRID_WIDGET_PARENT+" "+s.DYN_CREATED,a[this.WIDGET_FIELD]=e,t&&(a.innerHTML=Kekule.$L("WidgetTexts.CAPTION_ADD_CELL"),a.title=Kekule.$L("WidgetTexts.HINT_ADD_CELL")),n.appendChild(a),e&&(e.appendToElem(a),e[this.CELL_FIELD]=n),!t){var r=i.createElement("div");r.className=s.WIDGET_GRID_INTERACTION_AREA+" "+s.DYN_CREATED,n.appendChild(r),a[this.INTERACTION_AREA_FIELD]=r,n[this.INTERACTION_AREA_FIELD]=r,this.createCellInteractionWidgets(r,n)}return this.getAddingCell()&&!t?this.getContainerElement().insertBefore(n,this.getAddingCell()):this.getContainerElement().insertBefore(n,this.getFloatClearer()),this.updateCell(n),n},createAddCell:function(){return this.createCell(null)},createCellInteractionWidgets:function(e,t){var i=new Kekule.Widget.Button(e.ownerDocument);i.setText(Kekule.$L("WidgetTexts.CAPTION_REMOVE_CELL")),i.setHint(Kekule.$L("WidgetTexts.HINT_REMOVE_CELL")),i.addClassName(s.WIDGET_GRID_BUTTON_REMOVE),i[this.BTN_REMOVE_CELL_FIELD]=!0;var n=this.getContainingWidget(t);i[this.WIDGET_FIELD]=n,i.setShowText(!1),i.setShowGlyph(!0),i.addEventListener("execute",function(e){var t=e.widget[this.WIDGET_FIELD];this.removeWidget(t,!0)},this),i.appendToElem(e)},getWidgetCell:function(e){return e[this.CELL_FIELD]},getWidgetParentElem:function(e){var t=e.getElement();return t&&t.parentNode},getWidgetParentElemOfCell:function(e){return e.children[0]},getInteractionAreaElemOfCell:function(e){return e[this.INTERACTION_AREA_FIELD]},getContainingWidget:function(e){return e[this.WIDGET_FIELD]},childWidgetAdded:function($super,e){$super(e),this.createCell(e)},childWidgetRemoved:function($super,e){$super(e);var t=this.getWidgetCell(e);this.getContainerElement().removeChild(t)},childWidgetMoved:function($super,e,t){$super(e,t);var i=this.getWidgetCell(e),n=this.getChildWidgets()[t+1],s=n?this.getWidgetCell(n):null;s?this.getContainerElement().insertBefore(i,s):this.getContainerElement().appendChild(i)},childrenModified:function($super){this.getContainerElement().appendChild(this.getFloatClearer())},getAllCells:function(){for(var e=this.getChildWidgets(),t=[],i=0,n=e.length;i<n;++i)t.push(this.getWidgetCell(e[i]));return this.getAddingCell()&&t.push(this.getAddingCell()),t},updateCell:function(e,i){var a=e.style,r=this.getCellWidth(),o=this.getCellHeight();r?a.width=r:t.removeStyleProperty(a,"width"),o?a.height=o:t.removeStyleProperty(a,"height"),this.getUseCornerDecoration()?n.addClass(e,s.CORNER_ALL):n.removeClass(e,s.CORNER_ALL),this.adjustCellWidgetPos(e,i),this.adjustInteractionArea(e,i)},adjustCellWidgetPos:function(e,i){for(var s=this.getWidgetParentElemOfCell(e),a=n.getElemOffsetDimension(s),r=n.getElemClientDimension(e),o=["top","right","bottom","left"],l={},u=0,d=o.length;u<d;++u){var h=t.getComputedStyle(e,"padding-"+o[u]);l[o[u]]=t.analysisUnitsValue(h).value||0}var g=Object.extend({},r);g.width-=l.left+l.right,g.height-=l.top+l.bottom;var c=this.getWidgetPos(),p=Kekule.Widget.Position,E=c&p.LEFT?l.left:c&p.RIGHT?r.width-a.width-l.right:(g.width-a.width)/2+l.left,f=c&p.TOP?l.top:c&p.BOTTOM?r.height-a.height-l.bottom:(g.height-a.height)/2+l.top;s.style.left=E+"px",s.style.top=f+"px";var T=this.getInteractionAreaElemOfCell(e);if(T){var C=n.getElemClientDimension(T),m=E+a.width+C.width>=r.width&&f<=C.height;e[this.EXCEED_TOPRIGHT_FIELD]=m}if(this.getAutoShrinkWidgets()&&!i||!this.getRestoreWidgetSizeOnHotTrack()){var v=a.width>g.width?g.width/a.width:null,P=a.height>g.height?g.height/a.height:1;if(this.getKeepWidgetAspectRatio()){var _=v&&P?Math.min(v,P):v||P;v=_,P=_}s.style.transform="scale("+v+", "+P+")";var y=c&p.LEFT?"0":c&p.RIGHT?"100%":"50%",S=c&p.TOP?"0":c&p.BOTTOM?"100%":"50%";s.style.transformOrigin=y+" "+S}else s.style.transform="none"},adjustInteractionArea:function(e,t){var i=this.getInteractionAreaElemOfCell(e);i&&(t?e[this.EXCEED_TOPRIGHT_FIELD]&&this.getWidgetParentElemOfCell(e).appendChild(i):e.appendChild(i))},updateAllCells:function(){for(var e=this.getAllCells(),t=0,i=e.length;t<i;++t)this.updateCell(e[t],e[t]===this.getHotCell())},restoreCellShrink:function(e){var t=this.getWidgetParentElemOfCell(e);t&&(t.style.transform="none")},hotCellChanged:function(e,t){e&&(this.updateCell(e,!1),n.removeClass(e,s.STATE_HOVER)),t&&(n.addClass(t,s.STATE_HOVER),this.getRestoreWidgetSizeOnHotTrack()&&(this.restoreCellShrink(t),this.adjustInteractionArea(t,!0)))},reactCellMouseEnter:function(e){var t=e.getTarget();this.setHotCell(t)},reactCellMouseLeave:function(e){var t=e.getTarget();this.getHotCell()===t&&this.setHotCell(null)},reactCellClick:function(e){var t=e.getTarget();(i.isDescendantOf(t,this.getAddingCell())||t===this.getAddingCell())&&this.createWidget()},reactChildWidgetChange:function(e){var t=e.widget;t&&this.hasChild(t)&&this.updateCell(this.getWidgetCell(t),this.getHotCell()===this.getWidgetCell(t))}})}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,i=Kekule.StyleUtils,n=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{PROPLISTEDITOR:"K-PropListEditor",PROPLISTEDITOR_PROPEXPANDMARKER:"K-PropListEditor-PropExpandMarker",PROPLISTEDITOR_PROPEXPANDED:"K-PropListEditor-PropExpanded",PROPLISTEDITOR_PROPCOLLAPSED:"K-PropListEditor-PropCollapsed",PROPLISTEDITOR_INDENTDECORATOR:"K-PropListEditor-IndentDecorator",PROPLISTEDITOR_READONLY:"K-PropListEditor-ReadOnly",OBJINSPECTOR:"K-ObjInspector",OBJINSPECTOR_SUBPART:"K-ObjInspector-SubPart",OBJINSPECTOR_OBJSINFOPANEL:"K-ObjInspector-ObjsInfoPanel",OBJINSPECTOR_PROPINFOPANEL:"K-ObjInspector-PropInfoPanel",OBJINSPECTOR_PROPINFO_TITLE:"K-ObjInspector-PropInfoPanel-Title",OBJINSPECTOR_PROPINFO_DESCRIPTION:"K-ObjInspector-PropInfoPanel-Description",OBJINSPECTOR_PROPLISTEDITOR_CONTAINER:"K-ObjInspector-PropListEditorContainer"}),Kekule.Widget.ObjPropListEditor=Class.create(Kekule.Widget.ValueListEditor,{CLASS_NAME:"Kekule.Widget.ObjPropListEditor",PARENT_ROW_FIELD:"__$parentRow__",SUB_ROWS_FIELD:"__$subRows__",initialize:function($super,e){$super(e),this.setValueDisplayMode(Kekule.Widget.ValueListEditor.ValueDisplayMode.SIMPLE),this.setPropStoreFieldValue("displayedPropScopes",[Class.PropertyScope.PUBLISHED]),this.setEnableLiveUpdate(!0),this.setSubPropNamePadding("1em"),this.setUseKeyHint(!0)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=Kekule.ArrayUtils.toArray(e),i=this.getObjects();this.setPropStoreFieldValue("objects",t),this.inspectedObjectsChanged(t,i)}}),this.defineProp("displayedPropScopes",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("displayedPropScopes",e),this.updateAll()}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("subPropNamePadding",{dataType:DataType.STRING}),this.defineProp("activePropEditor",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getActiveRow();return e?this.getRowPropEditor(e):null}}),this.defineProp("keyField",{dataType:DataType.STRING}),this.defineProp("sortField",{dataType:DataType.STRING}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,scope:Class.PropertyScope.PUBLIC})},doFinalize:function($super){$super()},initPropValues:function($super){$super(),this.setKeyField("title"),this.setSortField("key")},doGetWidgetClassName:function($super){return $super()+" "+n.PROPLISTEDITOR},inspectedObjectsChanged:function(e,t){var i=Kekule.ArrayUtils.toArray(e);t&&this._uninstallObjectsEventHandlers(t),e&&this._installObjectsEventHandlers(i),this.updateAll(i)},_installObjectsEventHandlers:function(e){for(var t=0,i=e.length;t<i;++t){var n=e[t];n.addEventListener&&n.addEventListener("change",this.reactObjectsChange,this)}},_uninstallObjectsEventHandlers:function(e){for(var t=0,i=e.length;t<i;++t){var n=e[t];n.removeEventListener&&n.removeEventListener("change",this.reactObjectsChange,this)}},reactObjectsChange:function(e){if(this.getEnableLiveUpdate()){var t=e.changedPropNames;this.updateValues(t)}},getKeyCellExpandMarker:function(i,s){var a=null,r=this.getCellContentWrapper(i,s);if(r){for(var o=e.getDirectChildElems(r)||[],l=0,u=o.length;l<u;++l){var d=o[l];if(t.hasClass(d,n.PROPLISTEDITOR_PROPEXPANDMARKER)){a=d;break}}if(!a&&s){a=this.getDocument().createElement("span"),t.addClass(a,n.PROPLISTEDITOR_PROPEXPANDMARKER);var h=e.getChildNodesOfTypes(r,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];r.insertBefore(a,h)}}return a},getKeyCellIndentDecorator:function(i,s){var a=null,r=this.getCellContentWrapper(i,s);if(r){for(var o=e.getDirectChildElems(r)||[],l=0,u=o.length;l<u;++l){var d=o[l];if(t.hasClass(d,n.PROPLISTEDITOR_INDENTDECORATOR)){a=d;break}}if(!a&&s){a=this.getDocument().createElement("div"),t.addClass(a,n.PROPLISTEDITOR_INDENTDECORATOR);var h=e.getChildNodesOfTypes(r,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];r.insertBefore(a,h)}}return a},setRowKeyCellContent:function($super,e,t,i){var n=$super(e,t,i),s=this.getKeyCell(e),a=(this.getKeyCellExpandMarker(s,!0),this.getRowSubLevel(e)),r=this.getSubPropNamePadding();if(r){Kekule.StyleUtils.multiplyUnitsValue(r,a);r=Kekule.StyleUtils.multiplyUnitsValue(r,a);var o=this.getKeyCell(e);this.getCellContentWrapper(o,!0).style.paddingLeft=r}return n},updateAll:function(e){if(e||(e=this.getObjects()),e&&e.length){this.setActiveRow(null),this.collapseAllRows();e[0];var t=this.getDisplayPropEditors(e);this.sortPropEditors(t);e.length;var i=this.getRows(),n=i.length,s=t.length,a=0,r=0,o=this.getValueDisplayMode();for(a=0;a<s;++a){var l=t[a];if(l.setValueTextMode(o),this.isPropEditorVisible(l)){var u=r<n?i[r]:this.appendRow();this.setRowPropEditor(u,l),++r}}if(n>r)for(a=n-1;a>=r;--a)this.removeRow(i[a]);return this}this.clear()},updateValues:function(e){for(var t=e&&e.length,i=this.getRows(),n=0,s=i.length;n<s;++n){var a=i[n];if(t){var r=this.getRowPropEditor(a);if(!r||e.indexOf(r.getPropertyName())<0)continue}this.updateRowPropValue(a)}},updateRowPropValue:function(e){var t=this.getRowPropEditor(e).getValueText(),i=this.getRowData(e);i.value=t,this.setRowData(e,i),this.updateRowExpandState(e);var n=this.getSubPropRows(e);if(n)for(var s=0,a=n.length;s<a;++s)this.updateRowPropValue(n[s])},setRowPropEditor:function(e,i){var s,a=this.getKeyField()||"title";if(a)if("name"===a)s=i.getPropertyName();else if("title"===a)s=i.getTitle();else{s=i.getPropertyInfo()[a]}s||(s=i.getTitle()||i.getPropertyName());var r={key:i.getPropertyName(),value:i.getValueText(),title:s,hint:i.getHint(),propEditor:i,expanded:!1};i.isReadOnly()?t.addClass(e,n.PROPLISTEDITOR_READONLY):t.removeClass(e,n.PROPLISTEDITOR_READONLY),this.setRowData(e,r),this.updateRowExpandState(e)},getRowCascadeKey:function(e){if(e&&this.getRowData(e)){var t=this.getRowData(e).key,i=this.getParentPropRow(e);return i&&(t=this.getRowCascadeKey(i)+"."+t),t}return null},getActiveRowCascadeKey:function(){var e=this.getActiveRow();return e&&this.getRowCascadeKey(e)},getRowPropEditor:function(e){var t=this.getRowData(e);return t?t.propEditor:null},getPropEditor:function(e,t){var i=Kekule.PropertyEditor.findEditorClass(e,t);return i?new i:null},getPropEditorForType:function(e,t){var i=Kekule.PropertyEditor.findEditorClassForType(e,t);return i?new i:null},isPropEditorVisible:function(e){var t=!0;if(t=!(e.getObjects().length>1)||e.getAttributes()&Kekule.PropertyEditor.EditorAttributes.MULTIOBJS){var i=e.getPropertyInfo();if(i){var n=i.scope||Class.PropertyScope.DEFAULT;if(n){var s=this.getDisplayedPropScopes();s&&(t=s.indexOf(n)>=0)}}}return t},isRowExpandable:function(e){var t=this.getRowPropEditor(e);return!!t&&t.hasSubPropertyEditors()},isRowExpanded:function(e){return!!this.getRowData(e).expanded},updateRowExpandState:function(e){var i=this.isRowExpandable(e);i||this.removeSubPropertyRows(e),t.removeClass(e,n.PROPLISTEDITOR_PROPCOLLAPSED),t.removeClass(e,n.PROPLISTEDITOR_PROPEXPANDED),i&&(this.isRowExpanded(e)?t.addClass(e,n.PROPLISTEDITOR_PROPEXPANDED):t.addClass(e,n.PROPLISTEDITOR_PROPCOLLAPSED))},expandRow:function(e){return this._doExpandRow(e),this},_doExpandRow:function(e){if(this.isRowExpandable(e)&&!this.isRowExpanded(e)){t.removeClass(e,n.PROPLISTEDITOR_PROPCOLLAPSED),t.addClass(e,n.PROPLISTEDITOR_PROPEXPANDED),this.getRowData(e).expanded=!0;var i=this.getRowPropEditor(e).getSubPropertyEditors(this.getDisplayedPropScopes());return e[this.SUB_ROWS_FIELD]=this.addSubPropertyRows(e,i),e[this.SUB_ROWS_FIELD]}return null},collapseRow:function(e){this.isRowExpandable(e)&&this.isRowExpanded(e)&&(t.removeClass(e,n.PROPLISTEDITOR_PROPEXPANDED),t.addClass(e,n.PROPLISTEDITOR_PROPCOLLAPSED),this.getRowData(e).expanded=!1,this.removeSubPropertyRows(e));return this},toggleRowExpandState:function(e){return this.isRowExpanded(e)?this.collapseRow(e):this.expandRow(e),this},collapseAllRows:function(){for(var e=this.getRows(),t=0,i=e.length;t<i;++t)this.collapseRow(e[t]);return this},expandAllRows:function(e){var t=this,i=function(e,n){for(var s=0,a=e.length;s<a;++s){var r=t._doExpandRow(e[s]);r&&n&&i(r,n)}},n=this.getRows();return i(n,e),this},addSubPropertyRows:function(e,t){var i=this.getNextRow(e),n=[];if(t&&t.length){this.sortPropEditors(t);for(var s=0,a=t.length;s<a;++s){var r=t[s];this.isPropEditorVisible(r)&&n.push(this.addSubPropRow(e,r,i))}}return n},addSubPropRow:function(e,t,i){var n=this.insertRowBefore(null,i);return n[this.PARENT_ROW_FIELD]=e,this.setRowPropEditor(n,t),n},removeSubPropertyRows:function(e){for(var t=this.getSubPropRows(e),i=t.length-1;i>=0;--i)this.removeSubPropertyRows(t[i]),this.removeRow(t[i]);e[this.SUB_ROWS_FIELD]=null},getSubPropRows:function(e){return e[this.SUB_ROWS_FIELD]||[]},getParentPropRow:function(e){return e[this.PARENT_ROW_FIELD]},getRowSubLevel:function(e){for(var t=0,i=this.getParentPropRow(e);i;)++t,i=this.getParentPropRow(i);return t},getValueCellText:function($super,e,t){return t.value},finishEditing:function(){var e=this.getActiveRow(),t=this.getRowPropEditor(e);if(t){var i=this.getOperHistory(),n=this.getEnableOperHistory()&&i,s=t.getValue();if(t.saveEditValue()){if(n){var a=new Kekule.Widget.PropEditorModifyOperation(t,t.getValue(),s);i.push(a)}this.updateValues(),this.invokeEvent("propertyChange",{propertyEditor:t,propertyInfo:t.getPropertyInfo(),oldValue:s,newValue:t.getValue()}),this.invokeEvent("editFinish",{row:e})}}return this},doCreateValueEditWidget:function($super,e){var t=this.getRowPropEditor(e),i=t.createEditWidget(this);return i?t.isReadOnly()&&i.setReadOnly&&i.setReadOnly(!0):i=this.doCreateDefaultValueEditWidget(e),i},doCreateDefaultValueEditWidget:function(e){var t=new Kekule.Widget.TextBox(this);t.setReadOnly(!0);var i=this.getRowData(e).value;return t.setValue(i),t},isOperHistoryAvailable:function(){return this.getOperHistory()&&this.getEnableOperHistory()},undo:function(){return this.isOperHistoryAvailable()&&this.getOperHistory().undo(),this},redo:function(){return this.isOperHistoryAvailable()&&this.getOperHistory().redo(),this},getCommonSuperClass:function(e){return ClassEx.getCommonSuperClass(e)},getCommonPropNames:function(e){var t=[],i=this.getCommonSuperClass(e);if(i)for(var n=ClassEx.getPropListOfScopes(i,this.getDisplayedPropScopes()),s=0,a=n.getLength();s<a;++s){var r=n.getPropInfoAt(s);t.push(r.name)}return t},getDisplayPropNames:function(e){return this.getCommonPropNames(e)},getDisplayPropEditors:function(e){var t=[],i=this.getCommonSuperClass(e);if(i)(n=this.getPropEditor(null,{dataType:ClassEx.getClassName(i)}))&&(n.setObjects(e),t=t.concat(n.getSubPropertyEditors(this.getDisplayedPropScopes())||[]));else if(1===e.length){var n,s=e[0];if(DataType.isObjectValue(s))(n=this.getPropEditorForType("object"))&&(n.setObjects(s),t=t.concat(n.getSubPropertyEditors()||[]))}return t},sortPropEditors:function(e){var t=this.getSortField();if(t){"key"===t&&this.getKeyField();var i=function(e,t){return e[t]||e.name};e.sort(function(e,n){var s=i(e.getPropertyInfo(),t),a=i(n.getPropertyInfo(),t);return s<a?-1:s>a?1:0})}},getObjPropValue:function(e,t){return e instanceof ObjectEx?e.getPropValue(t):e instanceof Object?e[t]:void 0},getObjsPropValue:function(e,t){for(var i=e[0],n=this.getObjPropValue(i,t),s=1,a=e.length;s<a;++s){i=e[s];if(this.getObjPropValue(i,t)!==n)return}return n},react_click:function($super,e){var t=e.getTarget(),i=this.getParentRow(t);i&&(t===this.getKeyCellExpandMarker(this.getKeyCell(i),!1)&&this.toggleRowExpandState(i));$super(e)},react_dblclick:function(e){var t=e.getTarget(),i=this.getParentCell(t);if(i){var n=this.getParentRow(i);i===this.getKeyCell(n)&&(this.toggleRowExpandState(n),!0)}},react_keydown:function($super,e){$super(e);var t=e.getKeyCode();if(!(e.getAltKey()||e.getShiftKey()||e.getCtrlKey())){var i=this.getActiveRow();i&&(t===Kekule.X.Event.KeyCode.RIGHT?this.expandRow(i):t===Kekule.X.Event.KeyCode.LEFT&&this.collapseRow(i))}}}),Kekule.Widget.ObjectInspector=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ObjectInspector",initialize:function($super,e){this._propListElem=null,this._objsInfoElem=null,this._propInfoElem=null,this.setPropStoreFieldValue("showObjsInfoPanel",!0),this.setPropStoreFieldValue("showPropInfoPanel",!0),$super(e)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=Kekule.ArrayUtils.toArray(e);this.setPropStoreFieldValue("objects",t),this.inspectedObjectsChanged(t)}}),this.defineProp("propEditor",{dataType:"Kekule.Widget.ObjPropListEditor",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showObjsInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showObjsInfoPanel",e),i.setDisplay(this._objsInfoElem,!!e),this._updateChildElemSize()}}),this.defineProp("showPropInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showPropInfoPanel",e),i.setDisplay(this._propInfoElem,!!e),this._updateChildElemSize()}}),this.defineProp("keyField",{dataType:DataType.STRING,getter:function(){var e=this.getPropEditor();return e&&e.getKeyField()},setter:function(e){var t=this.getPropEditor();t&&t.setKeyField(e)}}),this.defineProp("sortField",{dataType:DataType.STRING,getter:function(){var e=this.getPropEditor();return e&&e.getSortField()},setter:function(e){var t=this.getPropEditor();t&&t.setSortField(e)}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e&&e.getActiveRow()},setter:function(e){var t=this.getPropEditor();t&&t.setActiveRow(e)}}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropEditor();return!!e&&e.getEnableOperHistory()},setter:function(e){var t=this.getPropEditor();return t?t.setEnableOperHistory(e):null}}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e?e.getOperHistory():null},setter:function(e){var t=this.getPropEditor();return t?t.setOperHistory(e):null}})},doFinalize:function($super){this._finalizeChildWidgets(),$super()},getChildrenHolderElement:function($super){return this._propListElem||$super()},doGetWidgetClassName:function(){return n.OBJINSPECTOR},doBindElement:function($super,e){$super(e),this._updateChildElemSize()},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function($super,e,i){$super(e,i);var s=this._createSubPartElem(e);t.addClass(s,n.OBJINSPECTOR_OBJSINFOPANEL),i.appendChild(s),this._objsInfoElem=s;var a=this._createSubPartElem(e);t.addClass(a,n.OBJINSPECTOR_PROPINFOPANEL),i.appendChild(a),this._propInfoElem=a;var r=this._createSubPartElem(e);return t.addClass(r,n.OBJINSPECTOR_PROPLISTEDITOR_CONTAINER),i.appendChild(r),this._propListElem=r,this._createChildWidgets(r),[s,a,r]},_createSubPartElem:function(e){var t=e.createElement("div");return t.className=n.OBJINSPECTOR_SUBPART,t},_createChildWidgets:function(e){this._finalizeChildWidgets();var t=new Kekule.Widget.ObjPropListEditor(this);t.appendToWidget(this);var i=this;t.addEventListener("activeRowChange",function(e){i._updatePropInfo()}),this.setPropStoreFieldValue("propEditor",t)},_finalizeChildWidgets:function(){var e=this.getPropEditor();e&&e.finalize()},inspectedObjectsChanged:function(e){var t=this.getPropEditor();t&&t.setObjects(e),this._updateObjectsInfo(e),this._updatePropInfo()},_updateObjectsInfo:function(t){if(this._objsInfoElem){var i;if(t.length<=0)i=Kekule.$L("WidgetTexts.S_INSPECT_NONE");else if(1===t.length){var n=t[0],s=n.getId?n.getId():null,a=DataType.getType(n);i=s?Kekule.$L("WidgetTexts.S_INSPECT_ID_OBJECT").format(s,a):Kekule.$L("WidgetTexts.S_INSPECT_ANONYMOUS_OBJECT").format(a)}else i=Kekule.$L("WidgetTexts.S_INSPECT_OBJECTS").format(t.length);e.setElementText(this._objsInfoElem,i)}},_updatePropInfo:function(){if(this._propInfoElem){this._propInfoElem.innerHTML="";var t=this.getPropEditor().getActivePropEditor();if(t){var i,s=t.getTitle(),a=t.getDescription()||t.getPropertyType()||"",r=this._propInfoElem.ownerDocument;(i=r.createElement("div")).className=n.OBJINSPECTOR_PROPINFO_TITLE,e.setElementText(i,s),this._propInfoElem.appendChild(i),(i=r.createElement("div")).className=n.OBJINSPECTOR_PROPINFO_DESCRIPTION,e.setElementText(i,a),this._propInfoElem.appendChild(i)}}},undo:function(){return this.getPropEditor()&&this.getPropEditor().undo(),this},redo:function(){return this.getPropEditor()&&this.getPropEditor().redo(),this},getRowCascadeKey:function(e){var t=this.getPropEditor();return t&&t.getRowCascadeKey(e)},getActiveRowCascadeKey:function(){var e=this.getPropEditor();return e&&e.getActiveRowCascadeKey()},isRowExpandable:function(e){var t=this.getPropEditor();return t&&t.isRowExpandable(e)},isRowExpanded:function(e){var t=this.getPropEditor();return t&&t.isRowExpanded(e)},expandRow:function(e){var t=this.getPropEditor();return t&&t.expandRow(e),this},collapseRow:function(e){var t=this.getPropEditor();return t&&t.collapseRow(e),this},toggleRowExpandState:function(e){var t=this.getPropEditor();return t&&t.toggleRowExpandState(e),this},collapseAllRows:function(){var e=this.getPropEditor();return e&&e.collapseAllRows(),this},expandAllRows:function(e){var t=this.getPropEditor();return t&&t.expandAllRows(e),this},_updateChildElemSize:function(){var e=this;setTimeout(function(){var t,n;t=e.getShowObjsInfoPanel()?i.getComputedStyle(e._objsInfoElem,"height"):0,n=e.getShowPropInfoPanel()?i.getComputedStyle(e._propInfoElem,"height"):0,e._propListElem.style.top=t,e._propListElem.style.bottom=n},100)},setUseCornerDecoration:function($super,e){return $super(e)}})}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.Widget.PropertyEditor={},Kekule.PropertyEditor=Kekule.Widget.PropertyEditor,Kekule.PropertyEditor.BaseEditor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PropertyEditor.BaseEditor",initialize:function($super){$super(),this._editWidget=null},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=Kekule.ArrayUtils;this.setPropStoreFieldValue("objects",t.clone(t.toArray(e)))}}),this.defineProp("propertyInfo",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("propertyName",{dataType:DataType.VARIANT,serializable:!1,setter:null,getter:function(){var e=this.getPropertyInfo();return e?e.name:null}}),this.defineProp("propertyType",{dataType:DataType.VARIANT,serializable:!1,setter:null,getter:function(){var e=this.getPropertyInfo();return e?e.dataType:null}}),this.defineProp("parentEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:!1}),this.defineProp("valueTextMode",{dataType:DataType.INT}),this.defineProp("readOnly",{dataType:DataType.BOOL}),this.defineProp("allowEmpty",{dataType:DataType.BOOL})},finalize:function($super){this.finalizeWidget(),$super()},finalizeWidget:function(){this._editWidget&&(this._editWidget.finalize(),this._editWidget=null)},getEditWidget:function(){return this._editWidget},getObjPropValue:function(e,t){return Kekule.ObjUtils.isUnset(t)?e:e instanceof ObjectEx?e.getPropValue(t):DataType.isArrayValue(e)?e[t]:e instanceof Object?e[t]:void 0},setObjPropValue:function(e,t,i){return e instanceof ObjectEx?e.setPropValue(t,i):e instanceof Object&&(e[t]=i),this},getObjsPropValue:function(e,t){if(e){if(Kekule.ObjUtils.isUnset(t))return e;for(var i=e[0],n=this.getObjPropValue(i,t),s=1,a=e.length;s<a;++s){i=e[s];if(this.getObjPropValue(i,t)!==n)return}return n}},setObjsPropValue:function(e,t,i){if(!e||!t)return this;for(var n=0,s=e.length;n<s;++n){var a=e[n];this.setObjPropValue(a,t,i)}return this},isReadOnly:function(){return!!(this.getAttributes()&t.READONLY)},hasSubPropertyEditors:function(){return!!(this.getAttributes()&t.SUBPROPS)},getAttributes:function(){var e=t.MULTIOBJS|t.SIMPLEVALUE,i=this.getPropertyInfo();return Kekule.ObjUtils.isUnset(this.getReadOnly())?i&&!i.setter&&(e|=t.READONLY):this.getReadOnly()&&(e|=t.READONLY),e},getSubPropertyEditors:function(e){return null},getTitle:function(){var e=this.getPropertyInfo();return e?e.title||e.name:""},getHint:function(){return this.getTitle()},getDescription:function(){return this.getPropertyInfo().description},getValue:function(){return this.getObjsPropValue(this.getObjects(),this.getPropertyName())},getValueText:function(){var e=Kekule.Widget.ValueListEditor.ValueDisplayMode,t=this.getValue(),i=this.getValueTextMode();try{var n=i===e.JSON?JSON.stringify(t):Kekule.ObjUtils.isUnset(t)?"":""+t}catch(e){return""+t}return n},setValue:function(e){var t=this.setObjsPropValue(this.getObjects(),this.getPropertyName(),e);return this.getParentEditor()&&this.getParentEditor().notifyChildEditorValueChange&&this.getParentEditor().notifyChildEditorValueChange(this.getPropertyName(),e),t},createEditWidget:function(e){var t=this.getValue(),i=this.doCreateEditWidget(e,t);return i&&i.setIsDirty&&i.setIsDirty(!1),this._editWidget=i,i},doCreateEditWidget:function(e){},saveEditValue:function(){if(this._editWidget){if(!this._editWidget.getIsDirty||this._editWidget.getIsDirty()){var e=this.doSaveEditValue();return this._editWidget.setIsDirty&&this._editWidget.setIsDirty(!1),e}return!1}return!1},doSaveEditValue:function(){},notifyChildEditorValueChange:function(e,t){}}),Kekule.PropertyEditor.EditorAttributes={MULTIOBJS:1,SUBPROPS:2,SIMPLEVALUE:4,VALUELIST:8,CUSTOMEDIT:16,READONLY:32,INLINE_EDIT:128,DROP_EDIT:256,POPUP_EDIT:512};var t=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.EditorMananger=Class.create({initialize:function(){this._registeredItems=[],this._defaultItems=[]},register:function(e,t,i,n,s){var a={editorClass:e,propType:t,objClass:i,propName:n,matchFunc:s};return this._registeredItems.push(a),t||i||n||s||this._defaultItems.push(a),this},unregister:function(e){for(var t=(i=this._registeredItems).length-1;t>=0;--t){i[t].editorClass===e&&i.splice(t,1)}var i;for(t=(i=this._defaultItems).length-1;t>=0;--t){i[t].editorClass===e&&i.splice(t,1)}return this},_getDefaultItem:function(){var e=this._defaultItems;return e[e.length-1]},_getSuperiorItem:function(e,t){for(var i=["matchFunc","propName","objClass","propType"],n=0,s=i.length;n<s;++n)if(!!e[i]!=!!t[i])return e[i]?e:t;return e},_isMatchedPropType:function(e,t){var i=e===t;if(!i&&DataType.isObjectExType(e)&&DataType.isObjectExType(t)){var n=ClassEx.findClass(e),s=ClassEx.findClass(t);i=ClassEx.isOrIsDescendantOf(n,s)}return i},_testOnPropType:function(e,t){return e.propType&&t.dataType?this._isMatchedPropType(t.dataType,e.propType)?1:-1:0},_testOnObjClass:function(e,t){return e.objClass&&t?ClassEx.isOrIsDescendantOf(t,e.objClass)?1:-1:0},_testOnPropName:function(e,t){return e.propName&&t.name?e.propName===t.name?1:-1:0},_testOnMatchFunc:function(e,t,i){return e.matchFunc?e.matchFunc(t,i)?1:-1:0},findEditorClass:function(e,t){for(var i=null,n=this._registeredItems,s=n.length-1;s>=0;--s){var a=n[s],r=this._testOnPropType(a,t);if(!(r<0)){var o=this._testOnObjClass(a,e);if(!(o<0)){var l=this._testOnPropName(a,t);if(!(l<0)){var u=this._testOnMatchFunc(a,e,t);if(!(u<0)&&r+o+l+u>0&&(i=i?this._getSuperiorItem(i,a.editorClass):a.editorClass)&&a.matchFunc)break}}}}i||(i=(a=this._getDefaultItem())?a.editorClass:null);return i},findEditorClassForType:function(e,t){var i={dataType:e,name:t};return this.findEditorClass(null,i)}}),Kekule.ClassUtils.makeSingleton(Kekule.PropertyEditor.EditorMananger),Kekule.PropertyEditor.findEditorClass=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClass.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.findEditorClassForType=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClassForType.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.register=Kekule.PropertyEditor.EditorMananger.getInstance().register.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.unregister=Kekule.PropertyEditor.EditorMananger.getInstance().unregister.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.SimpleEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SimpleEditor",convertStrToValue:function(e,t){return DataType.isSimpleType(t)?!e&&this.getAllowEmpty()?null:Kekule.StrUtils.convertToType(e,t):e},setValueText:function(e){if(e===this._originValueText)return!1;var t,i=this.getPropertyType();return!(i&&!DataType.isSimpleType(i))&&(t=i?this.convertStrToValue(e,i):e,this.setValue(t),!0)},doCreateEditWidget:function(e){var t=this.getValueText();return this._originValueText=t,new Kekule.Widget.TextBox(e,t)},doSaveEditValue:function(){return this.setValueText(this.getEditWidget().getValue())}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.SimpleEditor),Kekule.PropertyEditor.TextEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.TextEditor",LINE_BREAK_REPLACER:"\\n",textToSingleLine:function(e){return e.split("\n").join(this.LINE_BREAK_REPLACER)},textToMultiLine:function(e){return e.split(this.LINE_BREAK_REPLACER).join("\n")},doCreateEditWidget:function(e){this._parentWidget=e;var t=this.getValueText();this._originValueText=t;var i=new Kekule.Widget.ButtonTextBox(e,this.textToSingleLine(t));return this._textbox=i,i.setButtonKind(Kekule.Widget.Button.Kinds.POPUP),i.addEventListener("buttonExecute",this.reactButtonExecute,this),i},reactButtonExecute:function(e){this.openPopupEditor()},openPopupEditor:function(){var e=this._popupDialog;e||(e=this.createPopupDialog(),this._popupDialog=e);var t=this._popupEditor;t.setValue(this.getValueText());var i=this;e.openPopup(function(e){e===Kekule.Widget.DialogButtons.OK&&(i._textbox.setValue(i.textToSingleLine(t.getValue())),i._textbox.setIsDirty(!0),i.saveEditValue())},this._textbox)},createPopupDialog:function(){var e=this._parentWidget.getDocument(),t=new Kekule.Widget.Dialog(e,this.getPropertyName(),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);t.setLocation(Kekule.Widget.Location.CENTER_OR_FULLFILL);var i=new(0,Kekule.Widget.TextArea)(e),n=i.getElement().style;return n.width="40em",n.height="20em",i.appendToWidget(t),this._popupEditor=i,t},doSaveEditValue:function(){var e=this.getEditWidget().getValue();return(e=this.textToMultiLine(e))!==this._originValueText&&(this.setValueText(e),!0)}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.TextEditor,DataType.STRING),Kekule.PropertyEditor.BoolEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.BoolEditor",boolToStr:function(e){return Kekule.StrUtils.boolToStr(e)},doCreateEditWidget:function(e){this._originValue=this.getValue();var t=new Kekule.Widget.CheckBox(e,this._originValue);t.setText(this.boolToStr(this._originValue));var i=this;return t.addEventListener("valueChange",function(e){var n=t.getChecked();t.setText(i.boolToStr(n))}),t},getValueText:function($super){var e=this.getValue();return Kekule.ObjUtils.isUnset(e)?Kekule.$L("WidgetTexts.S_VALUE_UNSET"):$super()},doSaveEditValue:function(){var e=this.getEditWidget().getChecked();return e!==this._originValue&&(this.setValue(e),!0)}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.BoolEditor,DataType.BOOL),Kekule.PropertyEditor.SelectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SelectEditor",getValueText:function($super){for(var e=this.getValue(),t=this.getSelectItems()||[],i=0,n=t.length;i<n;++i){var s=t[i];if(s.value===e)return s.text}return $super()},getSelectItems:function(){return[]},doCreateEditWidget:function(e){var t=new Kekule.Widget.SelectBox(e,this.getSelectItems());return this._originalValue=this.getValue(),t.setValue(this._originalValue),t},doSaveEditValue:function(){var e=this.getEditWidget().getValue();return e!==this._originalValue&&(this.setValue(e),!0)}}),Kekule.PropertyEditor.EnumEditor=Class.create(Kekule.PropertyEditor.SelectEditor,{CLASS_NAME:"Kekule.PropertyEditor.EnumEditor",initialize:function($super){$super(),this.enumInfos=[]},setPropertyInfo:function($super,e){if($super(e),e){var t=e.enumSource;if(t&&DataType.isObjectValue(t)){var i=Kekule.ObjUtils.getOwnedFieldNames(t);this.enumInfos=[];for(var n=0,s=i.length;n<s;++n)this.enumInfos.push({text:i[n],value:t[i[n]]})}}},getSelectItems:function(){var e=this.getValue();if(Kekule.ObjUtils.isUnset(e)){var t=Kekule.ArrayUtils.clone(this.enumInfos);return t.unshift({text:Kekule.$L("WidgetTexts.S_VALUE_UNSET"),value:e}),t}return this.enumInfos}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.EnumEditor,null,null,null,function(e,t){return!!t.enumSource}),Kekule.PropertyEditor.ObjectExEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectExEditor",getAttributes:function($super){var e=$super();return e|=t.SUBPROPS},hasSubPropertyEditors:function($super){return $super()&&this.getValue()},getSubPropertyEditors:function(e){var t=[],i=this.getValue();if(i){if(i instanceof ObjectEx)var n=i.getClass();else n=ClassEx.getCommonSuperClass(i);for(var s=ClassEx.getPropListOfScopes(n,e),a=0,r=s.getLength();a<r;++a){var o=s.getPropInfoAt(a),l=Kekule.PropertyEditor.findEditorClass(n,o);if(l){var u=new l;u.setObjects(Kekule.ArrayUtils.toArray(i)),u.setPropertyInfo(o),u.setValueTextMode(this.getValueTextMode()),t.push(u)}}}return t},getValueText:function($super){var e=this.getValue();return Kekule.ObjUtils.notUnset(e)?e.getClassName?"["+e.getClassName()+"]":$super():Kekule.$L("WidgetTexts.S_OBJECT_UNSET")}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectExEditor,"ObjectEx"),Kekule.PropertyEditor.ObjectFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectFieldEditor",initialize:function(){},doCreateEditWidget:function($super,e){if(!this.getPropertyType()){var t=this.getValue();this.getPropertyInfo().dataType=DataType.getType(t)}return $super(e)}}),Kekule.PropertyEditor.ObjectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectEditor",initialize:function($super){$super(),this._initialObjValue=void 0},getFieldEditorClass:function(e,t){return Kekule.PropertyEditor.findEditorClass(null,t)||Kekule.PropertyEditor.ObjectFieldEditor},getFieldValueType:function(e,t){var i=e[t];return Kekule.ObjUtils.notUnset(i)?DataType.getType(i):null},createFieldEditor:function(e,t){var i=new(this.getFieldEditorClass(e,t));return i.setParentEditor(this),i.setReadOnly(!1),i.setAllowEmpty(this.getAllowEmpty()),i.setPropertyInfo(t),i.setObjects(e),i.setValueTextMode(this.getValueTextMode()),i},getObjFields:function(e){return e?Kekule.ObjUtils.getOwnedFieldNames(e):[]},getObjFieldInfos:function(e){for(var t=this.getObjFields(e),i=[],n=0,s=t.length;n<s;++n){var a={name:t[n],dataType:this.getFieldValueType(e,t[n])};i.push(a)}return i},notifyChildEditorValueChange:function(e,t){var i=this.getValue()||this._initialObjValue;i[e]=t,this.setValue(i)},getAttributes:function($super){var e=$super();return e|=t.SUBPROPS},hasSubPropertyEditors:function($super){return $super()&&this.getObjFieldInfos(this.getValue()).length},getValueText:function($super){var e=Kekule.Widget.ValueListEditor.ValueDisplayMode;return this.getValueTextMode()===e.JSON?$super():this.getValue()?"["+Kekule.$L("WidgetTexts.S_OBJECT")+"]":""},setValue:function($super,e){var t=$super(e);return this._initialObjValue=e,t},getSubPropertyEditors:function(t){var i=[],n=e.toArray(this.getValue());if(n.length>1)return[];var s=n[0];this._initialObjValue=s||{};for(var a=this.getObjFieldInfos(s),r=[this._initialObjValue],o=0,l=a.length;o<l;++o){var u=this.createFieldEditor(r,a[o]);i.push(u)}return i}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectEditor,DataType.OBJECT),Kekule.PropertyEditor.ArrayEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ArrayEditor",getAttributes:function($super){var e=$super();return e|=t.SUBPROPS},hasSubPropertyEditors:function($super){var e=this.getValue();return $super()&&e&&e.length},getSubPropertyEditors:function(e){var t=[],i=this.getValue();if(DataType.isArrayValue(i)&&i.length)for(var n=this.getPropertyInfo().elementType,s=0,a=i.length;s<a;++s){var r=i[s],o=n||DataType.getType(r),l=Kekule.PropertyEditor.findEditorClassForType(o);if(l){var u=new l;u.setParentEditor(this),u.setObjects([i]);var d={name:s,title:s,dataType:o};u.setPropertyInfo(d),u.setValueTextMode(this.getValueTextMode()),t.push(u)}}return t},getValueText:function($super){var e=this.getValue();return DataType.isArrayValue(e)?"["+e.length+" "+Kekule.$L("WidgetTexts.S_ITEMS")+"]":$super()}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ArrayEditor,DataType.ARRAY),Kekule.PropertyEditor.ColorEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ColorEditor",doCreateEditWidget:function(e){this._parentWidget=e;var t=this.getValue();this._originValue=t;var i=new Kekule.Widget.ColorDropTextBox(e,t);return i.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET]),i.addEventListener("valueSet",function(e){this.saveEditValue()},this),this._textbox=i,i},doSaveEditValue:function(){var e=this.getEditWidget().getValue();return e===Kekule.Widget.ColorPicker.SpecialColors.UNSET?e=void 0:""===e&&(e=void 0),e!==this._originValue&&(this.setValue(e),!0)}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ColorEditor,DataType.STRING,null,null,function(e,t){var i=t.name;return i&&i.toLowerCase().indexOf("color")>=0})}(),function(){"use strict";Kekule.Widget.PropEditorModifyOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.Widget.PropEditorModifyOperation",initialize:function($super,e,t,i){$super(),this.setPropEditor(e),this.setNewValue(t),this.setOldValue(i)},initProperties:function(){this.defineProp("propEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:!1}),this.defineProp("newValue",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("oldValue",{dataType:DataType.VARIANT,serializable:!1})},doExecute:function(){var e=this.getPropEditor();void 0===this.getOldValue()&&this.setOldValue(e.getValue()),e.setValue(this.getNewValue())},doReverse:function(){this.getPropEditor().setValue(this.getOldValue())}})}(),function(){"use strict";Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_CONFIGURATOR:"K-Widget-Configurator",WIDGET_CONFIGURATOR_CLIENT:"K-Widget-Configurator-Client",ACTION_OPEN_CONFIGURATOR:"K-Action-Open-Configurator"});var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.Configurator=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.Widget.Configurator",TAB_BTN_DATA_FIELD:"__$data__",DEF_TAB_POSITION:Kekule.Widget.Position.RIGHT,initialize:function($super,e){this.setPropStoreFieldValue("widget",e),this._objInspector=null,this._tabGroup=null,$super(e)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("autoUpdate",{dataType:DataType.BOOL}),this.defineProp("tabPosition",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("tabPosition",e),this._tabGroup&&this._tabGroup.setTabButtonPosition(e||this.DEF_TAB_POSITION)}})},initPropValues:function($super){$super(),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},doGetWidgetClassName:function($super){return $super()+" "+e.WIDGET_CONFIGURATOR},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function($super,t,i){var n=[],s=t.createElement("div");s.className=e.WIDGET_CONFIGURATOR_CLIENT,n.push(s);var a=new Kekule.Widget.ObjectInspector(this);a.setShowObjsInfoPanel(!1),a.setSortField(null),a.appendToElem(s),this._objInspector=a,a.addEventListener("propertyChange",function(e){this.invokeEvent("configChange",{obj:a.getObjects()[0],propertyName:e.propertyInfo.name,oldValue:e.oldValue,newValue:e.newValue})},this);var r,o=this.getCategoryInfos(),l=new Kekule.Widget.TabButtonGroup(this);this._tabGroup=l,l.setTabButtonPosition(this.getTabPosition()||this.DEF_TAB_POSITION);for(var u=0,d=o.length;u<d;++u){var h=o[u],g=new Kekule.Widget.RadioButton(l);g.setText(h.title||h.name),g.setHint(h.description||""),g[this.TAB_BTN_DATA_FIELD]=h.obj,g.appendToWidget(l),0===u&&(r=g)}return l.addEventListener("execute",function(e){var t=e.widget;t instanceof Kekule.Widget.RadioButton&&this._switchToTab(t)},this),l.appendToElem(s),o.length<=1&&l.setDisplayed("none"),r.setChecked(!0),this._switchToTab(r),i.appendChild(s),n},doWidgetShowStateChanged:function($super,e){$super(e),this.getAutoUpdate()&&(e?this.loadConfigValues():this.saveConfigValues())},loadConfigValues:function(){},saveConfigValues:function(){},getCategoryInfos:function(){var e=this.getWidget(),t=[],i=e.getSettingFacade();if(i){var n=e.getPropInfo("settingFacade");t.push({obj:i,name:n.name,title:n.title,descrption:n.description})}return t},_switchToTab:function(e){var t=e[this.TAB_BTN_DATA_FIELD];this._objInspector.setObjects(t)}}),Kekule.Widget.ActionOpenConfigWidget=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Widget.ActionOpenConfigWidget",HTML_CLASSNAME:e.ACTION_OPEN_CONFIGURATOR,initialize:function($super,e){$super(),this.setWidget(e),this.setText(Kekule.$L("WidgetTexts.CAPTION_CONFIG")),this.setHint(Kekule.$L("WidgetTexts.HINT_CONFIG"))},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},doUpdate:function(){var e=this.getWidget();this.setEnabled(e&&e.getEnabled())},doExecute:function(e){this.getWidget().openConfigurator(e)}}),ClassEx.extend(Kekule.Widget.BaseWidget,{getSettingFacadeClass:function(){var e=this.getClass(),t=null;do{var i=ClassEx.getClassName(e)+".Settings";t=ClassEx.findClass(i),e=ClassEx.getSuperClass(e)}while(e&&!t);return t},getConfiguratorClass:function(){var e=this.getClass(),t=null;do{var i=ClassEx.getClassName(e)+".Configurator";t=ClassEx.findClass(i),e=ClassEx.getSuperClass(e)}while(e&&!t);return t},createConfigurator:function(){return new(this.getConfiguratorClass())(this)},getConfigurator:function(){return this._configurator||(this._configurator=this.createConfigurator()),this._configurator},openConfigurator:function(e){this.getConfigurator().show(e||this,null,Kekule.Widget.ShowHideType.DROPDOWN)}}),ClassEx.defineProp(Kekule.Widget.BaseWidget,"settingFacade",{dataType:DataType.OBJECTEX,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var e=this.getPropStoreFieldValue("settingFacade");if(!e){var t=this.getSettingFacadeClass();t&&(e=new t(this),this.setPropStoreFieldValue("settingFacade",e))}return e}}),Kekule.Widget.BaseWidget.Settings=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget.Settings",initialize:function($super,e){this._basedClass=null,$super(),this.setWidget(e)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PUBLIC})},getBasedClass:function(){if(!this.hasOwnProperty("_basedClass")||!this._basedClass){var e=this.getClassName(),t=e.split(".");t.pop(),e=t.join("."),this._basedClass=ClassEx.findClass(e)}return this._basedClass},defineDelegatedProp:function(e,t){t||(t=e);var i=ClassEx.getPropInfo(this.getBasedClass(),t),n=Object.create(i);n.setter=null,n.getter=null,i.getter&&(n.getter=function(){return this.getWidget().getPropValue(t)}),i.setter&&(n.setter=function(e){this.getWidget().setPropValue(t,e)}),this.defineProp(e,n)},defineDelegatedProps:function(e,t){t||(t=[]);for(var i=0,n=e.length;i<n;++i){var s=e[i],a=t[i]||s;this.defineDelegatedProp(s,a)}}})}(),function(){"use strict";Kekule.Widget.BaseDataSet=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseDataSet",PREFIX_SORT_DESC:"!",initProperties:function(){this.defineProp("enableCache",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableCache")&&this.getCacheAvailable()},setter:function(e){this.setPropStoreFieldValue("enableCache",e),e||this.clearCache()}}),this.defineProp("defaultTimeout",{dataType:DataType.INT}),this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(e){var t=e?Kekule.ArrayUtils.toArray(e):null;this.setPropStoreFieldValue("sortFields",t),this.sortFieldsChanged(t)}}),this.defineProp("cache",{dataType:DataType.ARRAY})},initPropValues:function($super){$super(),this.setEnableCache(!0),this.setCache([]),this.setDefaultTimeout(2e4)},finalize:function($super){this.clearCache(),this.setCache(null),$super()},dataChanged:function(){this.clearCache(),this.invokeEvent("dataChange")},sortFieldsChanged:function(e){this.clearCache(),this.doSortFieldsChanged(e)},doSortFieldsChanged:function(e){},getTotalCount:function(){return this.doGetTotalCount()||0},doGetTotalCount:function(){},totalCountChanged:function(e){this.invokeEvent("totalCountChange",{totalCount:e})},getFirstIndex:function(){return 0},getLastIndex:function(){return(this.getTotalCount()||0)-1},getCacheAvailable:function(){return!0},clearCache:function(){return this.getCache().length=0,this},saveCacheData:function(e,t){for(var i=this.getCache(),n=t,s=0;s<e.length;++s)i[n]=e[s]||null,++n},loadCacheData:function(e,t){if(this.getEnableCache()){var i=this.getCache();if(i.length<e+t)return null;for(var n=[],s=e,a=e+t;s<a;++s){var r=i[s];if(void 0===r)return null;n.push(r)}return n}return null},fetch:function(e){var t=Object.extend({fromIndex:0,count:0},e);if(t.timeout=t.timeout||this.getDefaultTimeout(),this.getEnableCache()){var i=this.loadCacheData(t.fromIndex,t.count);if(i)return void t.callback(i)}var n=this,s=!1;if(t.timeout>0)var a=setTimeout(function(){a&&clearTimeout(a),s=!0,t.timeoutCallback?t.timeoutCallback():e.errCallback&&e.errCallback(Kekule.$L("ErrorMsg.FETCH_DATA_TIMEOUT"))},t.timeout);t.callback=function(i){s||(a&&clearTimeout(a),e.callback&&e.callback(i),n.getEnableCache()&&n.saveCacheData(i,t.fromIndex))},t.errCallback=function(t){s||(a&&clearTimeout(a),e.errCallback&&e.errCallback(t))};this.doFetch(t.fromIndex,t.count,t.callback,t.errCallback)},doFetch:function(e,t,i,n){}}),Kekule.Widget.ArrayDataSet=Class.create(Kekule.Widget.BaseDataSet,{CLASS_NAME:"Kekule.Widget.ArrayDataSet",initialize:function($super,e){$super(),this.setData(e)},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("data",e);var t=this.getSortFields();t&&this.doSortFieldsChanged(t),this.dataChanged()}})},getCacheAvailable:function(){return!1},doSortFieldsChanged:function(e){var t=this.getData()||[];return Kekule.ArrayUtils.sortHashArray(t,e),this.dataChanged(),this},doGetTotalCount:function(){return(this.getData()||[]).length},doFetch:function(e,t,i,n){for(var s=[],a=this.getData()||[],r=e,o=Math.min(e+t,a.length);r<o;++r){var l=a[r];s.push(l)}i(s)}}),Kekule.Widget.DataPager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DataPager",initialize:function($super,e){$super(),this.setPropStoreFieldValue("pageSize",10),this.setDataSet(e)},initProperties:function(){this.defineProp("dataSet",{dataType:"Kekule.Widget.BaseDataSet",setter:function(e){var t=this.getDataSet();e!==t&&(this.setPropStoreFieldValue("dataSet",e),this.dataSetChange(t,e),this.switchToPage(this.getCurrPageIndex()||0))}}),this.defineProp("pageSize",{dataType:DataType.INT,setter:function(e){e!==this.getPageSize()&&(this.setPropStoreFieldValue("pageSize",e),this.pageCountChanged(this.getPageCount()),this.switchToPage(this.getCurrPageIndex()||0))}}),this.defineProp("currPageIndex",{dataType:DataType.INT}),this.defineProp("currPageData",{dataType:DataType.ARRAY}),this.defineProp("sortFields",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getDataSet()&&this.getDataSet().getSortFields()},setter:function(e){this.getDataSet()&&this.getDataSet().setSortFields(e)}})},initPropValues:function($super){$super(),this.setCurrPageIndex(0)},dataSetChange:function(e,t){e&&(e.RemoveEventListener("dataChange",this.reactDataSetDataChange,this),e.RemoveEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)),t&&(t.addEventListener("dataChange",this.reactDataSetDataChange,this),t.addEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)),this.pageCountChanged(this.getPageCount())},reactDataSetDataChange:function(e){this.dataChanged()},dataChanged:function(){this.pageCountChanged(this.getPageCount()),this.switchToPage(this.getCurrPageIndex()||0)},reactDataSetTotalCountChange:function(e){this.pageCountChanged(this.getPageCount())},getPageCount:function(){var e=this.getDataSet(),t=e&&e.getTotalCount()||0;return Math.ceil(t/this.getPageSize())},pageCountChanged:function(e){this.invokeEvent("pageCountChange",{pageCount:e})},fetchPageData:function(e){var t=this.getPageSize()*(Kekule.ObjUtils.isUnset(e.pageIndex)?this.getCurrPageIndex():e.pageIndex),i=this.getPageSize(),n=Object.create(e);return Object.extend(n,{fromIndex:t,count:i}),this.getDataSet().fetch(n),this},switchToPage:function(e,t){var i=this,n={pageIndex:e,timeout:t,callback:function(t){i.setCurrPageData(t),i.setCurrPageIndex(e),i.invokeEvent("dataFetched",{pageIndex:e,data:t})},errCallback:function(e){i.invokeEvent("dataError",{error:e}),Kekule.error(e)}};this.invokeEvent("pageRetrieve",{pageIndex:e}),this.fetchPageData(n)}})}(),function(){"use strict";var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,i=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DATAGRID:"K-DataGrid",DATATABLE:"K-DataTable",DATATABLE_ROW_ODD:"K-Odd",DATATABLE_ROW_EVEN:"K-Even",DATATABLE_CELL_WRAPPER:"K-DataTable-CellWrapper",DATATABLE_HEADCELL_INTERACTABLE:"K-DataTable-HeadCellInteractable",DATATABLE_OPER_COL:"K-DataTable-OperCol",DATATABLE_OPER_CELL:"K-DataTable-OperCell",DATATABLE_CHECK_COL:"K-DataTable-CheckCol",DATATABLE_CHECK_CELL:"K-DataTable-CheckCell",DATATABLE_DATA_COL:"K-DataTable-DataCol",DATATABLE_DATA_CELL:"K-DataTable-DataCell",DATATABLE_SORTMARK:"K-DataTable-SortMark",DATATABLE_SORTASC:"K-Sort-Asc",DATATABLE_SORTDESC:"K-Sort-Desc",DATATABLE_EDIT:"K-DataTable-Edit",DATATABLE_DELETE:"K-DataTable-Delete",DATATABLE_INSERT:"K-DataTable-Insert",PAGENAVIGATOR:"K-PageNavigator",PAGENAVIGATOR_FIRST:"K-PageNavigator-First",PAGENAVIGATOR_LAST:"K-PageNavigator-Last",PAGENAVIGATOR_PREV:"K-PageNavigator-Prev",PAGENAVIGATOR_NEXT:"K-PageNavigator-Next",PAGENAVIGATOR_PAGEINDEXER:"K-PageNavigator-PageIndexer",PAGENAVIGATOR_PAGEINPUT:"K-PageNavigator-PageInput",PAGENAVIGATOR_PAGESELECTOR:"K-PageNavigator-PageSelector"}),Kekule.Widget.DataTableColNames={OPER:"OPER",CHECK:"CHECK",ALL:"*"};var n=Kekule.Widget.DataTableColNames;Kekule.Widget.DataTable=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DataTable",BINDABLE_TAG_NAMES:["div","span"],PREFIX_SORT_DESC:"!",COLDEF_FIELD:"__$colDef__",ROWDATA_FIELD:"__$rowData__",ROW_OPER_TOOLBAR_FIELD:"__$rowOperToolbar__",ROW_CHECKBOX_FIELD:"__$rowCheckBox__",COLNAME_OPER:n.OPER,COLNAME_CHECK:n.CHECK,COLNAME_ALL:n.ALL,initialize:function($super,e){this._displayData=null,this.setPropStoreFieldValue("showTableHead",!0),$super(e)},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY}),this.defineProp("columns",{dataType:DataType.ARRAY}),this.defineProp("operColShowMode",{dataType:DataType.STRING}),this.defineProp("operWidgets",{dataType:DataType.ARRAY}),this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(e){var t=e?Kekule.ArrayUtils.toArray(e):null;this.setPropStoreFieldValue("sortFields",t),this.getDataPager()&&this.getDataPager().setSortFields(t)}}),this.defineProp("sortFunc",{dataType:DataType.FUNCTION}),this.defineProp("showTableHead",{dataType:DataType.BOOL}),this.defineProp("enableHeadInteraction",{dataType:DataType.BOOL}),this.defineProp("enableActiveRow",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableActiveRow",e),e||this.setActiveCell(null)}}),this.defineProp("activeCell",{dataType:DataType.OBJECT,setter:function(e){var n=this.getActiveCell();if(n!==e)if(n&&t.removeClass(n,i.STATE_ACTIVE),this.setPropStoreFieldValue("activeCell",e),e){t.addClass(e,i.STATE_ACTIVE);var s=this.getParentRow(e);s&&this.setActiveRow(s)}else this.setActiveRow(null)}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,setter:function(e){var t=this.getActiveRow();t!==e&&(this.activeRowChanged(t,e),this.setPropStoreFieldValue("activeRow",e))}}),this.defineProp("hoverCell",{dataType:DataType.OBJECT,setter:function(e){var n=this.getHoverCell();if(n!==e)if(n&&t.removeClass(n,i.STATE_HOVER),this.setPropStoreFieldValue("hoverCell",e),e){t.addClass(e,i.STATE_HOVER);var s=this.getParentRow(e);s&&this.setHoverRow(s)}else this.setHoverRow(null)}}),this.defineProp("hoverRow",{dataType:DataType.OBJECT,setter:function(e){var t=this.getHoverRow();t!==e&&(this.hoverRowChanged(t,e),this.setPropStoreFieldValue("hoverRow",e))}}),this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(e){var t=this.getDataPager();t!==e&&(this.setPropStoreFieldValue("dataPager",e),this.dataPagerChanged(e,t))}})},initPropValues:function($super){$super(),this.reactOperEditBind=this.reactOperEdit.bind(this),this.reactOperDeleteBind=this.reactOperDelete.bind(this),this.reactOperInsertBind=this.reactOperInsert.bind(this)},doObjectChange:function($super,e){$super(e);Kekule.ArrayUtils.intersect(e,["data","columns","sortFields","sortFunc","showTableHead","enableHeadInteraction","operColShowMode","operWidgets"]).length&&this.recreateChildContent()},doGetWidgetClassName:function($super){return $super()+" "+i.DATATABLE},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){return this.doCreateDataTable(e,t)},doCreateDataTable:function(e,t){var i=e.createElement("table");return this.recreateChildContent(e,i),t.appendChild(i),i},getTableElement:function(){return this.getElement()&&this.getElement().getElementsByTagName("table")[0]},getShowOperCol:function(){return(this.getOperColShowMode()||Kekule.Widget.DataTable.OperColShowMode.NONE)!==Kekule.Widget.DataTable.OperColShowMode.NONE},recreateChildContent:function(t,i){this.setActiveCell(null),this.setHoverCell(null);var n=this.prepareData(),s=i||this.getTableElement(),a=[];if(s){if(e.clearChildContent(s),!t)t=s.ownerDocument;a.push(this.doCreateDataTableColGroup(t,s,n.columns)),this.getShowTableHead()&&a.push(this.doCreateDataTableHead(t,s,n.columns)),a.push(this.doCreateDataTableBody(t,s,n.columns,n.data))}return a},doCreateDataTableColGroup:function(e,t,i){for(var n=i||[],s=e.createElement("colgroup"),a=0,r=n.length;a<r;++a){var o=n[a]||{},l=e.createElement("col");o.colClassName&&(l.className=o.colClassName),o.colStyle&&(l.style.cssText=o.colStyle),s.appendChild(l)}return t.appendChild(s),s},doCreateDataTableCellWrapper:function(e,t){var n=e.createElement("span");return n.className=i.DATATABLE_CELL_WRAPPER,t.appendChild(n),n},doCreateDataTableHead:function(e,t,i){for(var n=i||[],s=this.getEnableHeadInteraction(),a=e.createElement("thead"),r=e.createElement("tr"),o=0,l=n.length;o<l;++o){var u=n[o]||{};this.doCreateDataTableHeadCell(e,r,u,s)}return a.appendChild(r),t.appendChild(a),a},doCreateDataTableHeadCell:function(n,s,a,r){var o=n.createElement("th");a.className&&(o.className=a.className),a.style&&(o.style.cssText=a.style);var l=this.doCreateDataTableCellWrapper(n,o);(Kekule.ObjUtils.notUnset(a.disableInteract)?!a.disableInteract:r)&&t.addClass(o,i.DATATABLE_HEADCELL_INTERACTABLE),e.setElementText(l,a.text||a.name);var u=this.doCreateDataTableHeadCellSortMark(n,o);return 1===a.sorting?t.addClass(u,i.DATATABLE_SORTASC):-1===a.sorting&&t.addClass(u,i.DATATABLE_SORTDESC),l.title=a.hint||"",o[this.COLDEF_FIELD]=a,s.appendChild(o),o},doCreateDataTableHeadCellSortMark:function(e,t){var n=e.createElement("span");return n.className=i.DATATABLE_SORTMARK,t.appendChild(n),n},doCreateDataTableBody:function(e,t,n,s){var a=n||[],r=(s=s||[],e.createElement("tbody"));if(this.getShowOperCol())var o=this.getOperWidgetDefinitions();for(var l=!0,u=0,d=s.length;u<d;++u){var h=e.createElement("tr");h.className=l?i.DATATABLE_ROW_ODD:i.DATATABLE_ROW_EVEN,l=!l;var g=s[u]||{};h[this.ROWDATA_FIELD]=g;for(var c=0,p=a.length;c<p;++c){var E=a[c],f=E.name,T=g[f],C=e.createElement("td");E.className&&(C.className=E.className),E.style&&(C.style.cssText=E.style);var m=this.doCreateDataTableCellWrapper(e,C);if(E.isOperCol){var v={rowData:g,rowIndex:u,colIndex:c,childWidgetDefinitions:o},P=this.doCreateOperCellContent(m,v);h[this.ROW_OPER_TOOLBAR_FIELD]=P}else if(E.isCheckCol){v={rowData:g,rowIndex:u,colIndex:c};var _=this.doCreateCheckCellContent(m,v);h[this.ROW_CHECKBOX_FIELD]=_}else{v={rowData:g,cellKey:f,cellValue:T,rowIndex:u,colIndex:c};this.doCreateDataCellContent(m,v)}C.appendChild(m),h.appendChild(C)}r.appendChild(h)}return t.appendChild(r),r},doCreateDataCellContent:function(t,i){var n="";Kekule.ObjUtils.notUnset(i.cellValue)&&(n=""+i.cellValue),e.setElementText(t,n)},doCreateCheckCellContent:function(e,t){var i=new Kekule.Widget.CheckBox(this);return i.appendToElem(e),i},doCreateOperCellContent:function(e,t){var i=this.doCreateOperToolbar(e,t.childWidgetDefinitions),n=Kekule.Widget.DataTable.OperColShowMode;return this.getOperColShowMode()!==n.ALL&&i.setVisible(!1),i},doCreateOperToolbar:function(e,t){var i=new Kekule.Widget.ButtonGroup(this);return i.setChildDefs(t),i.appendToElem(e),i},getDefaultOperButtons:function(){var e=Kekule.Widget.DataTable.Components;return[e.EDIT,e.DELETE]},getOperWidgetDefinitions:function(){for(var e=[],t=this.getOperWidgets()||this.getDefaultOperButtons(),i=0,n=t.length;i<n;++i){var s=t[i];if(DataType.isObjectValue(s))e.push(s);else{var a=this.getDefaultComponentDefinitionHash(s);a&&e.push(a)}}return e},getDefaultComponentDefinitionHash:function(e){var t,n=Kekule.Widget.DataTable.Components;return e===n.EDIT?t={widget:"Kekule.Widget.Button",htmlClass:i.DATATABLE_EDIT,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_EDIT"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_EDIT"),"#execute":this.reactOperEditBind}:e===n.DELETE?t={widget:"Kekule.Widget.Button",htmlClass:i.DATATABLE_DELETE,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_DELETE"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_DELETE"),"#execute":this.reactOperDeleteBind}:e===n.INSERT&&(t={widget:"Kekule.Widget.Button",htmlClass:i.DATATABLE_INSERT,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_INSERT"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_INSERT"),"#execute":this.reactOperInsertBind}),t&&(t.internalName=e),t},hasExternalDataProvider:function(){return!!this.getDataPager()},needSort:function(){return this.getSortFields()||this.getSortFunc()},sortData:function(){var e=this.getData()||[];if(this.needSort()&&!this.hasExternalDataProvider()){var t=Kekule.ArrayUtils.clone(e);return Kekule.ArrayUtils.sortHashArray(t,this.getSortFields()),t}return e},prepareData:function(){var e={},t=this.sortData();e.data=t;var n=function(e){for(var t=[],i=0,n=e.length;i<n;++i){var s=Kekule.ObjUtils.getOwnedFieldNames(e[i]);Kekule.ArrayUtils.pushUnique(t,s)}var a=[];for(i=0,n=t.length;i<n;++i)a.push({name:t[i],text:t[i]});return a};this.getColumns()?e.columns=Kekule.ArrayUtils.clone(this.getColumns()):e.columns=n(t);for(var s=0;s<e.columns.length;){var a=e.columns[s];if("string"==typeof a&&(a={name:a}),a.name===this.COLNAME_OPER)e.columns[s]={name:"",text:"",disableInteract:!0,isOperCol:!0,colClassName:i.DATATABLE_OPER_COL,className:i.DATATABLE_OPER_CELL};else if(a.name===this.COLNAME_CHECK)e.columns[s]={name:"",text:"",disableInteract:!0,isCheckCol:!0,colClassName:i.DATATABLE_CHECK_COL,className:i.DATATABLE_CHECK_CELL};else if(a.name===this.COLNAME_ALL){var r=n(t);r.unshift(1),r.unshift(s),e.columns.splice.apply(e.columns,r)}else a.colClassName=i.DATATABLE_DATA_COL+" "+(a.colClassName||""),a.className=i.DATATABLE_DATA_CELL+" "+(a.className||"");++s}if(this.needSort()&&!this.getSortFunc())for(var o=this.getSortFields(),l=(s=0,e.columns.length);s<l;++s){var u=e.columns[s].name;o.indexOf(u)>=0?e.columns[s].sorting=1:o.indexOf(this.PREFIX_SORT_DESC+u)>=0?e.columns[s].sorting=-1:e.columns[s].sorting=0}return e},activeRowChanged:function(e,n){var s=Kekule.Widget.DataTable.OperColShowMode,a=this.getOperColShowMode();e&&(t.removeClass(e,i.STATE_ACTIVE),a!==s.ACTIVE&&a!==s.HOVER||this.hideRowOperToolbar(e)),n&&(t.addClass(n,i.STATE_ACTIVE),a!==s.ACTIVE&&a!==s.HOVER||this.showRowOperToolbar(n))},hoverRowChanged:function(e,n){var s=Kekule.Widget.DataTable.OperColShowMode,a=this.getOperColShowMode();e&&(t.removeClass(e,i.STATE_HOVER),a===s.HOVER&&e!==this.getActiveRow()&&this.hideRowOperToolbar(e)),n&&(t.addClass(n,i.STATE_HOVER),a===s.HOVER&&this.showRowOperToolbar(n))},getParentCell:function(t){return e.isDescendantOf(t,this.getElement())?e.getNearestAncestorByTagName(t,"td",!0):null},getParentHeadCell:function(t){return e.isDescendantOf(t,this.getElement())?e.getNearestAncestorByTagName(t,"th",!0):null},getParentRow:function(t){return e.isDescendantOf(t,this.getElement())?e.getNearestAncestorByTagName(t,"tr",!0):null},getColCount:function(){return(this.getColumns()||[]).length},getRowCount:function(){return(this.getData()||[]).length},getDataRows:function(){var e=this.getElement().getElementsByTagName("tbody")[0];return e&&e.getElementsByTagName("tr")},getCheckedRows:function(){for(var e=[],t=this.getDataRows(),i=0,n=t.length;i<n;++i)this.isRowChecked(t[i])&&e.push(t[i]);return e},getRowData:function(e){return e?e[this.ROWDATA_FIELD]:null},isRowChecked:function(e){var t=this.getRowCheckBox(e);return t&&t.getChecked&&t.getChecked()},getRowCheckBox:function(e){return e&&e[this.ROW_CHECKBOX_FIELD]},getRowOperToolbar:function(e){return e?e[this.ROW_OPER_TOOLBAR_FIELD]:null},showRowOperToolbar:function(e){var t=this.getRowOperToolbar(e);t&&t.setVisible(!0)},hideRowOperToolbar:function(e){var t=this.getRowOperToolbar(e);t&&t.setVisible(!1)},dataPagerChanged:function(e,t){t&&(t.removeEventListener("pageRetrieve",this.reactPagerRetrieve,this),t.removeEventListener("dataFetched",this.reactPagerFetched,this),t.removeEventListener("dataError",this.reactPagerError,this)),e&&(e.addEventListener("pageRetrieve",this.reactPagerRetrieve,this),e.addEventListener("dataFetched",this.reactPagerFetched,this),e.addEventListener("dataError",this.reactPagerError,this),this.setData(e.getCurrPageData()))},reactPagerRetrieve:function(e){this.reportMessage&&(this._loadingDataMsg=this.reportMessage(Kekule.$L("WidgetTexts.MSG_RETRIEVING_DATA"),Kekule.Widget.MsgType.INFO))},reactPagerFetched:function(e){this.setData(e.data),this._loadingDataMsg&&this.removeMessage&&this.removeMessage(this._loadingDataMsg)},reactPagerError:function(e){this._loadingDataMsg&&this.removeMessage&&this.removeMessage(this._loadingDataMsg),this.flashMessage&&this.flashMessage(e.error.message||e.error,Kekule.Widget.MsgType.ERROR)},reactOperEdit:function(e){return this.reactOperExecute(s.EDIT,e)},reactOperDelete:function(e){return this.reactOperExecute(s.DELETE,e)},reactOperInsert:function(e){return this.reactOperExecute(s.INSERT,e)},reactOperExecute:function(e,t){var i=t.target,n=this.getParentRow(i.getElement()),s=this.getRowData(n);return this.doReactOperExecute(e,s,n,t)},doReactOperExecute:function(e,t,i,n){},react_click:function($super,e){$super(e);var t=e.getTarget(),i=this.getParentHeadCell(t);if(i)this._autoSortOnHeadCell(i);else if(this.getEnableActiveRow()){var n=this.getParentCell(t);n&&this.setActiveCell(n)}},react_pointerover:function($super,e){$super(e);var t=e.getTarget();if(this.getEnableActiveRow()){var i=this.getParentCell(t);i?this.setHoverCell(i):this.setHoverCell(null)}},react_pointerleave:function($super,e){$super(e);e.getTarget();this.getEnableActiveRow()&&this.setHoverCell(null)},_autoSortOnHeadCell:function(e){if(e&&this.getEnableHeadInteraction()){var t=e[this.COLDEF_FIELD];if(t&&!t.disableInteract){var i=t.name;1===t.sorting&&(i=this.PREFIX_SORT_DESC+i),this.setSortFields([i])}}},load:function(e,t,i,n){this.beginUpdate();try{this.setData(e),this.setColumns(t),this.setSortFields(i?Kekule.ArrayUtils.toArray(i):null),this.setSortFunc(n)}finally{this.endUpdate()}return this},reload:function(){return this.recreateChildContent(),this}}),Kekule.Widget.DataTable.OperColShowMode={NONE:"none",ACTIVE:"active",HOVER:"hover",ALL:"all"},Kekule.Widget.DataTable.Components={EDIT:"edit",DELETE:"delete",INSERT:"insert"};var s=Kekule.Widget.DataTable.Components;Kekule.Widget.PageNavigator=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.PageNavigator",initProperties:function(){this.defineProp("components",{dataType:DataType.ARRAY}),this.defineProp("firstIndex",{dataType:DataType.INT}),this.defineProp("lastIndex",{dataType:DataType.INT}),this.defineProp("currIndex",{dataType:DataType.INT}),this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(e){var t=this.getDataPager();t!==e&&(this.setPropStoreFieldValue("dataPager",e),this.dataPagerChanged(e,t))}})},initPropValues:function($super){$super(),this.setShowText(!0),this.setShowGlyph(!0),this.setFirstIndex(1),this.reactFirstBind=this.reactFirst.bind(this),this.reactLastBind=this.reactLast.bind(this),this.reactPrevBind=this.reactPrev.bind(this),this.reactNextBind=this.reactNext.bind(this),this.reactPageInputChangeBind=this.reactPageInputChange.bind(this)},doObjectChange:function($super,e){$super(e),Kekule.ArrayUtils.intersect(e,["firstIndex","lastIndex","currIndex"]).length&&this.updateChildComponent(),e.indexOf("currIndex")>=0&&this.invokeEvent("pageChange",{currIndex:this.getCurrIndex()})},doGetWidgetClassName:function($super){return $super()+" "+i.PAGENAVIGATOR},doCreateSubElements:function(e,t){return this.recreateChildContent(e,t)},getDefaultComponents:function(){return[a.FIRST,a.PREV,a.PAGESELECTOR,a.NEXT,a.LAST]},recreateChildContent:function(){for(var e=this.getComponents()||this.getDefaultComponents(),t=[],i=0,n=e.length;i<n;++i){var s=e[i];if(DataType.isObjectValue(s))t.push(s);else{var a=this.getDefaultComponentDefinitionHash(s);a&&t.push(a)}}this.setChildDefs(t),this.updateChildComponent()},getDefaultComponentDefinitionHash:function(e){var t;return(t=e===a.FIRST?{widget:"Kekule.Widget.Button",htmlClass:i.PAGENAVIGATOR_FIRST,text:Kekule.$L("WidgetTexts.CAPTION_FIRST_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_FIRST_PAGE"),"#execute":this.reactFirstBind}:e===a.LAST?{widget:"Kekule.Widget.Button",htmlClass:i.PAGENAVIGATOR_LAST,text:Kekule.$L("WidgetTexts.CAPTION_LAST_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_LAST_PAGE"),"#execute":this.reactLastBind}:e===a.PREV?{widget:"Kekule.Widget.Button",htmlClass:i.PAGENAVIGATOR_PREV,text:Kekule.$L("WidgetTexts.CAPTION_PREV_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_PREV_PAGE"),"#execute":this.reactPrevBind}:e===a.NEXT?{widget:"Kekule.Widget.Button",htmlClass:i.PAGENAVIGATOR_NEXT,text:Kekule.$L("WidgetTexts.CAPTION_NEXT_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_NEXT_PAGE"),"#execute":this.reactNextBind}:e===a.PAGEINPUT?{widget:"Kekule.Widget.TextBox",htmlClass:[i.PAGENAVIGATOR_PAGEINPUT,i.PAGENAVIGATOR_PAGEINDEXER],hint:Kekule.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}:e===a.PAGESELECTOR?{widget:"Kekule.Widget.SelectBox",htmlClass:[i.PAGENAVIGATOR_PAGESELECTOR,i.PAGENAVIGATOR_PAGEINDEXER],hint:Kekule.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}:null)&&(t.internalName=e),t},getComponent:function(e){return this.getChildWidgetByInternalName(e)},setChildComponentEnabled:function(e,t){var i=this.getComponent(e);i&&i.setEnabled(t)},updateChildComponent:function(){var e=this.getFirstIndex()||0,t=this.getLastIndex()||0,i=this.getCurrIndex()||0,n=i<=e,s=i>=t;this.setChildComponentEnabled(a.FIRST,!n),this.setChildComponentEnabled(a.PREV,!n),this.setChildComponentEnabled(a.NEXT,!s),this.setChildComponentEnabled(a.LAST,!s),this.setChildComponentEnabled(a.PAGEINPUT,t>e),this.setChildComponentEnabled(a.PAGESELECTOR,t>e);var r=this.getComponent(a.PAGEINPUT);r&&r.setValue(i);var o=this.getComponent(a.PAGESELECTOR);if(o){for(var l=[],u=e;u<=t;++u)l.push({value:u});o.setItems(l),o.setValue(i)}},dataPagerChanged:function(e,t){t&&(t.removeEventListener("dataFetched",this.reactPagerFetched,this),e.removeEventListener("pageCountChange",this.reactPagerPageCountChange,this)),e&&(e.addEventListener("dataFetched",this.reactPagerFetched,this),e.addEventListener("pageCountChange",this.reactPagerPageCountChange,this),this.updatePageDetails(e),this.setCurrIndex(e.getCurrPageIndex()+this.getFirstIndex()))},reactPagerFetched:function(e){this.setCurrIndex(e.pageIndex+this.getFirstIndex())},reactPagerPageCountChange:function(e){this.updatePageDetails(this.getDataPager())},updatePageDetails:function(e){var t=this.getFirstIndex();this.setLastIndex(e.getPageCount()+t-1)},requestChangeCurrIndex:function(e){var t=this.getDataPager();t?t.switchToPage(e-this.getFirstIndex()):this.setCurrIndex(e)},reactFirst:function(e){this.requestChangeCurrIndex(this.getFirstIndex()||0)},reactLast:function(e){this.requestChangeCurrIndex(this.getLastIndex()||0)},reactPrev:function(e){var t=this.getFirstIndex()||0,i=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.max(i-1,t))},reactNext:function(e){var t=this.getLastIndex()||0,i=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.min(i+1,t))},reactPageInputChange:function(e){var t=e.target.getValue();"string"==typeof t&&(t=parseInt(t));var i=this.getFirstIndex()||0,n=this.getLastIndex()||0;t>=i&&t<=n?this.requestChangeCurrIndex(t):Kekule.error(Kekule.$L("ErrorMsg.PAGE_INDEX_OUTOF_RANGE"))}}),Kekule.Widget.PageNavigator.Components={FIRST:"first",LAST:"last",PREV:"prev",NEXT:"next",PAGEINPUT:"pageInput",PAGESELECTOR:"pageSelector"};var a=Kekule.Widget.PageNavigator.Components}(),function(){"use strict";Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{SYSMSGGROUP:"K-SysMsgGroup"}),Kekule.Widget.SysMsgGroup=Class.create(Kekule.Widget.MsgGroup,{CLASS_NAME:"Kekule.Widget.SysMsgGroup",initialize:function($super,e){$super(e)},initPropValues:function($super){$super(),this.setMaxMsgCount(6)},doGetWidgetClassName:function($super){return $super()+" "+e.SYSMSGGROUP}}),Kekule.Widget.ExceptionHandler=Class.create(Kekule.ExceptionHandler,{CLASS_NAME:"Kekule.Widget.ExceptionHandler",initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getPropStoreFieldValue("document")||document}}),this.defineProp("sysMsgGroup",{dataType:"Kekule.Widget.SysMsgGroup",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("sysMsgGroup");return e||((e=new Kekule.Widget.SysMsgGroup(this.getDocument())).appendToElem(this.getDocument().body),this.setPropStoreFieldValue("sysMsgGroup",e)),e}})},throwException:function($super,e,t){var i,n=Kekule.ExceptionLevel,s=Kekule.Widget.MsgType;if(t||(t=n.ERROR),i="string"==typeof e?e:e.message){var a=t!==n.ERROR&&t?t===n.WARNING?s.WARNING:t===n.NOTE?s.INFO:s.NORMAL:s.ERROR;this.getSysMsgGroup().addMessage(i,a)}return $super(e,t)}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.ExceptionHandler),Kekule.X.domReady(function(){Kekule.exceptionHandler=Kekule.Widget.ExceptionHandler.getInstance()})}(),function(){"use strict";var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OPER_HISTORY_TREE_VIEW:"K-OperHistory-TreeView"}),Kekule.Widget.OperHistoryTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.Widget.OperHistoryTreeView",initialize:function($super,e,t){$super(e),this.setPropStoreFieldValue("objMap",new Kekule.MapEx(!0)),this.setEnableLiveUpdate(!0),this.setEnableMultiSelected(!0),this.setOperHistory(t)},initProperties:function(){this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("operHistory");this.setPropStoreFieldValue("operHistory",e),this.operHistoryChanged(e,t)}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:!1})},doGetWidgetClassName:function($super){return $super()+" "+e.OPER_HISTORY_TREE_VIEW},operHistoryChanged:function(e,t){this.clearChildItems(),this.getObjMap().clear(),t&&this._uninstallRootEventHandler(t),e&&(this._fillTree(e),this._installRootEventHandler(e))},_installRootEventHandler:function(e){e.addEventListener("operChange",this.reactOperChange,this)},_uninstallRootEventHandler:function(e){e.removeEventListener("operChange",this.reactOperChange,this)},reactOperChange:function(e){if(this.getEnableLiveUpdate()){e.target;this._fillTree(e.target)}},_fillTree:function(e){if(e){this.clearChildItems(),this._updateTreeItem(this.appendChildItem(),e);var t=e.getCurrOperation(),i=t?this.getObjMap().get(t):null;this.select(i)}},_getOperChildCount:function(e){return e instanceof Kekule.OperationHistory?e.getOperationCount():e instanceof Kekule.MacroOperation?e.getChildCount():0},_getChildOperAt:function(e,t){return e instanceof Kekule.OperationHistory?e.getOperationAt(t):e instanceof Kekule.MacroOperation?e.getChildAt(t):null},_updateTreeItem:function(e,t){var i={text:this._getOperDisplayTitle(t),obj:t};this.setItemData(e,i),this.getObjMap().set(t,e);for(var n=this.getChildItemCount(e),s=this._getOperChildCount(t),a=0;a<s;++a){var r,o=this._getChildOperAt(t,a);r=a<n?this.getChildItemAt(e,a):this.appendChildItem(e),this._updateTreeItem(r,o)}if(n>s)for(a=n-1;a>=s;--a)this.removeChildItemAt(e,a)},_getOperDisplayTitle:function(e){var t=e.getClassName(),i=e.getTarget?e.getTarget():null;return i&&i.getId&&(t+="(target: "+i.getId()+")"),t}})}();