!function(){"use strict";var e=Kekule.EmscriptenUtils,n="InChIModule";Kekule.InChI={_autoEnabled:!0,_scriptLoadedBySelf:!1,_module:null,_enableFuncs:[],SCRIPT_FILE:"inchi.js",isScriptLoaded:function(){return e.isSupported(n)},getModule:function(){return t._module||(t._module=e.getRootModule(n)),t._module},getInChIPath:function(){var e=Kekule.scriptSrcInfo.useMinFile?"extra/":"_extras/InChI/";return e=Kekule.scriptSrcInfo.path+e},getInChIScriptUrl:function(){var e=t.getInChIPath()+t.SCRIPT_FILE;return Kekule.scriptSrcInfo.useMinFile||(e+=".dev"),e},loadInChIScript:function(n,r){if(n||(n=document),t.isScriptLoaded()||t._scriptLoadedBySelf)t._scriptLoadedBySelf=!0,r&&r();else{var i=t.getInChIScriptUrl();e.loadScript(i,r,n),t._scriptLoadedBySelf=!0}},molDataToInChI:function(e,n){var r=t._molToInChI;r||(r=t.getModule().cwrap("molToInchiJson","string",["string","string"]));var i=r(e,n);return JSON.parse(i)},getInChIInfo:function(e){var n=Kekule.IO.saveFormatData(e,Kekule.IO.DataFormat.MOL);return t.molDataToInChI(n)},enable:function(e){t.isScriptLoaded()?(t._enableAllFunctions(),e&&e()):t.loadInChIScript(document,function(){t._enableAllFunctions(),e&&e()})},_enableAllFunctions:function(){if(t.isScriptLoaded())for(var e=t._enableFuncs,n=0,r=e.length;n<r;++n){var i=e[n];i&&i()}}};var t=Kekule.InChI;Kekule.IO.InChIWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.InChIWriter",doWriteData:function(e,n,r){var i=t.getInChIInfo(e);if(i&&i.inchi){var l=i.inchi;return i.auxInfo&&(l+="\n"+i.auxInfo),l}return null},isAllowedObj:function(e){var n=Kekule.IO.InChIWriter.ALLOWED_CLASSES;return Kekule.ObjUtils.isInstanceOf(e,n)}}),Kekule.IO.InChIWriter.ALLOWED_CLASSES=[Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace],Kekule.IO.registerAllInChIFormats=function(){if(t.isScriptLoaded()){Kekule.IO.DataFormat.INCHI="inchi",Kekule.IO.MimeType.INCHI="chemical/x-inchi",Kekule.IO.DataFormatsManager.register("inchi",Kekule.IO.MimeType.INCHI,"inchi",Kekule.IO.ChemDataType.TEXT,"InChI format"),Kekule.IO.ChemDataWriterManager.register("inchi",Kekule.IO.InChIWriter,Kekule.IO.InChIWriter.ALLOWED_CLASSES,"inchi")}},Kekule.IO.enableInChIFormats=function(){t.enable()},t._enableFuncs.push(Kekule.IO.registerAllInChIFormats),Kekule._registerAfterLoadProc(function(){t._autoEnabled&&t._enableAllFunctions()})}();